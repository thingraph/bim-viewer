(function(e){function t(t){for(var i,r,a=t[0],c=t[1],l=t[2],h=0,u=[];h<a.length;h++)r=a[h],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&u.push(n[r][0]),n[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);d&&d(t);while(u.length)u.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],i=!0,a=1;a<s.length;a++){var c=s[a];0!==n[c]&&(i=!1)}i&&(o.splice(t--,1),e=r(r.s=s[0]))}return e}var i={},n={app:0},o=[];function r(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=i,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;o.push([0,"chunk-threejs","chunk-elementui","chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("cd49")},"02fe":function(e,t,s){},"47ac":function(e,t,s){e.exports={bimTree:"BimTree-module_bimTree_3pdwV"}},"5ed1":function(e,t,s){"use strict";s("02fe")},6728:function(e,t,s){e.exports={materialManager:"MaterialManager-module_materialManager_Xvry7"}},7130:function(e,t,s){e.exports={progressBarWrapper:"ProgressBar-module_progressBarWrapper__IZtB",progressBar:"ProgressBar-module_progressBar_3SMbv"}},"76da":function(e,t,s){e.exports={snapshotPanel:"SnapshotPanel-module_snapshotPanel_By779"}},"96ca":function(e,t,s){e.exports={psetting:"ProjectSettings-module_psetting_1zNg6",sliderWrap:"ProjectSettings-module_sliderWrap_mzMu8",btnWrap:"ProjectSettings-module_btnWrap_3Kkkj",pSettingDialog:"ProjectSettings-module_pSettingDialog_1-AOI"}},a7d5:function(e,t){function s(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}s.keys=function(){return[]},s.resolve=s,e.exports=s,s.id="a7d5"},b372:function(e,t,s){e.exports={basePanel:"BasePanel-module_basePanel_34bf_"}},b9d3:function(e,t,s){e.exports={tableWrapper:"PropertyPanel-module_tableWrapper_2F9tn"}},cd49:function(e,t,s){"use strict";s.r(t);var i;s("f23a"),s("51e0"),s("0fe0");(function(e){e["getSupportedPostmateProperties"]="getSupportedPostmateProperties",e["getSupportedPostmateFunctions"]="getSupportedPostmateFunctions",e["getGroundGrid"]="getGroundGrid",e["setBimTree"]="setBimTree",e["setGroundGrid"]="setGroundGrid",e["goHomeView"]="goHomeView",e["setTransparentMode"]="setTransparentMode",e["setExplodeMode"]="setExplodeMode",e["highlightRandomNode"]="highlightRandomNode",e["setObjectsPlaneClipper"]="setObjectsClipPlane",e["setObjectsBoxClipper"]="setObjectsClipBox"})(i||(i={}));const n=s("9aa0");class o{constructor(){this.isEmbedded=!1,this.model={},this.properties=[],this.functions=[],this.histories=[]}static instance(){return o._instance||(o._instance=new o,o._instance.init()),o._instance}init(){const e=window.location!==window.parent.location;if(this.isEmbedded=e,!e)return;console.log(`[PM] BIM Viewer is${e?"":" not"} embedded`);const t=n.default,s=new t.Model(this.model);s.then(e=>{this.childApi=e}),this.addEventListenerWithReturnValue(i.getSupportedPostmateProperties,()=>this.properties),this.addEventListenerWithReturnValue(i.getSupportedPostmateFunctions,()=>this.functions)}getIsEmbedded(){return this.isEmbedded}emit(e,t){this.childApi&&this.childApi.emit(e,t)}get(e){if(this.childApi)return this.childApi.get(e)}call(e,t){this.childApi&&this.childApi.call(e,t)}addEventListener(e,t){this.isEmbedded&&(this.model[e]=s=>{this.histories.push({direction:"received",type:"function",messageId:e,time:Date.now()}),t(s)},this.functions.push(e))}addEventListenerWithReturnValue(e,t){this.isEmbedded&&(this.model[e]=s=>(this.histories.push({direction:"received",type:"property",messageId:e,time:Date.now()}),t(s)),this.properties.push(e))}removeEventListener(...e){e.forEach(e=>{this.model[e]&&delete this.model[e];const t=this.functions.indexOf(e);t>=0&&this.functions.splice(t,1)})}removeEventListenerWithReturnValue(...e){e.forEach(e=>{this.model[e]&&delete this.model[e];const t=this.properties.indexOf(e);t>=0&&this.properties.splice(t,1)})}getHistories(){return this.histories}}o._instance=void 0;var r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("div",{attrs:{id:"nav"}}),t("router-view")],1)},a=[],c=(s("5ed1"),s("1ff0")),l={},d=Object(c["a"])(l,r,a,!1,null,null,null),h=d.exports,u=(s("17b2"),s("503e"),s("9232")),p=s.n(u),m=(s("6f81"),s("e7fa")),g=s("d735");async function f(){return console.warn("Not implemented yet!"),[]}async function b(e){return console.warn("Not implemented yet!"),null}async function v(e,t=""){return console.warn("Not implemented yet!"),null}async function w(e,t){return console.warn("Not implemented yet!"),null}s("b292"),s("5562");var y=s("2211"),x=s("4ade"),E=s.n(x);class O{static getSampleProjects(){const e="/",t="config/projects.json";return new Promise((s,i)=>{E.a.get(t,{baseURL:e}).then(e=>{const t=e.data;s(t)}).catch(e=>{console.error(e),i(e)})})}static async getCustomProjects(e=!1){if(!O.customProjects||O.customProjects.length<1||e)try{const e=await f();return e||console.warn("Failed to load online projects: "+e),O.customProjects=e.map(e=>({id:e._id,name:e.name,models:[]}))||[],console.log("ProjectManager.customProjects: "+O.customProjects),O.customProjects}catch(t){console.warn("Failed to load online projects, error: "+t)}return Promise.resolve(O.customProjects)}static async getProject(e){const t=await O.getCustomProjects(),s=t?t.find(t=>t.id===e):void 0;if(!s)throw Error("Failed to get project with id: "+e);return Promise.resolve(s)}static addCustomProject(e){return O.customProjects.push(e),e}static deleteCustomProject(e){const t=O.customProjects.findIndex(t=>t.id===e);t>-1&&O.customProjects.splice(t,1)}static arrayToVector3(e){return e?e instanceof y["wc"]?e:Array.isArray(e)&&e.length>=3?new y["wc"](e[0],e[1],e[2]):void 0:e}static arrayToEuler(e){return e?e instanceof y["C"]?e:Array.isArray(e)&&e.length>=3?new y["C"](e[0],e[1],e[2]):void 0:e}}O.customProjects=[];var M=s("f1ed"),T=s.n(M);let C=class extends g["d"]{constructor(){super(...arguments),this.defaultThumbnail="images/default-thumbnail.jpg"}delete(e){e.stopPropagation()}mounted(){const e=this.$refs.thumbnail;this.project.thumbnail&&(e.style.backgroundImage=`url(${this.project.thumbnail})`)}openProject(e){return t=>{console.log(`[PC] Routing to project: ${e.name}, id: ${e.id}`),this.$router.push("/projects/"+e.id)}}render(){const e=arguments[0];return e("div",{ref:"projectCard",class:T.a.projectCard,on:{click:this.openProject(this.project)}},[e("div",{class:T.a.card},[e("div",{ref:"thumbnail",class:T.a.thumbnail}),e("div",{class:T.a.infos},[e("div",{class:T.a.info},[""+this.project.name])])])])}};Object(m["a"])([Object(g["c"])({required:!0})],C.prototype,"project",void 0),Object(m["a"])([Object(g["c"])({required:!1})],C.prototype,"click",void 0),Object(m["a"])([Object(g["b"])()],C.prototype,"delete",null),C=Object(m["a"])([g["a"]],C);var S,P=C,j=s("edda"),A=s.n(j);let k=S=class extends g["d"]{constructor(){super(...arguments),this.sampleProjects=[],this.onLoading=!1,this.activateUpdate=!1,this.customProjects=[]}async mounted(){0===S.sampleProjects.length?(this.onLoading=!0,O.getSampleProjects().then(e=>{S.sampleProjects.push(...e),this.sampleProjects=S.sampleProjects}).finally(()=>{this.onLoading=!1})):this.sampleProjects=S.sampleProjects}createNewProject(){p.a.warning("Not implemented yet!")}async addNewProject(e){const t=await this.addProject(e);t&&e.uploadFiles.length&&this.uploadModel(t,e),this.activateUpdate=!1}async addProject(e){const t=new FormData,s=["projectName","projectDescription"];s.forEach(s=>{t.append(s,e[s])});const i=await v(e.projectName,e.projectDescription);if(i&&i.projectId){const t={id:i.projectId,name:e.projectName,models:[]};return O.addCustomProject(t),this.customProjects=O.customProjects,i.projectId}return""}async uploadModel(e,t){const s=new FormData;t.uploadFiles.forEach(e=>{s.append("file",e,e.name)}),s.append("splitMethod",t.splitMethod),await w(e,s)}async deleteProject(e){e.id&&await b(e.id),e.id&&O.deleteCustomProject(e.id),this.customProjects=O.customProjects}render(){const e=arguments[0],t=this.sampleProjects.map(t=>e(P,{attrs:{project:t},class:A.a.card,key:t.id}));return e("div",{ref:"projects",class:A.a.projects},[e("el-card",{class:A.a.cardsWrapper},[e("div",{slot:"header"},[e("span",{class:"span"},["Sample projects"])]),t])])}};k.sampleProjects=[],k=S=Object(m["a"])([g["a"]],k);var _=k,I=s("f490"),N=s.n(I),R=s("7a6c"),L=s.n(R),B=s("bcba"),D=s.n(B);const F={unit:"file",decimalPrecision:99,camera:{near:.5,far:3e4},mouse:{sensitivity:3},keyboard:{sensitivity:3}},G=[.1,100],U=[1e3,5e4],z={"Unit from file":"file",Meter:"m",Milimeter:"mm",Centimeter:"cm",Feet:"ft",Inch:"in",Point:"pt"},W=[1,5],H={"Precision from file":99,"0(1)":0,"0.1(1/2)":1,"0.01(1/4)":2,"0.001(1/8)":3,"0.0001(1/16)":4,"0.00001(1/32)":5,"0.000001(1/64)":6},$="THREE_RENDER_SETTING";var V,K=s("a2e7"),q=s("6eef");K["default"].use(q["a"]),function(e){e["STATE_ACTIVE_PROJECT"]="activeProject",e["GETTER_ACTIVE_PROJECT"]="getActiveProject",e["MUTATION_ACTIVE_PROJECT"]="setActiveProject",e["STATE_SHOW_BIM_TREE"]="showBimTree",e["GETTER_SHOW_BIM_TREE"]="getShowBimTree",e["MUTATION_SHOW_BIM_TREE"]="setShowBimTree",e["STATE_SHOW_LAYER_MANAGER"]="showLayerManager",e["GETTER_SHOW_LAYER_MANAGER"]="getShowLayerManager",e["MUTATION_SHOW_LAYER_MANAGER"]="setShowLayerManager",e["STATE_SHOW_PROPERTY_PANEL"]="showPropertyPanel",e["GETTER_SHOW_PROPERTY_PANEL"]="getShowPropertyPanel",e["MUTATION_SHOW_PROPERTY_PANEL"]="setShowPropertyPanel",e["STATE_SHOW_SNAPSHOT_PANEL"]="showSnapshotPanel",e["GETTER_SHOW_SNAPSHOT_PANEL"]="getShowSnapshotPanel",e["MUTATION_SHOW_SNAPSHOT_PANEL"]="setShowSnapshotPanel",e["STATE_SHOW_VIEWPOINTS"]="showViewpoints",e["GETTER_SHOW_VIEWPOINTS"]="getShowViewpoints",e["MUTATION_SHOW_VIEWPOINTS"]="setShowViewpoints",e["STATE_SHOW_ANNOTATIONS"]="showAnnotations",e["GETTER_SHOW_ANNOTATIONS"]="getShowAnnotations",e["MUTATION_SHOW_ANNOTATIONS"]="setShowAnnotations",e["STATE_SHOW_PROJECT_SETTINGS_PANEL"]="showProjectSettingsPanel",e["GETTER_SHOW_PROJECT_SETTINGS_PANEL"]="getShowProjectSettingsPanel",e["MUTATION_SHOW_PROJECT_SETTINGS_PANEL"]="setShowProjectSettingsPanel",e["STATE_PROJECT_SETTINGS"]="projectSettings",e["GETTER_PROJECT_SETTINGS"]="getProjectSettings",e["MUTATION_PROJECT_SETTINGS"]="setProjectSettings",e["STATE_OBJECT_UUID_FOR_MATERIAL_MANAGER"]="objectUuidForMaterialManager",e["GETTER_OBJECT_UUID_FOR_MATERIAL_MANAGER"]="getObjectUuidForMaterialManager",e["MUTATION_OBJECT_UUID_FOR_MATERIAL_MANAGER"]="setObjectUuidForMaterialManager"}(V||(V={}));const J={state:{[V.STATE_ACTIVE_PROJECT]:{},[V.STATE_SHOW_BIM_TREE]:!1,[V.STATE_SHOW_LAYER_MANAGER]:!1,[V.STATE_SHOW_PROPERTY_PANEL]:!1,[V.STATE_SHOW_SNAPSHOT_PANEL]:!1,[V.STATE_SHOW_VIEWPOINTS]:!1,[V.STATE_SHOW_ANNOTATIONS]:!1,[V.STATE_PROJECT_SETTINGS]:null,[V.STATE_SHOW_PROJECT_SETTINGS_PANEL]:!1,[V.STATE_OBJECT_UUID_FOR_MATERIAL_MANAGER]:null},mutations:{[V.MUTATION_ACTIVE_PROJECT](e,t){e[V.STATE_ACTIVE_PROJECT]=t},[V.MUTATION_SHOW_BIM_TREE](e,t){e[V.STATE_SHOW_BIM_TREE]=t},[V.MUTATION_SHOW_LAYER_MANAGER](e,t){e[V.STATE_SHOW_LAYER_MANAGER]=t},[V.MUTATION_SHOW_PROPERTY_PANEL](e,t){e[V.STATE_SHOW_PROPERTY_PANEL]=t},[V.MUTATION_SHOW_SNAPSHOT_PANEL](e,t){e[V.STATE_SHOW_SNAPSHOT_PANEL]=t},[V.MUTATION_SHOW_VIEWPOINTS](e,t){e[V.STATE_SHOW_VIEWPOINTS]=t},[V.MUTATION_SHOW_ANNOTATIONS](e,t){e[V.STATE_SHOW_ANNOTATIONS]=t},[V.MUTATION_SHOW_PROJECT_SETTINGS_PANEL](e,t){e[V.STATE_SHOW_PROJECT_SETTINGS_PANEL]=t},[V.MUTATION_PROJECT_SETTINGS](e,t){e[V.STATE_PROJECT_SETTINGS]=t},[V.MUTATION_OBJECT_UUID_FOR_MATERIAL_MANAGER](e,t){e[V.STATE_OBJECT_UUID_FOR_MATERIAL_MANAGER]=t}},actions:{},modules:{},getters:{[V.GETTER_ACTIVE_PROJECT](e){return e[V.STATE_ACTIVE_PROJECT]},[V.GETTER_SHOW_BIM_TREE](e){return e[V.STATE_SHOW_BIM_TREE]},[V.GETTER_SHOW_LAYER_MANAGER](e){return e[V.STATE_SHOW_LAYER_MANAGER]},[V.GETTER_SHOW_PROPERTY_PANEL](e){return e[V.STATE_SHOW_PROPERTY_PANEL]},[V.GETTER_SHOW_SNAPSHOT_PANEL](e){return e[V.STATE_SHOW_SNAPSHOT_PANEL]},[V.GETTER_SHOW_VIEWPOINTS](e){return e[V.STATE_SHOW_VIEWPOINTS]},[V.GETTER_SHOW_ANNOTATIONS](e){return e[V.STATE_SHOW_ANNOTATIONS]},[V.GETTER_SHOW_PROJECT_SETTINGS_PANEL](e){return e[V.STATE_SHOW_PROJECT_SETTINGS_PANEL]},[V.GETTER_PROJECT_SETTINGS](e){return e[V.STATE_PROJECT_SETTINGS]},[V.GETTER_OBJECT_UUID_FOR_MATERIAL_MANAGER](e){return e[V.STATE_OBJECT_UUID_FOR_MATERIAL_MANAGER]}}};var X=new q["a"].Store(J),Y=(s("d0cc"),s("a4a2")),Z=s.n(Y),Q=(s("f29a"),s("3761"),s("eb93"),s("d1fb"),s("e0e2")),ee=s("82d3"),te=s("9516");class se{static exportToGltf(e,t){se.exportToGltfOrGlb(e,t,{binary:!1})}static exportToGlb(e,t){se.exportToGltfOrGlb(e,t,{binary:!0})}static exportToGltfOrGlb(e,t,s={}){if(!e||!t)throw new Error("Invalid input or filename!");const i=new ee["a"],n={binary:!0,onlyVisible:!1,includeCustomExtensions:!1};s=Object.assign({},n,s),i.parse(e,e=>{if(s.binary){t=se.addExtention(t,se.EXTENSION_GLB);const s=e;se.saveArrayBuffer(s,t)}else t=se.addExtention(t,se.EXTENSION_GLTF),se.saveJson(e,t)},e=>console.log(e),s)}static exportToObj(e,t){if(!e||!t)throw new Error("Invalid input or filename!");t=se.addExtention(t,se.EXTENSION_OBJ);const s=new te["a"],i=s.parse(e);se.saveString(i,t)}static exportToDraco(e,t,s={}){if(!e||!t)throw new Error("Invalid input or filename!");t=se.addExtention(t,se.EXTENSION_DRACO);const i=new Q["a"],n={encodeSpeed:5};s=Object.assign({},n,s);const o=i.parse(e,s);se.saveArrayBuffer(o,t)}static exportToThreeJsJson(e,t){const s=e.toJSON();t.toLowerCase().endsWith(se.EXTENSION_JSON)||(t+=se.EXTENSION_JSON),se.saveJson(s,t)}static save(e,t){let s=se.downloadLink;s||(s=document.createElement("a"),s.style.display="none",document.body.appendChild(s),se.downloadLink=s),s.href=URL.createObjectURL(e),s.download=t,s.click()}static saveArrayBuffer(e,t){se.save(new Blob([e],{type:"application/octet-stream"}),t)}static saveJson(e,t){se.saveJsonString(JSON.stringify(e),t)}static saveJsonString(e,t){se.save(new Blob([e],{type:"application/json"}),t)}static saveString(e,t){se.save(new Blob([e],{type:"text/csv"}),t)}static addExtention(e,t){return e.toLowerCase().endsWith(t.toLowerCase())||(e+=t),e}}se.EXTENSION_GLTF=".gltf",se.EXTENSION_GLB=".glb",se.EXTENSION_OBJ=".obj",se.EXTENSION_DRACO=".drc",se.EXTENSION_JSON=".json";const ie=!1;class ne{constructor(e,t,s,i=ne.DEFAULT_SCALE){this.explodedTimes=0,this.isExplodeUp=!1,this.scene=e,this.objectId=t,t||console.log("[EXP] Invalid objectId: "+t),this.scale=i,i<=0&&console.log("[EXP] Invalid scale: "+i),s?this.position=s:(this.position=new y["wc"],this.getObjectCenter(this.position))}explode(){if(!this.objectId||!this.position||!this.scale)return void console.log(`[EXP] Invalid objectId: ${this.objectId}, or position: ${this.position}, or this.power: ${this.scale}`);const e=this.scene.getObjectById(this.objectId);e&&e.children?(console.log(`[EXP] Exploding ${e.name} at: ${this.position.x}, ${this.position.y}, ${this.position.z}`),e.children.forEach(e=>{if(e instanceof y["R"]){const t=new y["mb"],s=new y["wc"],i=new y["Pb"],n=new y["wc"];for(let o=0;o<e.count;++o){if(e.getMatrixAt(o,t),t.decompose(s,i,n),this.isExplodeUp){const e=(s.z-this.position.z)*this.scale;s.setZ(s.z+e)}else{const e=s.clone().sub(this.position);s.addScaledVector(e,this.scale)}t.setPosition(s),e.setMatrixAt(o,t)}e.matrixWorldNeedsUpdate=!0,e.instanceMatrix.needsUpdate=!0}else{const t=e.position.clone();if(this.isExplodeUp){const s=(t.z-this.position.z)*this.scale;e.position.setZ(t.z+s)}else{const s=t.sub(this.position);e.position.addScaledVector(s,this.scale)}}e.updateMatrix()}),this.explodedTimes++):console.log("[EXP] No children to explode!")}unexplode(){const e=this.scene.getObjectById(this.objectId);if(e&&e.children){console.log(`[EXP] Unexploding ${e.name} at: ${this.position.x}, ${this.position.y}, ${this.position.z}`);for(let t=this.explodedTimes;t>0;--t)e.children.forEach(e=>{if(e instanceof y["R"]){const t=new y["mb"],s=new y["wc"],i=new y["Pb"],n=new y["wc"],o=this.scale/(1+this.scale);for(let r=0;r<e.count;++r){if(e.getMatrixAt(r,t),t.decompose(s,i,n),this.isExplodeUp){const e=(s.z-this.position.z)*o;s.setZ(s.z-e)}else{const e=s.clone().sub(this.position);e.x*=o,e.y*=o,e.z*=o,s.sub(e)}t.setPosition(s),e.setMatrixAt(r,t)}e.matrixWorldNeedsUpdate=!0,e.instanceMatrix.needsUpdate=!0}else{const t=e.position.clone(),s=this.scale/(1+this.scale);if(this.isExplodeUp){const i=(t.z-this.position.z)*s;e.position.setZ(t.z-i)}else{const i=t.sub(this.position);i.x*=s,i.y*=s,i.z*=s,e.position.sub(i)}}e.updateMatrix()})}else console.log("[EXP] No children to explode!")}setOnlyExplodeUp(e){this.isExplodeUp=e}getObjectCenter(e){const t=new y["h"];if(!this.objectId)return void console.log("[EXP] Invalid objectId: "+this.objectId);const s=this.scene.getObjectById(this.objectId);s&&s.children?(s.traverse(e=>{t.expandByObject(e)}),t.getCenter(e)):console.log("[EXP] No children to explode!")}}ne.DEFAULT_SCALE=1;class oe{static getVisibleObjectBoundingBox(e){const t=new y["h"];return e.traverseVisible(e=>{e instanceof y["nb"]&&!1!==e.userData.selectable&&t.expandByObject(e)}),t}static getObjectsBoundingBox(e,t){const s=new y["h"];return t.forEach(t=>{const i=e.getObjectByProperty("uuid",t);if(i){const e=oe.getBoundingBox(i);e.isEmpty()||s.union(e)}}),s}static getBoundingBox(e,t=!0){const s=new y["h"];if(e instanceof y["R"])return oe.getInstancedMeshBoundingBox(e);if(0===e.children.length)return s.expandByObject(e),s;const i=e.children.length;let n=1;i>20&&(n=3),i>100&&(n=5),i>200&&(n=10),i>1e3&&(n=100),e.updateMatrixWorld(!1);for(let o=0;o<i;++o){const i=e.children[o];if(!t||o%n===0)if(i.updateMatrix(),i instanceof y["R"]){const e=oe.getInstancedMeshBoundingBox(i);s.union(e)}else s.expandByObject(i)}return s}static getInstancedMeshBoundingBox(e){const t=new y["h"],s=new y["mb"];for(let i=0;i<e.count;++i){e.getMatrixAt(i,s);const n=e.geometry.clone();if(n.boundingBox){const e=n.boundingBox.applyMatrix4(s);e.isEmpty()||isNaN(e.min.x)||isNaN(e.min.y)||isNaN(e.min.z)||isNaN(e.max.x)||isNaN(e.max.y)||isNaN(e.max.z)||t.union(e)}}return t.applyMatrix4(e.matrixWorld),t}static explodeObject(e,t,s,i=!1){s[e.id]&&s[e.id].unexplode();const n=new y["wc"];oe.getPositionCenter(e,n);const o=new ne(t,e.id,n);o.setOnlyExplodeUp(i),o.explode(),s[e.id]=o}static explodeObjects(e,t,s,i=!1){return e.traverse(n=>{s.find(e=>e===n.uuid)&&(n.children&&1===n.children.length?oe.explodeObject(n.children[0],e,t,i):oe.explodeObject(n,e,t,i))}),t}static unexplodeObjects(e,t){e.traverse(e=>{const s=t[e.id];s&&(s.unexplode(),delete t[e.id])})}static getPositionCenter(e,t){const s=oe.getBoundingBox(e);s.getCenter(t),t.y=s.min.y}}class re{static resetObjectStyle(e){this.revertWireframeMode(e),this.revertObjectOpacity(e,[]),this.revertVisibleForFloors(e)}static resetObjectStyleByUuid(e,t){const s=this.getObjectByUuid(e,t);this.resetObjectStyle(s)}static setObjectOpacity(e,t=.3,s,i){const n=[],o=e=>{n.find(t=>t.uuid===e.uuid)||(n.push({uuid:e.uuid,opacity:e.opacity,transparent:e.transparent}),e.opacity*=t,e.transparent=!0)},r=e=>{const s=n.find(t=>t.uuid===e.uuid);if(!s){const s=e.clone();return n.push({uuid:e.uuid,opacity:e.opacity,transparent:e.transparent,material:e,clonedMaterial:s}),s.opacity*=t,s.transparent=!0,s}return s.clonedMaterial};return e.traverse(e=>{if((!i||-1===i.indexOf(e.uuid))&&(!s||-1!==s.indexOf(e.uuid))&&e instanceof y["nb"]){const t=e;if(s){if(Array.isArray(t.material)){const e=[];t.material.forEach(t=>{const s=r(t);s&&e.push(s)}),t.material=e}else if(t.material){const e=r(t.material);e&&(t.material=e)}}else if(Array.isArray(t.material))t.material.forEach(e=>{o(e)});else if(t.material){const e=t.material;o(e)}}}),n}static revertObjectOpacity(e,t,s,i){const n=e=>{const s=t.find(t=>t.uuid===e.uuid);s?(e.opacity=s.opacity,e.transparent=s.transparent):e.opacity=1},o=e=>{const s=t.find(t=>t.clonedMaterial&&t.clonedMaterial.uuid===e.uuid);if(s)return s.material};e.traverse(e=>{if((!i||-1===i.indexOf(e.uuid))&&(!s||-1!==s.indexOf(e.uuid))&&e instanceof y["nb"])if(s){if(Array.isArray(e.material)){const t=[];e.material.forEach(e=>{const s=o(e);s&&t.push(s)}),e.material=t}else if(e.material){const t=o(e.material);t&&(e.material=t)}}else if(Array.isArray(e.material))e.material.forEach(e=>{n(e)});else if(e.material){const t=e.material;n(t)}})}static setObjectOpacityByUuid(e,t,s=.3,i,n){const o=e.getObjectByProperty("uuid",t);if(!o)throw new Error("Failed to find object by uuid: "+t);return re.setObjectOpacity(o,s,i,n)}static revertObjectOpacityByUuid(e,t,s,i,n){const o=e.getObjectByProperty("uuid",t);if(!o)throw new Error("Failed to find object by uuid: "+t);re.revertObjectOpacity(o,s,i,n)}static explodeObject(e,t,s=!1){const i=new y["wc"];oe.getPositionCenter(t,i);const n=new ne(e,t.id,i);return n.setOnlyExplodeUp(s),n.explode(),n}static unexplodeObject(e){if(!e)throw new Error("Invalid exploder!");e.unexplode()}static setWireframeMode(e){const t=new y["ob"]({color:16732160,wireframe:!0,transparent:!0,opacity:.8});e.traverseVisible(e=>{if(e instanceof y["nb"]){const s=e;s.userData.materialForWireframe=s.material,s.material=t}})}static setWireframeModeByUuid(e,t){const s=e.getObjectByProperty("uuid",t);if(!s)throw new Error("Failed to find object by uuid: "+t);re.setWireframeMode(s)}static revertWireframeMode(e){e.traverseVisible(e=>{e instanceof y["nb"]&&e.userData.materialForWireframe&&(e.material=e.userData.materialForWireframe,e.userData.materialForWireframe=void 0)})}static revertWireframeModeByUuid(e,t){const s=e.getObjectByProperty("uuid",t);if(!s)throw new Error("Failed to find object by uuid: "+t);re.revertWireframeMode(s)}static findInner(e,t,s=[],i=!1){const n=t.toLowerCase(),o=[],r=e=>-1!==e.toLowerCase().indexOf(n),a=e=>-1!==e.toString().indexOf(n),c=e=>{if(e.name&&-1!==e.name.toLowerCase().indexOf(n))return!0;if(e.gltfExtensions){const t=e.gltfExtensions,s=t.objectId&&t.objectId.Value||t.elementId&&t.elementId.Value;if(s&&-1!==s.toLowerCase().indexOf(n))return!0}return!1};if(s.length>0)for(let l=0;l<s.length;++l){const t=s[l],n=e.getObjectByProperty("uuid",t);if(n&&n.traverse(e=>{(r(e.name)||a(e.id)||c(e.userData))&&o.push(e)}),i&&o.length>0)return[o[0]]}else if(e.traverse(e=>{(r(e.name)||a(e.id)||c(e.userData))&&o.push(e)}),i&&o.length>0)return[o[0]];return o}static find(e,t,s=[],i=!1){return this.findInner(e,t,s)}static findFirst(e,t,s=[],i=!1){const n=this.findInner(e,t,s,!0);if(n.length>0)return n[0]}static getFloorsFromString(e){const t=[],s=new RegExp(/(?:-?(?:\d+(?:\.5)?)F)(?=\W|$)/,"g"),i=s.exec(e);return i&&i.length>0&&i.forEach(e=>{if(e){const s=e.replace("F",""),i=Number(s);i?t.push(i):console.log("[OU] invalid floor: "+e)}}),t}static matchFloor(e,t){const s=this.getFloorsFromString(e),i=s.findIndex(e=>e===t);return-1!==i}static matchFloors(e,t){const s=this.getFloorsFromString(e),i=s.findIndex(e=>{const s=t.findIndex(t=>t===e);return-1!==s});return-1!==i}static distinctFloors(e,t){const s=[],i=e=>{const t=this.getFloorsFromString(e);t.forEach(e=>{s[e]=!0})};return t.forEach(t=>{const s=e.getObjectByProperty("uuid",t);s&&s.traverse(e=>{if(i(e.name),e.userData.gltfExtensions){const t=e.userData.gltfExtensions;t.level&&t.level.Value&&i(t.level.Value)}})}),Object.keys(s).sort()}static traverseObjectByFloors(e,t,s,i,n){const o=e.getObjectByProperty("uuid",t);if(!o)return[];o.traverse(e=>{let t=this.matchFloors(e.name,s);if(!t&&e.userData&&e.userData.gltfExtensions){const i=e.userData.gltfExtensions;i.level&&i.level.Value&&(t=this.matchFloors(i.level.Value,s))}t&&i&&i(e),!t&&n&&n(e)})}static setVisibleForFloors(e,t,s,i=!0){this.traverseObjectByFloors(e,t,s,e=>{let t=e;while(t)t.visible=!0,t=t.parent||void 0},e=>{i&&(e.visible=!1)})}static revertVisibleForFloors(e){e.traverse(e=>{e.visible=!0})}static revertVisibleForFloorsByUuid(e,t){const s=this.getObjectByUuid(e,t);this.revertVisibleForFloors(s)}static getObjectByUuid(e,t){const s=e.getObjectByProperty("uuid",t);if(!s)throw new Error("Failed to find object by uuid: "+t);return s}static addOutlines(e,t=this.OUTLINE_MATERIAL.clone(),s={visibleOnly:!0,meshOnly:!0,replaceOriginalObject:!1}){if(!e)return[];if(0===e.children.length&&(s.visibleOnly&&!e.visible||s.meshOnly&&!(e instanceof y["nb"])))return[];const i=e,n=i.children.length;if(n>0)for(let a=n-1;a>=0;--a){const e=i.children[a],n=this.addOutlines(e,t,s);n.forEach(e=>e.applyMatrix4(i.matrixWorld))}if(!i.geometry)return[];const o=(e,s)=>{const i=new y["A"](e,5);i.applyMatrix4(s);const n=new y["ab"](i,t);return n.userData.selectable=!1,n.userData.isOutline=!0,n.matrixAutoUpdate=ie,n.updateMatrix(),n},r=[];if(i instanceof y["R"])for(let a=0;a<i.count;++a){const e=new y["mb"];i.getMatrixAt(a,e);const t=o(i.geometry,e);if(s.replaceOriginalObject&&i.parent){const e=i.parent;e.children.push(t)}else i.children.push(t);r.push(t)}else{const e=o(i.geometry,i.matrix);if(s.replaceOriginalObject&&i.parent){i.removeFromParent(),i.geometry.dispose();const t=i.parent;t.children.push(e)}else i.children.push(e);r.push(e)}return r}static removeOutlines(e){if(e&&Array.isArray(e.children))for(let t=e.children.length-1;t>=0;--t){const s=e.children[t];s.children.length>0&&this.removeOutlines(s),s.userData.isOutline&&e.remove(s)}}static hasOutline(e){let t=!1;for(let s=0;s<e.children.length;++s){const i=e.children[s];if(i.userData.isOutline){t=!0;break}if(i.children.length>0&&(t=this.hasOutline(i),t))break}return t}static setOutlinesVisibility(e,t){e.traverse(e=>{e.userData.isOutline&&(e.visible=t)})}}re.OUTLINE_MATERIAL=new y["Y"]({name:"outline",color:0,transparent:!0,opacity:.2});class ae{constructor(e,t,s,i){this.isOpen=!1,this.boxMin=new y["wc"],this.boxMax=new y["wc"],this.group=new y["M"],this.planes=[],this.vertices=[new y["wc"],new y["wc"],new y["wc"],new y["wc"],new y["wc"],new y["wc"],new y["wc"],new y["wc"]],this.faces=[],this.lines=[],this.raycaster=new y["Tb"],this.mousePosition=new y["vc"],this.activeFace=null,this.onMouseMove=e=>{this.updateMouseAndRay(e);const t=this.raycaster.intersectObjects(this.faces);if(t.length){this.renderer.domElement.style.cursor="pointer";const e=t[0].object;e!==this.activeFace&&(this.activeFace&&this.activeFace.setActive(!1),e.setActive(!0),this.activeFace=e)}else this.activeFace&&(this.activeFace.setActive(!1),this.activeFace=null,this.renderer.domElement.style.cursor="auto")},this.onMouseDown=e=>{const t=0===e.button;if(this.activeFace&&t){this.updateMouseAndRay(e);const t=this.raycaster.intersectObjects(this.faces);if(t.length){const e=t[0].object,s=e.axis,i=t[0].point;this.drag.start(s,i)}}},this.drag={axis:"",point:new y["wc"],ground:new y["nb"](new y["Jb"](1e6,1e6),new y["ob"]({colorWrite:!1,depthWrite:!1})),start:(e,t)=>{this.drag.axis=e,this.drag.point=t,this.drag.initGround(),this.controls.enablePan=!1,this.controls.enableZoom=!1,this.controls.enableRotate=!1,this.renderer.domElement.style.cursor="move",window.removeEventListener("pointermove",this.onMouseMove),window.addEventListener("pointermove",this.drag.mousemove),window.addEventListener("pointerup",this.drag.mouseup)},end:()=>{this.scene.remove(this.drag.ground),this.controls.enablePan=!0,this.controls.enableZoom=!0,this.controls.enableRotate=!0,window.removeEventListener("pointermove",this.drag.mousemove),window.removeEventListener("pointerup",this.drag.mouseup),window.addEventListener("pointermove",this.onMouseMove)},mousemove:e=>{this.updateMouseAndRay(e);const t=this.raycaster.intersectObject(this.drag.ground);t.length&&this.drag.updateSectionBox(t[0].point)},mouseup:()=>{this.drag.end()},initGround:()=>{const e={xLeft:new y["wc"](-1,0,0),xRight:new y["wc"](1,0,0),yDown:new y["wc"](0,-1,0),yUp:new y["wc"](0,1,0),zBack:new y["wc"](0,0,-1),zFront:new y["wc"](0,0,1)};["xLeft","xRight"].includes(this.drag.axis)?this.drag.point.setX(0):["yDown","yUp"].includes(this.drag.axis)?this.drag.point.setY(0):["zBack","zFront"].includes(this.drag.axis)&&this.drag.point.setZ(0),this.drag.ground.position.copy(this.drag.point);const t=this.camera.position.clone().sub(this.camera.position.clone().projectOnVector(e[this.drag.axis])).add(this.drag.point);this.drag.ground.lookAt(t),this.scene.add(this.drag.ground)},updateSectionBox:e=>{const t=ae.MIN_WIDTH;switch(this.drag.axis){case"yUp":this.boxMax.setY(Math.max(this.boxMin.y+t,e.y));break;case"yDown":this.boxMin.setY(Math.min(this.boxMax.y-t,e.y));break;case"xLeft":this.boxMin.setX(Math.min(this.boxMax.x-t,e.x));break;case"xRight":this.boxMax.setX(Math.max(this.boxMin.x+t,e.x));break;case"zFront":this.boxMax.setZ(Math.max(this.boxMin.z+t,e.z));break;case"zBack":this.boxMin.setZ(Math.min(this.boxMax.z-t,e.z));break}this.updatePlanes(),this.initOrUpdateVertices(),this.initOrUpdateFaces(),this.initOrUpdateLines()}},this.scene=e,this.camera=t,this.renderer=s,this.controls=i}setSectionBox(e){if(this.sectionBox)throw new Error("sectionBox is assigned already!");this.sectionBox=e}open(){this.initSectionBox(),this.addMouseListener(),this.isOpen=!0}close(){this.isOpen=!1,this.removeMouseListener(),this.clearSectionBox()}reset(){this.close(),this.open()}initSectionBox(){if(!this.sectionBox)throw new Error("Need to set sectionBox first!");this.boxMin=this.sectionBox.min,this.boxMax=this.sectionBox.max,this.group=new y["M"],this.initPlanes(),this.initOrUpdateVertices(),this.initOrUpdateFaces(),this.initOrUpdateLines(),this.scene.add(this.group)}initPlanes(){this.planes=[],this.planes.push(new y["Ib"](new y["wc"](0,-1,0),this.boxMax.y),new y["Ib"](new y["wc"](0,1,0),-this.boxMin.y),new y["Ib"](new y["wc"](1,0,0),-this.boxMin.x),new y["Ib"](new y["wc"](-1,0,0),this.boxMax.x),new y["Ib"](new y["wc"](0,0,-1),this.boxMax.z),new y["Ib"](new y["wc"](0,0,1),-this.boxMin.z))}updatePlanes(){this.planes[0].constant=this.boxMax.y,this.planes[1].constant=-this.boxMin.y,this.planes[2].constant=-this.boxMin.x,this.planes[3].constant=this.boxMax.x,this.planes[4].constant=this.boxMax.z,this.planes[5].constant=-this.boxMin.z}initOrUpdateVertices(){this.vertices[0].set(this.boxMin.x,this.boxMax.y,this.boxMin.z),this.vertices[1].set(this.boxMax.x,this.boxMax.y,this.boxMin.z),this.vertices[2].set(this.boxMax.x,this.boxMax.y,this.boxMax.z),this.vertices[3].set(this.boxMin.x,this.boxMax.y,this.boxMax.z),this.vertices[4].set(this.boxMin.x,this.boxMin.y,this.boxMin.z),this.vertices[5].set(this.boxMax.x,this.boxMin.y,this.boxMin.z),this.vertices[6].set(this.boxMax.x,this.boxMin.y,this.boxMax.z),this.vertices[7].set(this.boxMin.x,this.boxMin.y,this.boxMax.z)}initOrUpdateFaces(){const e=this.vertices;if(this.faces&&0!==this.faces.length){const t=this.faces;t[0].setFromPoints([e[0],e[1],e[2],e[3]]),t[1].setFromPoints([e[4],e[7],e[6],e[5]]),t[2].setFromPoints([e[0],e[3],e[7],e[4]]),t[3].setFromPoints([e[1],e[5],e[6],e[2]]),t[4].setFromPoints([e[2],e[6],e[7],e[3]]),t[5].setFromPoints([e[0],e[4],e[5],e[1]])}else this.faces=[],this.faces.push(new le("yUp",[e[0],e[1],e[2],e[3]]),new le("yDown",[e[4],e[7],e[6],e[5]]),new le("xLeft",[e[0],e[3],e[7],e[4]]),new le("xRight",[e[1],e[5],e[6],e[2]]),new le("zFront",[e[2],e[6],e[7],e[3]]),new le("zBack",[e[0],e[4],e[5],e[1]])),this.group.add(...this.faces),this.faces.forEach(e=>{this.group.add(e.backFace)})}initOrUpdateLines(){const e=this.vertices;if(this.lines&&0!==this.lines.length){let t=0;this.lines[t++].setFromPoints([e[0],e[1]]),this.lines[t++].setFromPoints([e[1],e[2]]),this.lines[t++].setFromPoints([e[2],e[3]]),this.lines[t++].setFromPoints([e[3],e[0]]),this.lines[t++].setFromPoints([e[4],e[5]]),this.lines[t++].setFromPoints([e[5],e[6]]),this.lines[t++].setFromPoints([e[6],e[7]]),this.lines[t++].setFromPoints([e[7],e[4]]),this.lines[t++].setFromPoints([e[0],e[4]]),this.lines[t++].setFromPoints([e[1],e[5]]),this.lines[t++].setFromPoints([e[2],e[6]]),this.lines[t++].setFromPoints([e[3],e[7]])}else{const t=this.faces;if(!t)throw Error("Need to init Face first!");this.lines=[],this.lines.push(new ce([e[0],e[1]],[t[0],t[5]]),new ce([e[1],e[2]],[t[0],t[3]]),new ce([e[2],e[3]],[t[0],t[4]]),new ce([e[3],e[0]],[t[0],t[2]]),new ce([e[4],e[5]],[t[1],t[5]]),new ce([e[5],e[6]],[t[1],t[3]]),new ce([e[6],e[7]],[t[1],t[4]]),new ce([e[7],e[4]],[t[1],t[2]]),new ce([e[0],e[4]],[t[2],t[5]]),new ce([e[1],e[5]],[t[3],t[5]]),new ce([e[2],e[6]],[t[3],t[4]]),new ce([e[3],e[7]],[t[2],t[4]])),this.group.add(...this.lines)}}clearSectionBox(){this.scene.remove(this.group),this.renderer.domElement.style.cursor=""}addMouseListener(){window.addEventListener("pointermove",this.onMouseMove),window.addEventListener("pointerdown",this.onMouseDown)}removeMouseListener(){window.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("pointerdown",this.onMouseDown)}updateMouseAndRay(e){this.mousePosition.setX(e.clientX/window.innerWidth*2-1),this.mousePosition.setY(-e.clientY/window.innerHeight*2+1),this.raycaster.setFromCamera(this.mousePosition,this.camera)}}ae.MIN_WIDTH=1;class ce extends y["ab"]{constructor(e,t){super(),this.normalMaterial=new y["Y"]({color:7951688}),this.activeMaterial=new y["Y"]({color:5125166}),t.forEach(e=>e.lines.push(this)),this.geometry=new y["k"],this.geometry.setFromPoints(e),this.material=this.normalMaterial}setFromPoints(e){this.geometry.setFromPoints(e)}setActive(e){this.material=e?this.activeMaterial:this.normalMaterial}}class le extends y["nb"]{constructor(e,t){super(),this.lines=[],this.axis=e,this.lines=[],this.geometry=new y["k"],this.geometry.setFromPoints(t),this.geometry.setIndex([0,3,2,0,2,1]),this.geometry.computeVertexNormals(),this.material=new y["ob"]({colorWrite:!1,depthWrite:!1});const s=new y["ob"]({color:11648971,transparent:!0,opacity:.3,side:y["f"]});this.backFace=new y["nb"](this.geometry,s)}setFromPoints(e){this.geometry.setFromPoints(e)}setActive(e){this.lines.forEach(t=>{t.setActive(e)})}}class de extends ae{constructor(e,t,s,i,n){super(t,s,i,n),this.objectUuids=e;const o=new y["h"];this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&o.expandByObject(t)}),o.expandByScalar(1.5),super.setSectionBox(o)}initPlanes(){super.initPlanes(),this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&t.traverse(e=>{["Mesh","LineSegments"].includes(e.type)&&(e.material.clippingPlanes=this.planes,e.material.clipIntersection=!1)})})}clearSectionBox(){super.clearSectionBox(),this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&t.traverse(e=>{["Mesh","LineSegments"].includes(e.type)&&(e.material.clippingPlanes=[])})})}}class he{constructor(e,t,s,i){this.isOpen=!1,this.isSectionObjectVisible=!0,this.boxMin=new y["wc"],this.boxMax=new y["wc"],this.group=new y["M"],this.planes=[],this.vertices=[new y["wc"],new y["wc"],new y["wc"],new y["wc"]],this.controllerMarkers=[],this.lines=[],this.normalMarkerOpacity=.5,this.activeMarkerOpacity=1,this.normalColor=5125166,this.activeColor=5125166,this.raycaster=new y["Tb"],this.mousePosition=new y["vc"],this.activeFace=void 0,this.activeMarker=void 0,this.onMouseMove=e=>{if(!this.isSectionObjectVisible)return;this.updateMouseAndRay(e);const t=this.raycaster.intersectObject(this.group,!0);if(t.length){this.renderer.domElement.style.cursor="pointer";const e=t.filter(e=>e&&e.object&&e.object instanceof y["ic"]),s=t.filter(e=>e&&e.object&&e.object instanceof pe);if(e.length>0?(this.activeMarker=e[0].object,this.activeMarker.material.opacity=this.activeMarkerOpacity,this.activeMarker.material.color.set(this.activeColor)):this.activeMarker&&(this.activeMarker.material.opacity=this.normalMarkerOpacity,this.activeMarker.material.color.set(this.normalColor),this.activeMarker=void 0),s.length>0&&!this.activeMarker){const e=s[0].object;e!==this.activeFace&&(this.activeFace&&this.activeFace.setActive(!1),e.setActive(!0),this.activeFace=e)}else this.activeFace&&(this.activeFace.setActive(!1),this.activeFace=void 0);this.activeMarker||this.activeFace||(this.renderer.domElement.style.cursor="auto")}},this.onMouseDown=e=>{if(!this.isSectionObjectVisible)return;const t=0===e.button;if(t)if(this.activeMarker){this.updateMouseAndRay(e);const t=this.raycaster.intersectObject(this.group,!0);if(t.length){const e=this.activeMarker.name,s=t[0].point;this.drag.start(e,s)}}else if(this.activeFace&&this.face){this.updateMouseAndRay(e);const t=this.raycaster.intersectObject(this.face);if(t.length){const e=t[0].object,s=e.axis,i=t[0].point;this.drag.start(s,i)}}},this.drag={axis:"",point:new y["wc"],ground:new y["nb"](new y["Jb"](1e6,1e6),new y["ob"]({colorWrite:!1,depthWrite:!1})),start:(e,t)=>{this.drag.axis=e,this.drag.point=t,this.drag.initGround(),this.controls.enablePan=!1,this.controls.enableZoom=!1,this.controls.enableRotate=!1,this.renderer.domElement.style.cursor="move",window.removeEventListener("pointermove",this.onMouseMove),window.addEventListener("pointermove",this.drag.mousemove),window.addEventListener("pointerup",this.drag.mouseup)},end:()=>{this.scene.remove(this.drag.ground),this.controls.enablePan=!0,this.controls.enableZoom=!0,this.controls.enableRotate=!0,window.removeEventListener("pointermove",this.drag.mousemove),window.removeEventListener("pointerup",this.drag.mouseup),window.addEventListener("pointermove",this.onMouseMove)},mousemove:e=>{this.updateMouseAndRay(e);const t=this.raycaster.intersectObject(this.drag.ground);t.length&&this.drag.updateSectionPlane(t[0].point)},mouseup:()=>{this.drag.end()},initGround:()=>{const e=this.drag.axis,t={yUp:new y["wc"](0,1,0),xLeft:new y["wc"](-1,0,0),zFront:new y["wc"](0,0,1),xRight:new y["wc"](1,0,0),zBack:new y["wc"](0,0,-1)};["xLeft","xRight"].includes(e)?this.drag.point.setX(0):["yUp"].includes(e)?this.drag.point.setY(0):["zBack","zFront"].includes(e)&&this.drag.point.setZ(0),this.drag.ground.position.copy(this.drag.point);const s=this.camera.position.clone().sub(this.camera.position.clone().projectOnVector(t[e])).add(this.drag.point);this.drag.ground.lookAt(s),this.scene.add(this.drag.ground)},updateSectionPlane:e=>{const t=this.drag.axis,s=he.MIN_WIDTH;switch(t){case"yUp":this.boxMax.y=e.y,this.boxMin.y=e.y;break;case"xLeft":this.boxMin.setX(Math.min(this.boxMax.x-s,e.x));break;case"zFront":this.boxMax.setZ(Math.max(this.boxMin.z+s,e.z));break;case"xRight":this.boxMax.setX(Math.max(this.boxMin.x+s,e.x));break;case"zBack":this.boxMin.setZ(Math.min(this.boxMax.z-s,e.z));break}this.updatePlanes(),this.initOrUpdateVertices(),this.initOrUpdateFace(),this.initOrUpdateLines()}},this.scene=e,this.camera=t,this.renderer=s,this.controls=i}setSectionPlane(e){if(this.boundingBox)throw new Error("boundingBox is assigned already!");const t=(e.min.y+e.max.y)/2;this.boxMin.set(e.min.x,t,e.min.z),this.boxMax.set(e.max.x,t,e.max.z)}setSectionObjectVisible(e){this.isSectionObjectVisible=e,this.group&&this.group.traverse(t=>{t.visible=e})}open(){this.initSectionPlane(),this.setSectionObjectVisible(this.isSectionObjectVisible),this.addMouseListener(),this.isOpen=!0}close(){this.isOpen=!1,this.removeMouseListener(),this.clearSectionPlane()}reset(){this.close(),this.open()}setMatrix(e){this.group.applyMatrix4(e),this.planes.forEach(t=>t.applyMatrix4(e))}initSectionPlane(){this.group=new y["M"],this.initPlanes(),this.initOrUpdateVertices(),this.initOrUpdateFace(),this.initOrUpdateLines(),this.scene.add(this.group)}initPlanes(){this.planes=[],this.planes.push(new y["Ib"](new y["wc"](0,-1,0)),new y["Ib"](new y["wc"](-1,0,0)),new y["Ib"](new y["wc"](0,0,1)),new y["Ib"](new y["wc"](1,0,0)),new y["Ib"](new y["wc"](0,0,-1))),this.updatePlanes()}updatePlanes(){this.planes[0].constant=this.boxMax.y,this.planes[1].constant=this.boxMin.x,this.planes[2].constant=-this.boxMax.z,this.planes[3].constant=-this.boxMax.x,this.planes[4].constant=this.boxMin.z}initOrUpdateVertices(){const e=this.boxMax.y;this.vertices[0].set(this.boxMin.x,e,this.boxMin.z),this.vertices[1].set(this.boxMin.x,e,this.boxMax.z),this.vertices[2].set(this.boxMax.x,e,this.boxMax.z),this.vertices[3].set(this.boxMax.x,e,this.boxMin.z);const t=(e,t,s,i)=>{if(s)s.position.set((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2);else{const s=new y["wc"]((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),n=this.createPointMarker(s,i);this.controllerMarkers.push(n),this.group.add(n)}},s=this.vertices;0===this.controllerMarkers.length?(t(s[0],s[1],void 0,"xLeft"),t(s[1],s[2],void 0,"zFront"),t(s[2],s[3],void 0,"xRight"),t(s[3],s[0],void 0,"zBack")):(t(s[0],s[1],this.controllerMarkers[0]),t(s[1],s[2],this.controllerMarkers[1]),t(s[2],s[3],this.controllerMarkers[2]),t(s[3],s[0],this.controllerMarkers[3]))}initOrUpdateFace(){const e=this.vertices;if(this.face)this.face.setFromPoints(e);else{let t=0;this.face=new pe("yUp",[e[t++],e[t++],e[t++],e[t++]]),this.group.add(this.face)}}initOrUpdateLines(){const e=this.vertices;if(this.lines&&0!==this.lines.length){let t=0;this.lines[t].setFromPoints([e[t],e[++t]]),this.lines[t].setFromPoints([e[t],e[++t]]),this.lines[t].setFromPoints([e[t],e[++t]]),this.lines[t].setFromPoints([e[t],e[0]])}else{const t=this.face;if(!t)throw Error("Need to init Face first!");this.lines=[],this.lines.push(new ue([e[0],e[1]],[t]),new ue([e[1],e[2]],[t]),new ue([e[2],e[3]],[t]),new ue([e[3],e[0]],[t])),this.group.add(...this.lines)}}clearSectionPlane(){this.scene.remove(this.group),this.renderer.domElement.style.cursor=""}addMouseListener(){window.addEventListener("pointermove",this.onMouseMove),window.addEventListener("pointerdown",this.onMouseDown)}removeMouseListener(){window.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("pointerdown",this.onMouseDown)}updateMouseAndRay(e){this.mousePosition.setX(e.clientX/window.innerWidth*2-1),this.mousePosition.setY(-e.clientY/window.innerHeight*2+1),this.raycaster.setFromCamera(this.mousePosition,this.camera)}initPointMarkerMaterial(){const e=(new y["nc"]).load("images/circle.png");this.spriteMaterial=new y["jc"]({map:e,color:this.normalColor,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,opacity:this.normalMarkerOpacity})}createPointMarker(e,t=""){this.spriteMaterial||this.initPointMarkerMaterial();const s=e,i=.015,n=new y["ic"](this.spriteMaterial);return n.scale.set(i,i,i),s&&n.position.set(s.x,s.y,s.z),n.name=t,n}}he.MIN_WIDTH=1;class ue extends y["ab"]{constructor(e,t){super(),this.normalMaterial=new y["Y"]({color:7951688}),this.activeMaterial=new y["Y"]({color:5125166}),t.forEach(e=>e.lines.push(this)),this.geometry=new y["k"],this.geometry.setFromPoints(e),this.material=this.normalMaterial}setFromPoints(e){this.geometry.setFromPoints(e)}setActive(e){this.material=e?this.activeMaterial:this.normalMaterial}}class pe extends y["nb"]{constructor(e,t){super(),this.lines=[],this.axis=e,this.lines=[],this.geometry=new y["k"],this.geometry.setFromPoints(t),this.geometry.setIndex([0,3,2,0,2,1]),this.geometry.computeVertexNormals(),this.material=new y["ob"]({colorWrite:!1,depthWrite:!1,side:y["x"]})}setFromPoints(e){this.geometry.setFromPoints(e)}setActive(e){this.lines.forEach(t=>{t.setActive(e)})}}class me extends he{constructor(e,t,s,i,n){super(t,s,i,n),this.objectUuids=e;const o=new y["h"];this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&o.expandByObject(t)}),o.expandByScalar(1.5),super.setSectionPlane(o)}initSectionPlane(){super.initSectionPlane(),this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&t.traverse(e=>{["Mesh","LineSegments"].includes(e.type)&&(e.material.clippingPlanes=this.planes,e.material.clipIntersection=!0)})})}clearSectionPlane(){super.clearSectionPlane(),this.objectUuids.forEach(e=>{const t=this.scene.getObjectByProperty("uuid",e);t&&t.traverse(e=>{["Mesh","LineSegments"].includes(e.type)&&(e.material.clippingPlanes=[])})})}}var ge=s("b372"),fe=s.n(ge);let be=class extends g["d"]{constructor(){super(...arguments),this.minWidth=150,this.maxWidth=600,this.minHeight=200,this.maxHeight=800}close(){}resize(){}mounted(){}dragHandler(e){const t=this.$refs.basePanel,s=this.findRelativeParentElement(t),i=e.clientX-t.offsetLeft,n=e.clientY-t.offsetTop;t.setCapture&&t.setCapture(),document.onmousemove=function(e){e.preventDefault();let o=e.clientX-i,r=e.clientY-n;const a=s.offsetWidth,c=s.offsetHeight,l=t.offsetWidth,d=t.offsetHeight;o=Math.min(Math.max(o,0),a-l),r=Math.min(Math.max(r,0),c-d),t.style.left=o+"px",t.style.top=r+"px"},document.onmouseup=function(){document.onmousemove=document.onmousedown=null,t.releaseCapture&&t.releaseCapture()}}resizeHandler(e){const t=this.$refs.basePanel,s=this.findRelativeParentElement(t),i=t.offsetWidth,n=t.offsetHeight,o=e.clientX-(t.offsetLeft+i),r=e.clientY-(t.offsetTop+n);t.setCapture&&t.setCapture(),document.onmousemove=e=>{e.preventDefault();let i=e.clientX-o-t.offsetLeft,n=e.clientY-r-t.offsetTop;const a=s.offsetWidth,c=s.offsetHeight;i=Math.min(Math.max(i,this.minWidth),Math.min(a-t.offsetLeft,this.maxWidth)),n=Math.min(Math.max(n,this.minHeight),Math.min(c-t.offsetTop,this.maxHeight)),t.style.width=i+"px",t.style.height=n+"px",this.resize()},document.onmouseup=()=>{document.onmousemove=document.onmousedown=null,t.releaseCapture&&t.releaseCapture()}}findRelativeParentElement(e){const t=e.parentElement;return!t||t.offsetWidth?t:this.findRelativeParentElement(t)}beforeDestroy(){}render(){const e=arguments[0];return e("div",{class:fe.a.basePanel,ref:"basePanel"},[e("div",{class:"base-panel__header",on:{mousedown:this.dragHandler}},[e("span",{class:"base-panel__header-title"},[this.$scopedSlots.header&&this.$scopedSlots.header({text:""}),!this.$scopedSlots.header&&"Title"]),e("el-button",{attrs:{type:"text",icon:"el-icon-close"},class:"base-panel__header-close",on:{click:this.close}})]),e("div",{class:"base-panel__body"},[this.$scopedSlots.content&&this.$scopedSlots.content({text:""})]),e("div",{class:"base-panel__footer"},[e("div",{class:"base-panel__footer-resize",on:{mousedown:this.resizeHandler}})])])}};Object(m["a"])([Object(g["b"])()],be.prototype,"close",null),Object(m["a"])([Object(g["b"])()],be.prototype,"resize",null),be=Object(m["a"])([g["a"]],be);var ve=be,we=function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-tree",class:{"el-tree--highlight-current":e.highlightCurrent,"is-dragging":!!e.dragState.draggingNode,"is-drop-not-allow":!e.dragState.allowDrop,"is-drop-inner":"inner"===e.dragState.dropType},attrs:{role:"tree"}},[e.height?t("virtual-list",{style:{height:e.height+"px","overflow-y":"auto"},attrs:{"data-key":e.getNodeKey,"data-sources":e.visibleList,"data-component":e.itemComponent,keeps:Math.ceil(e.height/22)+e.extraLine,"extra-props":{renderAfterExpand:e.renderAfterExpand,showCheckbox:e.showCheckbox,renderContent:e.renderContent,onNodeExpand:e.handleNodeExpand}}}):e._l(e.root.childNodes,(function(s){return t("el-tree-node",{key:e.getNodeKey(s),attrs:{node:s,props:e.props,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent},on:{"node-expand":e.handleNodeExpand}})})),e.isEmpty?t("div",{staticClass:"el-tree__empty-block"},[t("span",{staticClass:"el-tree__empty-text"},[e._v(e._s(e.emptyText))])]):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.dragState.showDropIndicator,expression:"dragState.showDropIndicator"}],ref:"dropIndicator",staticClass:"el-tree__drop-indicator"})],2)},ye=[],xe=(s("0fe4"),s("57f9"),s("339c"),s("0dbb"),s("f604"));const Ee="$treeNodeId",Oe=function(e,t){t&&!t[Ee]&&Object.defineProperty(t,Ee,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},Me=function(e,t){return e?t[e]:t[Ee]},Te=(e,t)=>{let s=e;while(s&&"BODY"!==s.tagName){if(s.__vue__&&s.__vue__.$options.name===t)return s.__vue__;s=s.parentNode}return null};var Ce=s("77c81");const Se=e=>{let t=!0,s=!0,i=!0;for(let n=0,o=e.length;n<o;n++){const o=e[n];(!0!==o.checked||o.indeterminate)&&(t=!1,o.disabled||(i=!1)),(!1!==o.checked||o.indeterminate)&&(s=!1)}return{all:t,none:s,allWithoutDisable:i,half:!t&&!s}},Pe=function(e){if(0===e.childNodes.length)return;const{all:t,none:s,half:i}=Se(e.childNodes);t?(e.checked=!0,e.indeterminate=!1):i?(e.checked=!1,e.indeterminate=!0):s&&(e.checked=!1,e.indeterminate=!1);const n=e.parent;n&&0!==n.level&&(e.store.checkStrictly||Pe(n))},je=function(e,t){const s=e.store.props,i=e.data||{},n=s[t];if("function"===typeof n)return n(i,e);if("string"===typeof n)return i[n];if("undefined"===typeof n){const e=i[t];return void 0===e?"":e}};let Ae=0;class ke{constructor(e){this.id=Ae++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1;for(let o in e)e.hasOwnProperty(o)&&(this[o]=e[o]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1);const t=this.store;if(!t)throw new Error("[Node]store is required!");t.registerNode(this);const s=t.props;if(s&&"undefined"!==typeof s.isLeaf){const e=je(this,"isLeaf");"boolean"===typeof e&&(this.isLeafByUser=e)}if(!0!==t.lazy&&this.data?(this.setData(this.data),t.defaultExpandAll&&(this.expanded=!0)):this.level>0&&t.lazy&&t.defaultExpandAll&&this.expand(),Array.isArray(this.data)||Oe(this,this.data),!this.data)return;const i=t.defaultExpandedKeys,n=t.key;n&&i&&-1!==i.indexOf(this.key)&&this.expand(null,t.autoExpandParent),n&&void 0!==t.currentNodeKey&&this.key===t.currentNodeKey&&(t.currentNode=this,t.currentNode.isCurrent=!0),t.lazy&&t._initDefaultCheckedNode(this),this.updateLeafState()}setData(e){let t;Array.isArray(e)||Oe(this,e),this.data=e,this.childNodes=[],t=0===this.level&&this.data instanceof Array?this.data:je(this,"children")||[];for(let s=0,i=t.length;s<i;s++)this.insertChild({data:t[s]})}get label(){return je(this,"label")}get key(){const e=this.store.key;return this.data?this.data[e]:null}get disabled(){return je(this,"disabled")}get nextSibling(){const e=this.parent;if(e){const t=e.childNodes.indexOf(this);if(t>-1)return e.childNodes[t+1]}return null}get previousSibling(){const e=this.parent;if(e){const t=e.childNodes.indexOf(this);if(t>-1)return t>0?e.childNodes[t-1]:null}return null}contains(e,t=!0){const s=function(i){const n=i.childNodes||[];let o=!1;for(let r=0,a=n.length;r<a;r++){const i=n[r];if(i===e||t&&s(i)){o=!0;break}}return o};return s(this)}remove(){const e=this.parent;e&&e.removeChild(this)}insertChild(e,t,s){if(!e)throw new Error("insertChild error: child is required.");if(!(e instanceof ke)){if(!s){const s=this.getChildren(!0);-1===s.indexOf(e.data)&&("undefined"===typeof t||t<0?s.push(e.data):s.splice(t,0,e.data))}Object(xe["a"])(e,{parent:this,store:this.store}),e=new ke(e)}e.level=this.level+1,"undefined"===typeof t||t<0?this.childNodes.push(e):this.childNodes.splice(t,0,e),this.updateLeafState()}insertBefore(e,t){let s;t&&(s=this.childNodes.indexOf(t)),this.insertChild(e,s)}insertAfter(e,t){let s;t&&(s=this.childNodes.indexOf(t),-1!==s&&(s+=1)),this.insertChild(e,s)}removeChild(e){const t=this.getChildren()||[],s=t.indexOf(e.data);s>-1&&t.splice(s,1);const i=this.childNodes.indexOf(e);i>-1&&(this.store&&this.store.deregisterNode(e),e.parent=null,this.childNodes.splice(i,1)),this.updateLeafState()}removeChildByData(e){let t=null;for(let s=0;s<this.childNodes.length;s++)if(this.childNodes[s].data===e){t=this.childNodes[s];break}t&&this.removeChild(t)}expand(e,t){const s=()=>{if(t){let e=this.parent;while(e.level>0)e.expanded=!0,e=e.parent}this.expanded=!0,e&&e()};this.shouldLoadData()?this.loadData(e=>{e instanceof Array&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||Pe(this),s())}):s()}doCreateChildren(e,t={}){e.forEach(e=>{this.insertChild(Object(xe["a"])({data:e},t),void 0,!0)})}collapse(){this.expanded=!1}shouldLoadData(){return!0===this.store.lazy&&this.store.load&&!this.loaded}updateLeafState(){if(!0===this.store.lazy&&!0!==this.loaded&&"undefined"!==typeof this.isLeafByUser)return void(this.isLeaf=this.isLeafByUser);const e=this.childNodes;!this.store.lazy||!0===this.store.lazy&&!0===this.loaded?this.isLeaf=!e||0===e.length:this.isLeaf=!1}setChecked(e,t,s,i){if(this.indeterminate="half"===e,this.checked=!0===e,this.store.checkStrictly)return;if(!this.shouldLoadData()||this.store.checkDescendants){let{all:s,allWithoutDisable:n}=Se(this.childNodes);this.isLeaf||s||!n||(this.checked=!1,e=!1);const o=()=>{if(t){const s=this.childNodes;for(let r=0,a=s.length;r<a;r++){const n=s[r];i=i||!1!==e;const o=n.disabled?n.checked:i;n.setChecked(o,t,!0,i)}const{half:n,all:o}=Se(s);o||(this.checked=o,this.indeterminate=n)}};if(this.shouldLoadData())return void this.loadData(()=>{o(),Pe(this)},{checked:!1!==e});o()}const n=this.parent;n&&0!==n.level&&(s||Pe(n))}getChildren(e=!1){if(0===this.level)return this.data;const t=this.data;if(!t)return null;const s=this.store.props;let i="children";return s&&(i=s.children||"children"),void 0===t[i]&&(t[i]=null),e&&!t[i]&&(t[i]=[]),t[i]}updateChildren(){const e=this.getChildren()||[],t=this.childNodes.map(e=>e.data),s={},i=[];e.forEach((e,n)=>{const o=e[Ee],r=!!o&&Object(Ce["a"])(t,e=>e[Ee]===o)>=0;r?s[o]={index:n,data:e}:i.push({index:n,data:e})}),this.store.lazy||t.forEach(e=>{s[e[Ee]]||this.removeChildByData(e)}),i.forEach(({index:e,data:t})=>{this.insertChild({data:t},e)}),this.updateLeafState()}loadData(e,t={}){if(!0!==this.store.lazy||!this.store.load||this.loaded||this.loading&&!Object.keys(t).length)e&&e.call(this);else{this.loading=!0;const s=s=>{this.loaded=!0,this.loading=!1,this.childNodes=[],this.doCreateChildren(s,t),this.updateLeafState(),e&&e.call(this,s)};this.store.load(this,s)}}}class _e{constructor(e){this.currentNode=null,this.currentNodeKey=null;for(let t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);if(this.nodesMap={},this.root=new ke({data:this.data,store:this}),this.lazy&&this.load){const e=this.load;e(this.root,e=>{this.root.doCreateChildren(e),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(e){const t=this.filterNodeMethod,s=this.lazy,i=function(n){const o=n.root?n.root.childNodes:n.childNodes;if(o.forEach(s=>{s.visible=t.call(s,e,s.data,s),i(s)}),!n.visible&&o.length){let e=!0;e=!o.some(e=>e.visible),n.root?n.root.visible=!1===e:n.visible=!1===e}e&&(!n.visible||n.isLeaf||s||n.expand())};i(this)}setData(e){const t=e!==this.root.data;t?(this.root.setData(e),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(e){if(e instanceof ke)return e;const t="object"!==typeof e?e:Me(this.key,e);return this.nodesMap[t]||null}insertBefore(e,t){const s=this.getNode(t);s.parent.insertBefore({data:e},s)}insertAfter(e,t){const s=this.getNode(t);s.parent.insertAfter({data:e},s)}remove(e){const t=this.getNode(e);t&&t.parent&&(t===this.currentNode&&(this.currentNode=null),t.parent.removeChild(t))}append(e,t){const s=t?this.getNode(t):this.root;s&&s.insertChild({data:e})}_initDefaultCheckedNodes(){const e=this.defaultCheckedKeys||[],t=this.nodesMap;e.forEach(e=>{const s=t[e];s&&s.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(e){const t=this.defaultCheckedKeys||[];-1!==t.indexOf(e.key)&&e.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(e){e!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=e,this._initDefaultCheckedNodes())}registerNode(e){const t=this.key;if(!t||!e||!e.data)return;const s=e.key;void 0!==s&&(this.nodesMap[e.key]=e)}deregisterNode(e){const t=this.key;t&&e&&e.data&&(e.childNodes.forEach(e=>{this.deregisterNode(e)}),delete this.nodesMap[e.key])}getCheckedNodes(e=!1,t=!1){const s=[],i=function(n){const o=n.root?n.root.childNodes:n.childNodes;o.forEach(n=>{(n.checked||t&&n.indeterminate)&&(!e||e&&n.isLeaf)&&s.push(n.data),i(n)})};return i(this),s}getCheckedKeys(e=!1){return this.getCheckedNodes(e).map(e=>(e||{})[this.key])}getHalfCheckedNodes(){const e=[],t=function(s){const i=s.root?s.root.childNodes:s.childNodes;i.forEach(s=>{s.indeterminate&&e.push(s.data),t(s)})};return t(this),e}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(e=>(e||{})[this.key])}_getAllNodes(){const e=[],t=this.nodesMap;for(let s in t)t.hasOwnProperty(s)&&e.push(t[s]);return e}updateChildren(e,t){const s=this.nodesMap[e];if(!s)return;const i=s.childNodes;for(let n=i.length-1;n>=0;n--){const e=i[n];this.remove(e.data)}for(let n=0,o=t.length;n<o;n++){const e=t[n];this.append(e,s.data)}}_setCheckedKeys(e,t=!1,s){const i=this._getAllNodes().sort((e,t)=>t.level-e.level),n=Object.create(null),o=Object.keys(s);i.forEach(e=>e.setChecked(!1,!1));for(let r=0,a=i.length;r<a;r++){const s=i[r],a=s.data[e].toString();let c=o.indexOf(a)>-1;if(!c){s.checked&&!n[a]&&s.setChecked(!1,!1);continue}let l=s.parent;while(l&&l.level>0)n[l.data[e]]=!0,l=l.parent;if(s.isLeaf||this.checkStrictly)s.setChecked(!0,!1);else if(s.setChecked(!0,!0),t){s.setChecked(!1,!1);const e=function(t){const s=t.childNodes;s.forEach(t=>{t.isLeaf||t.setChecked(!1,!1),e(t)})};e(s)}}}setCheckedNodes(e,t=!1){const s=this.key,i={};e.forEach(e=>{i[(e||{})[s]]=!0}),this._setCheckedKeys(s,t,i)}setCheckedKeys(e,t=!1){this.defaultCheckedKeys=e;const s=this.key,i={};e.forEach(e=>{i[e]=!0}),this._setCheckedKeys(s,t,i)}setDefaultExpandedKeys(e){e=e||[],this.defaultExpandedKeys=e,e.forEach(e=>{const t=this.getNode(e);t&&t.expand(null,this.autoExpandParent)})}setChecked(e,t,s){const i=this.getNode(e);i&&i.setChecked(!!t,s)}getCurrentNode(){return this.currentNode}setCurrentNode(e){const t=this.currentNode;t&&(t.isCurrent=!1),this.currentNode=e,this.currentNode.isCurrent=!0}setUserCurrentNode(e){const t=e[this.key],s=this.nodesMap[t];this.setCurrentNode(s)}setCurrentNodeKey(e){if(null===e||void 0===e)return this.currentNode&&(this.currentNode.isCurrent=!1),void(this.currentNode=null);const t=this.getNode(e);t&&this.setCurrentNode(t)}}var Ie=s("7af4"),Ne=s.n(Ie),Re=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.node.visible,expression:"node.visible"}],ref:"node",staticClass:"el-tree-node",class:{"is-expanded":e.expanded,"is-current":e.node.isCurrent,"is-hidden":!e.node.visible,"is-focusable":!e.node.disabled,"is-checked":!e.node.disabled&&e.node.checked},attrs:{role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.draggable},on:{click:function(t){return t.stopPropagation(),e.handleClick.apply(null,arguments)},contextmenu:e=>this.handleContextMenu(e),dragstart:function(t){return t.stopPropagation(),e.handleDragStart.apply(null,arguments)},dragover:function(t){return t.stopPropagation(),e.handleDragOver.apply(null,arguments)},dragend:function(t){return t.stopPropagation(),e.handleDragEnd.apply(null,arguments)},drop:function(t){return t.stopPropagation(),e.handleDrop.apply(null,arguments)}}},[t("div",{staticClass:"el-tree-node__content",style:{"padding-left":(e.node.level-1)*e.tree.indent+"px"}},[t("span",{class:[{"is-leaf":e.node.isLeaf,expanded:!e.node.isLeaf&&e.expanded},"el-tree-node__expand-icon",e.tree.iconClass?e.tree.iconClass:"el-icon-caret-right"],on:{click:function(t){return t.stopPropagation(),e.handleExpandIconClick.apply(null,arguments)}}}),e.showCheckbox?t("el-checkbox",{attrs:{indeterminate:e.node.indeterminate,disabled:!!e.node.disabled},on:{change:e.handleCheckChange},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:e.node.checked,callback:function(t){e.$set(e.node,"checked",t)},expression:"node.checked"}}):e._e(),e.node.loading?t("span",{staticClass:"el-tree-node__loading-icon el-icon-loading"}):e._e(),t("node-content",{attrs:{node:e.node}})],1),t("el-collapse-transition",[!e.renderAfterExpand||e.childNodeRendered?t("div",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticClass:"el-tree-node__children",attrs:{role:"group","aria-expanded":e.expanded}},e._l(e.node.childNodes,(function(s){return t("el-tree-node",{key:e.getNodeKey(s),attrs:{"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:s},on:{"node-expand":e.handleChildNodeExpand}})})),1):e._e()])],1)},Le=[],Be=s("d8b6"),De=s("7964"),Fe=s("77c8"),Ge={methods:{creator(e,t){const s=this[t];e.isTree?this.tree=e:this.tree=e.tree;const i=this.tree;i||console.warn("Can not find node's tree.");const n=i.props||{},o=n["children"]||"children";this.$watch(`${t}.data.${o}`,()=>{s.updateChildren()}),s.expanded&&(this.expanded=!0,this.childNodeRendered=!0),this.tree.accordion&&this.$on("tree-node-expand",e=>{s!==e&&s.collapse()})},getNodeKey(e){return Me(this.tree.nodeKey,e.data)},handleSelectChange(e,t){const s=this.node||this.source;this.oldChecked!==e&&this.oldIndeterminate!==t&&this.tree.$emit("check-change",s.data,e,t),this.oldChecked=e,this.indeterminate=t},handleClick(){const e=this.node||this.source,t=this.tree.store;t.setCurrentNode(e),this.tree.$emit("current-change",t.currentNode?t.currentNode.data:null,t.currentNode),this.tree.currentNode=this,this.tree.expandOnClickNode&&this.handleExpandIconClick(),this.tree.checkOnClickNode&&!e.disabled&&this.handleCheckChange(null,{target:{checked:!e.checked}}),this.tree.$emit("node-click",e.data,e,this)},handleContextMenu(e){const t=this.node||this.source;this.tree._events["node-contextmenu"]&&this.tree._events["node-contextmenu"].length>0&&(e.stopPropagation(),e.preventDefault()),this.tree.$emit("node-contextmenu",e,t.data,t,this)},handleExpandIconClick(){const e=this.node||this.source;e.isLeaf||(this.expanded?(this.tree.$emit("node-collapse",e.data,e,this),e.collapse()):(e.expand(),this.$emit("node-expand",e.data,e,this)))},handleCheckChange(e,t){const s=this.node||this.source;s.setChecked(t.target.checked,!this.tree.checkStrictly),this.$nextTick(()=>{const e=this.tree.store;this.tree.$emit("check",s.data,{checkedNodes:e.getCheckedNodes(),checkedKeys:e.getCheckedKeys(),halfCheckedNodes:e.getHalfCheckedNodes(),halfCheckedKeys:e.getHalfCheckedKeys()})})},handleChildNodeExpand(e,t,s){this.broadcast("ElTreeNode","tree-node-expand",t),this.tree.$emit("node-expand",e,t,s)}}},Ue={name:"ElTreeNode",componentName:"ElTreeNode",mixins:[Fe["a"],Ge],props:{node:{default(){return{}}},props:{},renderContent:Function,renderAfterExpand:{type:Boolean,default:!0},showCheckbox:{type:Boolean,default:!1}},components:{ElCollapseTransition:Be["a"],ElCheckbox:De["a"],NodeContent:{props:{node:{required:!0}},render(e){const t=this.$parent,s=t.tree,i=this.node,{data:n,store:o}=i;return t.renderContent?t.renderContent.call(t._renderProxy,e,{_self:s.$vnode.context,node:i,data:n,store:o}):s.$scopedSlots.default?s.$scopedSlots.default({node:i,data:n}):e("span",{class:"el-tree-node__label"},[i.label])}}},data(){return{tree:null,expanded:!1,childNodeRendered:!1,oldChecked:null,oldIndeterminate:null}},watch:{"node.indeterminate"(e){this.handleSelectChange(this.node.checked,e)},"node.checked"(e){this.handleSelectChange(e,this.node.indeterminate)},"node.expanded"(e){this.$nextTick(()=>this.expanded=e),e&&(this.childNodeRendered=!0)}},methods:{handleDragStart(e){this.tree.draggable&&this.tree.$emit("tree-node-drag-start",e,this)},handleDragOver(e){this.tree.draggable&&(this.tree.$emit("tree-node-drag-over",e,this),e.preventDefault())},handleDrop(e){e.preventDefault()},handleDragEnd(e){this.tree.draggable&&this.tree.$emit("tree-node-drag-end",e,this)}},created(){const e=this.$parent;this.creator(e,"node")}},ze=Ue,We=Object(c["a"])(ze,Re,Le,!1,null,null,null),He=We.exports,$e=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.source.visible,expression:"source.visible"}],ref:"node",staticClass:"el-tree-node",class:{"is-expanded":e.expanded,"is-current":e.source.isCurrent,"is-hidden":!e.source.visible,"is-focusable":!e.source.disabled,"is-checked":!e.source.disabled&&e.source.checked},attrs:{role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.source.disabled,"aria-checked":e.source.checked},on:{click:function(t){return t.stopPropagation(),e.handleClick.apply(null,arguments)},contextmenu:e=>this.handleContextMenu(e)}},[t("div",{staticClass:"el-tree-node__content",style:{"padding-left":(e.source.level-1)*e.tree.indent+"px"}},[t("span",{class:[{"is-leaf":e.source.isLeaf,expanded:!e.source.isLeaf&&e.expanded},"el-tree-node__expand-icon",e.tree.iconClass?e.tree.iconClass:"el-icon-caret-right"],on:{click:function(t){return t.stopPropagation(),e.handleExpandIconClick.apply(null,arguments)}}}),e.showCheckbox?t("el-checkbox",{attrs:{indeterminate:e.source.indeterminate,disabled:!!e.source.disabled},on:{change:e.handleCheckChange},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:e.source.checked,callback:function(t){e.$set(e.source,"checked",t)},expression:"source.checked"}}):e._e(),e.source.loading?t("span",{staticClass:"el-tree-node__loading-icon el-icon-loading"}):e._e(),t("node-content",{attrs:{node:e.source}})],1)])},Ve=[],Ke={name:"ElTreeVirtualNode",componentName:"ElTreeVirtualNode",mixins:[Fe["a"],Ge],props:{source:{default(){return{}}},renderContent:Function,showCheckbox:{type:Boolean,default:!1}},components:{ElCheckbox:De["a"],NodeContent:{props:{node:{required:!0}},render(e){const t=this.$parent,s=t.tree,i=this.node,{data:n,store:o}=i;return t.renderContent?t.renderContent.call(t._renderProxy,e,{_self:s.$vnode.context,node:i,data:n,store:o}):s.$scopedSlots.default?s.$scopedSlots.default({node:i,data:n}):e("span",{class:"el-tree-node__label"},[i.label])}}},data(){return{tree:null,expanded:!1,childNodeRendered:!1,oldChecked:null,oldIndeterminate:null}},watch:{"source.indeterminate"(e){this.handleSelectChange(this.source.checked,e)},"source.checked"(e){this.handleSelectChange(e,this.source.indeterminate)},"source.expanded"(e){this.$nextTick(()=>this.expanded=e),e&&(this.childNodeRendered=!0)}},created(){const e=this.$parent.$parent.$parent;this.creator(e,"source")}},qe=Ke,Je=Object(c["a"])(qe,$e,Ve,!1,null,null,null),Xe=Je.exports,Ye=s("ac86"),Ze=s("bfad"),Qe={name:"ElTree",mixins:[Fe["a"]],components:{VirtualList:Ne.a,ElTreeNode:He},data(){return{store:null,root:null,currentNode:null,treeItems:null,checkboxItems:[],dragState:{showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0},itemComponent:Xe}},props:{data:{type:Array},emptyText:{type:String,default(){return Object(Ye["a"])("el.tree.emptyText")}},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{default(){return{children:"children",label:"label",disabled:"disabled"}}},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},iconClass:String,height:{type:Number,default:0},extraLine:{type:Number,default:8}},computed:{children:{set(e){this.data=e},get(){return this.data}},treeItemArray(){return Array.prototype.slice.call(this.treeItems)},isEmpty(){const{childNodes:e}=this.root;return!e||0===e.length||e.every(({visible:e})=>!e)},visibleList(){return this.flattenTree(this.root.childNodes)}},watch:{defaultCheckedKeys(e){this.store.setDefaultCheckedKey(e)},defaultExpandedKeys(e){this.store.defaultExpandedKeys=e,this.store.setDefaultExpandedKeys(e)},data(e){this.store.setData(e)},checkboxItems(e){Array.prototype.forEach.call(e,e=>{e.setAttribute("tabindex",-1)})},checkStrictly(e){this.store.checkStrictly=e}},methods:{flattenTree(e){return e.reduce((e,t)=>(e.push(t),t.expanded&&t.childNodes.length&&e.push(...this.flattenTree(t.childNodes)),e),[])},filter(e){if(!this.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");this.store.filter(e)},getNodeKey(e){return Me(this.nodeKey,e.data)},getNodePath(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const t=this.store.getNode(e);if(!t)return[];const s=[t.data];let i=t.parent;while(i&&i!==this.root)s.push(i.data),i=i.parent;return s.reverse()},getCheckedNodes(e,t){return this.store.getCheckedNodes(e,t)},getCheckedKeys(e){return this.store.getCheckedKeys(e)},getCurrentNode(){const e=this.store.getCurrentNode();return e?e.data:null},getCurrentKey(){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const e=this.getCurrentNode();return e?e[this.nodeKey]:null},setCheckedNodes(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");this.store.setCheckedNodes(e,t)},setCheckedKeys(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");this.store.setCheckedKeys(e,t)},setChecked(e,t,s){this.store.setChecked(e,t,s)},getHalfCheckedNodes(){return this.store.getHalfCheckedNodes()},getHalfCheckedKeys(){return this.store.getHalfCheckedKeys()},setCurrentNode(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");this.store.setUserCurrentNode(e)},setCurrentKey(e){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");this.store.setCurrentNodeKey(e)},getNode(e){return this.store.getNode(e)},remove(e){this.store.remove(e)},append(e,t){this.store.append(e,t)},insertBefore(e,t){this.store.insertBefore(e,t)},insertAfter(e,t){this.store.insertAfter(e,t)},handleNodeExpand(e,t,s){this.broadcast("ElTreeNode","tree-node-expand",t),this.$emit("node-expand",e,t,s)},updateKeyChildren(e,t){if(!this.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");this.store.updateChildren(e,t)},initTabIndex(){this.treeItems=this.$el.querySelectorAll(".is-focusable[role=treeitem]"),this.checkboxItems=this.$el.querySelectorAll("input[type=checkbox]");const e=this.$el.querySelectorAll(".is-checked[role=treeitem]");e.length?e[0].setAttribute("tabindex",0):this.treeItems[0]&&this.treeItems[0].setAttribute("tabindex",0)},handleKeydown(e){const t=e.target;if(-1===t.className.indexOf("el-tree-node"))return;const s=e.keyCode;this.treeItems=this.$el.querySelectorAll(".is-focusable[role=treeitem]");const i=this.treeItemArray.indexOf(t);let n;[38,40].indexOf(s)>-1&&(e.preventDefault(),n=38===s?0!==i?i-1:0:i<this.treeItemArray.length-1?i+1:0,this.treeItemArray[n].focus()),[37,39].indexOf(s)>-1&&(e.preventDefault(),t.click());const o=t.querySelector('[type="checkbox"]');[13,32].indexOf(s)>-1&&o&&(e.preventDefault(),o.click())}},created(){this.isTree=!0,this.store=new _e({key:this.nodeKey,data:this.data,lazy:this.lazy,props:this.props,load:this.load,currentNodeKey:this.currentNodeKey,checkStrictly:this.checkStrictly,checkDescendants:this.checkDescendants,defaultCheckedKeys:this.defaultCheckedKeys,defaultExpandedKeys:this.defaultExpandedKeys,autoExpandParent:this.autoExpandParent,defaultExpandAll:this.defaultExpandAll,filterNodeMethod:this.filterNodeMethod}),this.root=this.store.root;let e=this.dragState;this.$on("tree-node-drag-start",(t,s)=>{if("function"===typeof this.allowDrag&&!this.allowDrag(s.node))return t.preventDefault(),!1;t.dataTransfer.effectAllowed="move";try{t.dataTransfer.setData("text/plain","")}catch(i){}e.draggingNode=s,this.$emit("node-drag-start",s.node,t)}),this.$on("tree-node-drag-over",(t,s)=>{const i=Te(t.target,"ElTreeNode"),n=e.dropNode;n&&n!==i&&Object(Ze["b"])(n.$el,"is-drop-inner");const o=e.draggingNode;if(!o||!i)return;let r=!0,a=!0,c=!0,l=!0;"function"===typeof this.allowDrop&&(r=this.allowDrop(o.node,i.node,"prev"),l=a=this.allowDrop(o.node,i.node,"inner"),c=this.allowDrop(o.node,i.node,"next")),t.dataTransfer.dropEffect=a?"move":"none",(r||a||c)&&n!==i&&(n&&this.$emit("node-drag-leave",o.node,n.node,t),this.$emit("node-drag-enter",o.node,i.node,t)),(r||a||c)&&(e.dropNode=i),i.node.nextSibling===o.node&&(c=!1),i.node.previousSibling===o.node&&(r=!1),i.node.contains(o.node,!1)&&(a=!1),(o.node===i.node||o.node.contains(i.node))&&(r=!1,a=!1,c=!1);const d=i.$el.getBoundingClientRect(),h=this.$el.getBoundingClientRect();let u;const p=r?a?.25:c?.45:1:-1,m=c?a?.75:r?.55:0:1;let g=-9999;const f=t.clientY-d.top;u=f<d.height*p?"before":f>d.height*m?"after":a?"inner":"none";const b=i.$el.querySelector(".el-tree-node__expand-icon").getBoundingClientRect(),v=this.$refs.dropIndicator;"before"===u?g=b.top-h.top:"after"===u&&(g=b.bottom-h.top),v.style.top=g+"px",v.style.left=b.right-h.left+"px","inner"===u?Object(Ze["a"])(i.$el,"is-drop-inner"):Object(Ze["b"])(i.$el,"is-drop-inner"),e.showDropIndicator="before"===u||"after"===u,e.allowDrop=e.showDropIndicator||l,e.dropType=u,this.$emit("node-drag-over",o.node,i.node,t)}),this.$on("tree-node-drag-end",t=>{const{draggingNode:s,dropType:i,dropNode:n}=e;if(t.preventDefault(),t.dataTransfer.dropEffect="move",s&&n){const e={data:s.node.data};"none"!==i&&s.node.remove(),"before"===i?n.node.parent.insertBefore(e,n.node):"after"===i?n.node.parent.insertAfter(e,n.node):"inner"===i&&n.node.insertChild(e),"none"!==i&&this.store.registerNode(e),Object(Ze["b"])(n.$el,"is-drop-inner"),this.$emit("node-drag-end",s.node,n.node,i,t),"none"!==i&&this.$emit("node-drop",s.node,n.node,i,t)}s&&!n&&this.$emit("node-drag-end",s.node,null,i,t),e.showDropIndicator=!1,e.draggingNode=null,e.dropNode=null,e.allowDrop=!0})},mounted(){this.initTabIndex(),this.$el.addEventListener("keydown",this.handleKeydown)},updated(){this.treeItems=this.$el.querySelectorAll("[role=treeitem]"),this.checkboxItems=this.$el.querySelectorAll("input[type=checkbox]")}},et=Qe,tt=Object(c["a"])(et,we,ye,!1,null,null,null),st=tt.exports;class it{static geometryEquals(e,t){if(e===t)return!0;const s=e.type===t.type&&e.name===t.name&&e.morphTargetsRelative===t.morphTargetsRelative&&this.equals(e.boundingBox,t.boundingBox)&&this.equals(e.boundingSphere,t.boundingSphere)&&this.attributesEqual(e.attributes,t.attributes)&&this.bufferAttributeEqual(e.index,t.index);return s}static equals(e,t){return e===t||(!e&&!t||!(!e||!t)&&e.equals(t))}static attributesEqual(e,t){if(e===t)return!0;const s=Object.keys(e).sort(),i=Object.keys(t).sort();if(s.length!==i.length)return!1;for(let n=0;n<s.length;++n){if(s[n]!==i[n])return!1;const o=e[s[n]],r=t[i[n]],a=this.bufferAttributeEqual(o,r);if(!a)return!1}return!0}static bufferAttributeEqual(e,t){if(e===t)return!0;if(!e||!t)return!1;const s=e.name===t.name&&e.itemSize===t.itemSize&&e.count===t.count&&e.normalized===t.normalized;if(!s)return!1;if(e.array&&t.array){if(e.array.length!==t.array.length)return!1;for(let s=0;s<e.array.length;++s)if(e.array[s]!==t.array[s])return!1}else if(e.array||t.array)return!1;const i=e.data,n=t.data;if(i&&n){if(i.length!==n.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==n[e])return!1}else if(i||n)return!1;return!0}static tryConvertInterleavedBufferAttributes(e){e&&e.attributes&&Object.keys(e.attributes).forEach(t=>{const s=e.attributes[t];if(s instanceof y["T"]){const i=s.clone();e.attributes[t]=i}})}}class nt{static materialEquals(e,t){if(e===t)return!0;if(e instanceof y["jb"]&&t instanceof y["jb"]){const s=e.type===t.type&&e.alphaTest===t.alphaTest&&e.opacity===t.opacity&&e.side===t.side&&e.visible===t.visible&&e.name===t.name&&e.transparent===t.transparent&&this.colorEquals(e.color,t.color)&&this.colorEquals(e.emissive,t.emissive)&&e.roughness===t.roughness&&e.metalness===t.metalness&&e.alphaMap===t.alphaMap;return s}return!1}static materialsEquals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(let s=0;s<e.length;++s)if(!this.materialEquals(e[s],t[s]))return!1;return!0}return e instanceof y["jb"]&&t instanceof y["jb"]&&this.materialEquals(e,t)}static colorEquals(e,t){return e===t||e instanceof y["n"]&&t instanceof y["n"]&&e.equals(t)}}class ot{constructor(e){this.object=e}instantiate(){const e=Date.now();this.instantiateInner(this.object),console.log(`[Inst] instantiate() costed ${(Date.now()-e)/1e3}s`)}instantiateInner(e){if(!e.children||0===e.children.length)return;const t=e.children.length,s={},i=[];for(let r=0;r<t;++r){const t=e.children[r];if(this.instantiateInner(t),t.children&&t.children.length>0)continue;if(!t.geometry)continue;let n=!1;const o=Object.values(s);for(let a=o.length-1;a>=0;--a){const c=o[a].indexes[0],l=e.children[c];if(this.geometryEquals(t.geometry,l.geometry)&&nt.materialsEquals(t.material,l.material)){s[c]||(s[c]={indexes:[c]},this.removeFromArray(i,c)),s[c].indexes.push(r),n=!0;break}}for(let a=i.length-1;!n&&a>=0;--a){const o=i[a],c=e.children[o];if(this.geometryEquals(t.geometry,c.geometry)&&nt.materialsEquals(t.material,c.material)){s[o]||(s[o]={indexes:[o]},this.removeFromArray(i,o)),s[o].indexes.push(r),n=!0;break}}n||i.push(r)}if(Object.keys(s).length<=0)return;const n=[],o=[];Object.values(s).forEach(t=>{const s=t.indexes;o.push(...s);const i=e.children[s[0]];let r=i.material;if(r instanceof y["jb"])r=r.clone();else if(Array.isArray(r)){const e=[];r.forEach(t=>e.push(t.clone())),r=e}const a=new y["R"](i.geometry,r,s.length);a.name="[Instanced] "+i.name;for(let n=0;n<s.length;++n){const t=s[n],i=e.children[t];i.updateMatrix(),a.setMatrixAt(n,i.matrix)}a.matrixAutoUpdate=ie,ie||a.updateMatrix(),n.push(a)}),o.sort((e,t)=>t-e),o.forEach(t=>e.remove(e.children[t])),n.forEach(t=>{t.parent=e,e.children.push(t)}),e.updateMatrix(),console.log(`[Inst] ${o.length}(out of ${t}) objects instanced to ${n.length} InstancedMesh`)}removeFromArray(e,t){for(let s=e.length-1;s>=0;--s)if(e[s]===t)return void e.splice(s,1)}geometryEquals(e,t){return it.geometryEquals(e,t)}}var rt=s("047e");class at{constructor(e){this.counter=0,this.object=e}merge(e=!0){this.counter=0;const t=Date.now();this.mergeInner(this.object),e&&this.deepMerge(this.object),console.log(`[Merge] merge() costed ${(Date.now()-t)/1e3}s`)}mergeInner(e){if(!e.children||0===e.children.length)return;const t=e.children.length,s={},i=[];for(let r=0;r<t;++r){const t=e.children[r];if(this.mergeInner(t),t.children&&t.children.length>0)continue;if(!t.geometry)continue;let n=!1;const o=Object.values(s);for(let a=o.length-1;a>=0;--a){const t=o[a].indexes[0];if(n=this.tryHandleMergeableObjects(e,r,t,s,i),n)break}for(let a=i.length-1;!n&&a>=0;--a){const t=i[a];if(n=this.tryHandleMergeableObjects(e,r,t,s,i),n)break}n||i.push(r)}if(Object.keys(s).length<=0)return;const n=[],o=[];Object.values(s).forEach(t=>{const s=t.indexes,i=e.children[s[0]];let r=[];if(s.forEach(t=>{const s=e.children[t];if(s instanceof y["nb"]){const e=s.geometry.clone();it.tryConvertInterleavedBufferAttributes(e),e.applyMatrix4(s.matrix),r.push(e),o.push(t)}}),r.length>0){const e=Object(rt["a"])(r);r.forEach(e=>e.dispose()),r=[];const t=new y["nb"](e,i.material);t.name="[Merged] "+i.name,t.userData.selectable=!1,t.matrixAutoUpdate=ie,ie||t.updateMatrix(),t.updateMatrixWorld(!0),t.updateWorldMatrix(!0,!0),n.push(t)}}),o.sort((e,t)=>t-e),o.forEach(t=>{const s=e.children[t];e.remove(s),s instanceof y["nb"]&&s.geometry.dispose()}),n.forEach(t=>{t.parent=e,e.children.push(t)}),e.updateMatrix(),this.counter++<2?console.log(`[Merge] ${o.length}(out of ${t}) objects merged to ${n.length} Meshes`):console.log(`[Merge] ${o.length}/${t} -> ${n.length}`)}tryHandleMergeableObjects(e,t,s,i,n){let o=!1;const r=e.children[t],a=e.children[s];return nt.materialsEquals(r.material,a.material)&&(i[s]||(i[s]={indexes:[s]},this.removeFromArray(n,s)),i[s].indexes.push(t),o=!0),o}deepMerge(e){const t={};let s=0;e.traverse(e=>{if(!(e instanceof y["nb"])||!e.geometry||!e.material)return;it.tryConvertInterleavedBufferAttributes(e.geometry);let i=!1;const n=Object.values(t);for(let t=n.length-1;t>=0;--t)if(nt.materialsEquals(n[t].material,e.material)){n[t].objects.push(e),i=!0;break}i||(t[e.id]={material:e.material,objects:[e]}),s++});const i=(t,s)=>(t.applyMatrix4(s.matrix),s.parent&&s.parent!==e&&i(t,s.parent),t),n=new y["M"],o=Object.values(t).filter(e=>e.objects.length>1);n.name=`Merged objects (${o.length})`;for(let a=o.length-1;a>=0;--a){const e=o[a];let t=[];for(let n=0;n<e.objects.length;++n){const s=e.objects[n],o=i(s.geometry.clone(),s);t.push(o)}const s=Object(rt["a"])(t);if(t.forEach(e=>e.dispose()),t=[],s){const t=new y["nb"](s,e.material);t.name="[Merged] "+e.material.name,t.userData.selectable=!1,t.matrixAutoUpdate=ie,ie||t.updateMatrix(),t.parent=n,n.children.push(t)}else e.objects=[]}let r=0;for(let a=o.length-1;a>=0;--a)o[a].objects.forEach(e=>{e instanceof y["nb"]&&(e.removeFromParent(),e.geometry.dispose(),r++)}),o[a].objects=[];n.children.length&&(n.matrixAutoUpdate=ie,ie||n.updateMatrix(),n.parent=e,e.children.push(n)),console.log(`[Merge] ${r}(out of ${s}) objects merged to ${n.children.length} Meshes during deepMerge`)}removeFromArray(e,t){for(let s=e.length-1;s>=0;--s)if(e[s]===t)return void e.splice(s,1)}}var ct,lt,dt=s("47ac"),ht=s.n(dt);(function(e){e["Top"]="Top",e["Bottom"]="Bottom",e["Front"]="Front",e["Back"]="Back",e["Left"]="Left",e["Right"]="Right"})(ct||(ct={}));class ut{static getCameraPositionByView(e,t,s,i){const n=oe.getVisibleObjectBoundingBox(e);ut.getCameraPositionByBboxAndView(n,t,s,i)}static getCameraPositionByObjectUuids(e,t,s,i,n){const o=oe.getObjectsBoundingBox(e,t);ut.getCameraPositionByBboxAndView(o,s,i,n)}static getCameraPositionByObjects(e,t,s,i){const n=new y["h"];e.forEach(e=>{const t=oe.getBoundingBox(e);n.union(t)}),ut.getCameraPositionByBboxAndCamera(n,t,s,i)}static getCameraPositionByBboxAndCamera(e,t,s,i){if(e.isEmpty())return;const n=1.2;let o=e.max.x-e.min.x+(e.max.y-e.min.y)+(e.max.z-e.min.z);o*=n;const r=new y["wc"](o,o,o),a=(e.min.x+e.max.x)/2,c=(e.min.y+e.max.y)/2,l=(e.min.z+e.max.z)/2;i.set(a,c,l);const d=new y["wc"];t.getWorldPosition(d);const h=d.sub(i).normalize(),u=h.multiply(r).add(i);s.set(u.x,u.y,u.z)}static getCameraPositionByBboxAndView(e,t,s,i){if(e.isEmpty())return;const n=e.max.x-e.min.x+(e.max.y-e.min.y)+(e.max.z-e.min.z),o=(.5+.5/Math.pow(Math.E,n/100))*n;let r=0,a=e.min.y+(e.max.y-e.min.y),c=0;const l=(e.min.x+e.max.x)/2,d=(e.min.y+e.max.y)/2,h=(e.min.z+e.max.z)/2;t===ct.Top?a=e.max.y+o:t===ct.Bottom?a=e.min.y-o:t===ct.Front?(c=e.max.z+o,r=l):t===ct.Back?(c=e.min.z-o,r=l):t===ct.Left?(r=e.min.x-o,c=h):t===ct.Right&&(r=e.max.x+o,c=h),s.x=r,s.y=a,s.z=c,i.x=l,i.y=d,i.z=h}static async sleep(e){return new Promise(t=>{setTimeout(()=>{t("")},e)})}static async twinkle(e,t=500){const s=ut.twinklingObjectUuids;s[e.uuid]||(s[e.uuid]=!0,e.visible=!e.visible,await this.sleep(t),e.visible=!e.visible,await this.sleep(t),e.visible=!e.visible,await this.sleep(t),e.visible=!e.visible,await this.sleep(t),e.visible=!e.visible,await this.sleep(t),e.visible=!e.visible,delete s[e.uuid])}}ut.twinklingObjectUuids={},function(e){e["ZoomTo"]="zoomTo",e["Transparent"]="transparent",e["Wireframe"]="wireframe",e["Outline"]="outline",e["Material"]="material",e["SectionBox"]="sectionBox",e["SectionPlane"]="sectionPlane",e["CustomizedSectionPlane"]="customizedSectionPlane",e["Explode"]="explode",e["Floor"]="floor",e["Instantiate"]="instantiate",e["Merge"]="merge",e["ExportToGltf"]="exportToGltf",e["ExportToGlb"]="exportToGlb",e["ExportToObj"]="exportToObj",e["ExportToDraco"]="exportToDraco",e["ExportToThreeJsJson"]="exportToThreeJsJson"}(lt||(lt={}));let pt=class extends g["d"]{constructor(){super(...arguments),this.checkMark=" ",this.treeData=[],this.filterText="",this.visible=!1,this.treeHeight=300,this.postmate=o.instance(),this.dropdownMenuState={}}mounted(){this.setBimTreeVisibility(!!this.visible),this.postmate.addEventListener(i.setBimTree,e=>{const t=e.value;this.setBimTreeVisibility(t)}),this.postmate.addEventListener(i.highlightRandomNode,()=>{if(!this.treeData||this.treeData.length<1)return;let e=Math.floor(Math.random()*this.treeData.length),t=this.treeData[e];t.children&&(e=Math.floor(Math.random()*t.children.length),t=t.children[e],t.children&&(e=Math.floor(Math.random()*t.children.length),t=t.children[e])),this.handleNodeClick(t)})}onShowBimTreeChanged(e){this.setBimTreeVisibility(e)}onFilterTextChanged(e){const t=this.$refs.tree;t.filter(e.toLowerCase())}filterNode(e,t){if(!e)return!0;const s=t&&t.label&&t.label.toLowerCase()||"";return-1!==s.indexOf(e)}get showBimTree(){return this.$store.getters.getShowBimTree}bimModelUuids(){return this.viewer?Object.values(this.viewer.loadedModels).map(e=>e.uuid):[]}get bimTreeData(){return this.visible?this.treeData=this.bimModelsToTreeData():this.treeData=[],this.treeData}get defaultCheckedKeys(){if(!this.bimModelUuids)return console.warn("[BT] bimModels not defined!"),[];if(!this.visible)return[];let e=[];return this.treeData&&(e=this.treeData.map(e=>e.id)),e}changeTreeHeight(){const e=this.$refs.treeWrapper;e&&(this.treeHeight=e.clientHeight-44)}bimModelsToTreeData(e=[]){if(!this.viewer||!this.viewer.scene)return[];let t=e;t&&0!==t.length||(t=this.bimModelUuids());const s=[];let i=1;return this.viewer.scene.traverse(e=>{if(t.find(t=>t===e.uuid)){const t=this.objectToTreeData(e);s&&t&&(s.find(e=>e.label===t.label)&&(t.label+="-"+i++),s.push(t))}}),s}objectToTreeData(e,t=5){if(!e||t<0)return;if(!0===e.userData.isOutline)return;const s={};if(s.id=e.uuid||"",s.label=this.getTreeLabelForObject(e),e.children){let i=1;for(let n=0;n<e.children.length;++n){s.children||(s.children=[]);const o=this.objectToTreeData(e.children[n],t-1);o&&(s.children.find(e=>e.label===o.label)&&(o.label+="-"+i++),s.children.push(o))}}else s.isLeaf=!0;return s}handleCheckChange(e,t,s){if(!e||!e.id||!this.viewer||!this.viewer.scene)return;const i=this.getObjectByUuid(e.id);if(i){if(t?(i.visible=!0,i.traverseAncestors(e=>{e.visible=!0})):(!i.children||i.children.length<=0)&&(i.visible=!1),e.children&&e.children.length){if(!t&&s)return;i.children&&i.children.length&&this.setObjLeavesVisible(i.children,t)}i.visible=t,this.viewer.enableRender()}}setObjLeavesVisible(e,t){for(const s of e)s.children&&s.children.length&&this.setObjLeavesVisible(s.children,t),s.visible=t}handleNodeClick(e,t,s){if(!e||!e.id||!this.viewer||!this.viewer.scene||!this.viewer.camera)return;const i=this.viewer.scene.getObjectByProperty("uuid",e.id);if(i){const e=new y["wc"],t=new y["wc"];ut.getCameraPositionByObjects([i],this.viewer.camera,e,t),this.viewer.flyTo(e,t),ut.twinkle(i),this.viewer.selectObject(i,void 0,!1)}}close(){this.setBimTreeVisibility(!1)}setBimTreeVisibility(e){this.visible=e,X.commit(V.MUTATION_SHOW_BIM_TREE,e)}getTreeLabelForObject(e){let t=e.name;if(e.userData&&e.userData.gltfExtensions){const s=e.userData.gltfExtensions;s.elementId&&s.elementId.Value&&(t=s.elementId.Value),s.level&&s.level.Value&&(t=`${t?t+"-":""}${s.level.Value}`)}return t||(t=""),`${t} [${e.type}]`}startScroll(e){const t=e.target,s=e.target.querySelector(".custom-label");s.offsetWidth>t.offsetWidth&&s.classList.add("auto-scroll")}stopScroll(e){const t=e.target,s=e.target.querySelector(".custom-label");s.offsetWidth>t.offsetWidth&&s.classList.remove("auto-scroll")}beforeDestroy(){Object.keys(this.dropdownMenuState).forEach(e=>{const t=this.dropdownMenuState[e];t.components&&Object.keys(t.components).forEach(e=>{t.components[e]=void 0}),t.materialInfoList=[],t.objectsBoxSection&&t.objectsBoxSection.isOpen&&(t.objectsBoxSection.close(),t.objectsBoxSection=void 0),t.objectsPlaneSection&&t.objectsPlaneSection.isOpen&&(t.objectsPlaneSection.close(),t.objectsPlaneSection=void 0),t.exploder=void 0}),this.treeData=void 0,this.postmate.removeEventListener(i.setBimTree,i.highlightRandomNode),this.close()}getState(e){this.dropdownMenuState[e]=this.dropdownMenuState[e]||{uuid:{component:{}}};const t=this.dropdownMenuState[e];if(void 0===t.showOutline){const s=this.getObjectByUuid(e);s&&(t.showOutline=re.hasOutline(s))}return t}handleDropdownCommand(e){return(t,s)=>{const i=this.getState(e);i.components||(i.components={}),i.components[t]||(i.components[t]=s),t===lt.ZoomTo?this.zoomTo(e):t===lt.Transparent?this.transparent(e,s):t===lt.Wireframe?this.wireframe(e,s):t===lt.Outline?this.outline(e,s):t===lt.Material?this.material(e,s):t===lt.SectionBox?this.section(e,s):t===lt.SectionPlane?this.sectionPlane(e,s):t===lt.CustomizedSectionPlane?this.customizedSectionPlane(e,s):t===lt.Explode?this.explode(e,s):t===lt.Floor?this.floor(e,s):t===lt.Instantiate?this.instantiate(e,s):t===lt.Merge?this.merge(e,s):t===lt.ExportToGltf?this.exportToGltf(e):t===lt.ExportToGlb?this.exportToGlb(e):t===lt.ExportToObj?this.exportToObj(e):t===lt.ExportToDraco?this.exportToDraco(e):t===lt.ExportToThreeJsJson?this.exportToThreeJsJson(e):console.warn("Unknown command: "+t)}}runCommand(e,t){const s=this.getState(e);if(s&&s.components&&s.components[t]){const e=s.components[t];e.handleClick()}else if(t===lt.Outline){const t=this.getObjectByUuid(e);t&&re.setOutlinesVisibility(t,!1)}}runCommands(e,t){t.forEach(t=>this.runCommand(e,t))}zoomTo(e){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.camera)return;const t=this.getObjectByUuid(e);if(t){const e=new y["wc"],s=new y["wc"];ut.getCameraPositionByObjects([t],this.viewer.camera,e,s),this.viewer.flyTo(e,s),ut.twinkle(t)}}transparent(e,t){if(!e||!this.viewer||!this.viewer.scene)return;const s=this.getState(e),i=.3;s.materialInfoList?(re.revertObjectOpacityByUuid(this.viewer.scene,e,s.materialInfoList),s.materialInfoList=void 0,this.removeCheckMark(t)):(s.materialInfoList=re.setObjectOpacityByUuid(this.viewer.scene,e,i),this.addCheckMark(t)),this.viewer.enableRender()}wireframe(e,t){if(!e||!this.viewer||!this.viewer.scene)return;this.viewer.clearSelection();const s=this.getState(e),i=[];s.materialInfoList&&i.push(lt.Transparent),s.objectsBoxSection&&i.push(lt.SectionBox),s.objectsPlaneSection&&i.push(lt.SectionPlane),s.showOutline&&i.push(lt.Outline),i.length>0&&(console.log("[BT] Cancelling conflicted commands: "+i),this.runCommands(e,i)),s.isWireframeMode?(re.revertWireframeModeByUuid(this.viewer.scene,e),s.isWireframeMode=void 0,this.removeCheckMark(t)):(re.setWireframeModeByUuid(this.viewer.scene,e),s.isWireframeMode=!0,this.addCheckMark(t)),this.viewer.enableRender()}outline(e,t){if(!e||!this.viewer||!this.viewer.scene)return;const s=this.getObjectByUuid(e);if(!s)return;this.viewer.clearSelection();const i=this.getState(e),n=[];i.exploder&&n.push(lt.Explode),i.isWireframeMode&&n.push(lt.Wireframe),n.length>0&&(console.log("[BT] Cancelling conflicted commands: "+n),this.runCommands(e,n)),i.showOutline?(re.setOutlinesVisibility(s,!1),i.showOutline=!1,this.removeCheckMark(t)):(re.hasOutline(s)?re.setOutlinesVisibility(s,!0):re.addOutlines(s),i.showOutline=!0,this.addCheckMark(t)),this.viewer.enableRender()}material(e,t){if(!e||!this.viewer||!this.viewer.scene)return;this.viewer.clearSelection();const s=this.getState(e),i=[];s.materialInfoList&&i.push(lt.Transparent),s.objectsBoxSection&&i.push(lt.SectionBox),s.objectsPlaneSection&&i.push(lt.SectionPlane),i.length>0&&(console.log("[BT] Cancelling conflicted commands: "+i),this.runCommands(e,i)),X.commit(V.MUTATION_OBJECT_UUID_FOR_MATERIAL_MANAGER,e)}section(e,t){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.camera||!this.viewer.renderer||!this.viewer.controls)return;const s=this.getObjectByUuid(e);if(s){const s=this.getState(e),i=[];s.objectsPlaneSection&&i.push(lt.SectionPlane),s.customizedPlaneSection&&i.push(lt.CustomizedSectionPlane),i.length>0&&(console.log("[BT] Cancelling conflicted commands: "+i),this.runCommands(e,i)),s.objectsBoxSection?(s.objectsBoxSection.close(),s.objectsBoxSection=void 0,this.removeCheckMark(t)):(this.viewer.renderer.localClippingEnabled=!0,s.objectsBoxSection=new de([e],this.viewer.scene,this.viewer.camera,this.viewer.renderer,this.viewer.controls),s.objectsBoxSection.open(),this.addCheckMark(t)),this.viewer.enableRender()}}sectionPlane(e,t){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.camera||!this.viewer.renderer||!this.viewer.controls)return;const s=this.getObjectByUuid(e);if(s){const s=this.getState(e),i=[];s.objectsBoxSection&&i.push(lt.SectionBox),s.customizedPlaneSection&&i.push(lt.CustomizedSectionPlane),i.length>0&&(console.log("[BT] Cancelling conflicted commands: "+i),this.runCommands(e,i)),s.objectsPlaneSection?(s.objectsPlaneSection.close(),s.objectsPlaneSection=void 0,this.removeCheckMark(t)):(this.viewer.renderer.localClippingEnabled=!0,s.objectsPlaneSection=new me([e],this.viewer.scene,this.viewer.camera,this.viewer.renderer,this.viewer.controls),s.objectsPlaneSection.open(),this.addCheckMark(t)),this.viewer.enableRender()}}customizedSectionPlane(e,t){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.camera||!this.viewer.renderer||!this.viewer.controls)return;const s=this.getObjectByUuid(e);if(s){const s=this.getState(e),i=[];if(s.objectsBoxSection&&i.push(lt.SectionBox),s.objectsPlaneSection&&i.push(lt.SectionPlane),i.length>0&&(console.log("[BT] Cancelling conflicted commands: "+i),this.runCommands(e,i)),s.customizedPlaneSection)s.customizedPlaneSection.close(),s.customizedPlaneSection=void 0,this.removeCheckMark(t);else{this.viewer.renderer.localClippingEnabled=!0;const i=this.viewer.scene,n=this.viewer.camera,o=this.viewer.renderer,r=this.viewer.controls,a="Input rotation angle of section plane, recommended value: [-45, 45]";Z.a.prompt(a.replace("axis","X")).then(c=>{const l=Number(c.value);isNaN(l)?console.log("Invalid input!"):Z.a.prompt(a.replace("axis","Y")).then(c=>{const d=Number(c.value);isNaN(d)?console.log("Invalid input!"):Z.a.prompt(a.replace("axis","Z")).then(a=>{const c=Number(a.value);if(isNaN(c))return void console.log("Invalid input!");s.customizedPlaneSection=new me([e],i,n,o,r),s.customizedPlaneSection.open();const h=(new y["mb"]).makeRotationX(Math.PI/180*l),u=(new y["mb"]).makeRotationY(Math.PI/180*d),p=(new y["mb"]).makeRotationZ(Math.PI/180*c),m=h.multiply(u).multiply(p);s.customizedPlaneSection.setMatrix(m),this.addCheckMark(t)})})})}this.viewer.enableRender()}}explode(e,t){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.renderer)return;let s=this.getObjectByUuid(e);if(s){const i=this.getState(e),n=[];i.showOutline&&n.push(lt.Outline),n.length>0&&(console.log("[BT] Cancelling conflicted commands: "+n),this.runCommands(e,n)),i.exploder?(re.unexplodeObject(i.exploder),i.exploder=void 0,this.removeCheckMark(t)):(1===s.children.length&&(s=s.children[0]),i.exploder=re.explodeObject(this.viewer.scene,s),this.addCheckMark(t)),this.viewer.enableRender()}}floor(e,t){if(!e||!this.viewer||!this.viewer.scene||!this.viewer.renderer)return;const s=re.distinctFloors(this.viewer.scene,[e]);if(0===s.length)return void Z.a.alert("Failed to match floor info from components(name, userDate). Please make sure there are floor info(e.g. '2F')","Warning");const i=this.getState(e);if(i.filterByFloorInfo){const s=i.filterByFloorInfo,n=s&&s.materialInfoList||void 0,o=s&&s.includeObjectUuids||void 0;return re.revertObjectOpacityByUuid(this.viewer.scene,e,n,o),i.filterByFloorInfo=void 0,this.removeCheckMark(t),void this.viewer.enableRender()}Z.a.prompt(`The model contains these floors: ${s}, please input one or more floors, split with comma `,"Specify floors").then(s=>{const n=s.value;if(this.viewer&&this.viewer.scene&&n){const s=n.split(/[\s,]+/).map(e=>Number(e)),o=[];re.traverseObjectByFloors(this.viewer.scene,e,s,void 0,e=>{o.push(e.uuid)});const r=re.setObjectOpacityByUuid(this.viewer.scene,e,.1,o);i.filterByFloorInfo||this.addCheckMark(t),i.filterByFloorInfo={includeObjectUuids:o,materialInfoList:r},this.viewer.enableRender()}})}instantiate(e,t){if(!this.viewer)return;const s=this.getObjectByUuid(e);if(s){const i=this.getState(e),n=[];i.materialInfoList&&n.push(lt.Transparent),i.showOutline&&n.push(lt.Outline),i.objectsBoxSection&&n.push(lt.SectionBox),i.customizedPlaneSection&&n.push(lt.CustomizedSectionPlane),n.length>0&&(console.log("[BT] Cancelling conflicted commands: "+n),this.runCommands(e,n)),i.isInstantiated||(this.viewer.clearSelection(),re.removeOutlines(s),new ot(s).instantiate(),i.showOutline&&re.addOutlines(s),i.isInstantiated=!0,this.addCheckMark(t)),this.viewer.enableRender()}}merge(e,t){if(!this.viewer)return;const s=this.getObjectByUuid(e);if(s){const i=this.getState(e),n=[];i.objectsBoxSection&&n.push(lt.Transparent),n.length>0&&(console.log("[BT] Cancelling conflicted commands: "+n),this.runCommands(e,n)),i.isMerged||(this.viewer.clearSelection(),re.removeOutlines(s),new at(s).merge(),i.showOutline&&re.addOutlines(s),i.isMerged=!0,this.addCheckMark(t)),this.viewer.enableRender()}}exportToGltf(e){const t=this.getObjectByUuid(e);t&&se.exportToGltf(t,t.name||t.uuid)}exportToGlb(e){const t=this.getObjectByUuid(e);t&&se.exportToGlb(t,t.name||t.uuid)}exportToObj(e){const t=this.getObjectByUuid(e);t&&se.exportToObj(t,t.name||t.uuid)}exportToDraco(e){const t=this.getObjectByUuid(e);t instanceof y["nb"]&&se.exportToDraco(t,t.name||t.uuid)}exportToThreeJsJson(e){const t=this.getObjectByUuid(e);t&&se.exportToThreeJsJson(t,t.name)}getObjectByUuid(e){if(e&&this.viewer&&this.viewer.scene)return this.viewer.scene.getObjectByProperty("uuid",e)}addCheckMark(e){e.$el.innerText=`${this.checkMark}${e.$el.innerText}`}removeCheckMark(e){let t=e.$el.innerText;t=t.replace(""+this.checkMark,""),e.$el.innerText=t}renderContent(e,{component:t,node:s,data:i,store:n}){if(!i||!i.id||!this.viewer||!this.viewer.scene)return;const o=i.id,r=this.getObjectByUuid(o),a=r&&(!r.parent||r.parent===this.viewer.scene),c=(y["nb"],this.getState(o)),l=!!c.materialInfoList,d=!!c.isWireframeMode,h=!!c.showOutline,u=!!c.objectsBoxSection,p=!!c.objectsPlaneSection;c.customizedPlaneSection,c.exploder,c.isInstantiated,c.isMerged,re.distinctFloors(this.viewer.scene,[o]);return e("div",{class:"custom-content"},[e("div",{on:{mouseenter:this.startScroll,mouseleave:this.stopScroll},class:"custom-label-wrapper"},[e("span",{class:"custom-label"},[s.label])]),a&&e("el-dropdown",{attrs:{size:"mini",placement:"right-start",trigger:"click"},class:"obj-dropdown",on:{command:this.handleDropdownCommand(i.id)}},[e("span",{on:{click:e=>e.stopPropagation()}},[e("i",{class:"el-icon-more"})]),e("el-dropdown-menu",{slot:"dropdown",class:"dropdown-menu"},[e("el-dropdown-item",{attrs:{command:lt.ZoomTo}},["Zoom to extent"]),e("el-dropdown-item",{attrs:{command:lt.Transparent}},[l&&""+this.checkMark,"Transparent"]),e("el-dropdown-item",{attrs:{command:lt.Wireframe}},[d&&""+this.checkMark,"Wireframe"]),e("el-dropdown-item",{attrs:{command:lt.Outline}},[h&&""+this.checkMark,"Outline"]),e("el-dropdown-item",{attrs:{command:lt.Material}},["Material manager"]),e("el-dropdown-item",{attrs:{command:lt.SectionBox}},[u&&""+this.checkMark,"Section box"]),e("el-dropdown-item",{attrs:{command:lt.SectionPlane}},[p&&""+this.checkMark,"Section plane"])])])])}render(){const e=arguments[0],t="BIM Tree",s={header:()=>t,content:()=>e("div",{class:"tree-wrapper",ref:"treeWrapper"},[e("el-input",{attrs:{placeholder:"your input...",size:"mini","prefix-icon":"el-icon-search",clearable:!0},class:"input-with-select",model:{value:this.filterText,callback:e=>{this.filterText=e}}}),e(st,{attrs:{"node-key":"id",height:this.treeHeight,data:this.bimTreeData,"default-checked-keys":this.defaultCheckedKeys,"show-checkbox":!0,"render-after-expand":!1,"render-content":this.renderContent,"filter-node-method":this.filterNode},ref:"tree",on:{"node-click":this.handleNodeClick,"check-change":this.handleCheckChange}})])};return e(ve,L()([{ref:"bimTreePanel",class:ht.a.bimTree,directives:[{name:"show",value:this.visible}],on:{close:this.close,resize:this.changeTreeHeight}},{scopedSlots:s}]))}};Object(m["a"])([Object(g["c"])({required:!0})],pt.prototype,"viewer",void 0),Object(m["a"])([Object(g["e"])("showBimTree")],pt.prototype,"onShowBimTreeChanged",null),Object(m["a"])([Object(g["e"])("filterText")],pt.prototype,"onFilterTextChanged",null),pt=Object(m["a"])([g["a"]],pt);var mt=pt,gt=s("e595"),ft=s.n(gt);let bt=class extends g["d"]{constructor(){super(...arguments),this.postmate=o.instance(),this.postmateHistories=[],this.postmateHistoryString=""}mounted(){this.$watch("viewer",e=>{e&&e.controls&&e.controls.addEventListener("change",this.updateCameraInfo)}),this.postmateHistories=this.postmate.getHistories()}updateCameraInfo(){if(!this.viewer||!this.viewer.scene||!this.viewer.camera||!this.viewer.controls)return;const e=this.viewer.camera,t=this.viewer.controls,s=e=>Math.round(e),i=e=>`(${s(e.x)}, ${s(e.y)}, ${s(e.z)})`,n=e.position,o=t.target;if(n){const e=this.$refs.eye;e&&(e.textContent=`Camera position: ${i(n)} | Camera target: ${i(o)}`)}}getObjectInfo(e,t){if(!(e instanceof y["nb"])&&!(e instanceof y["X"]))return;if(t.components++,e.geometry){const s=e.geometry;if(s.index&&s.index.count&&(t.faces+=Math.round(s.index.count/3)),s.attributes.position){const e=s.attributes.position;e.count&&e.itemSize&&(t.points+=e.count)}}const s=e=>{t.materials[e]?t.materials[e]++:t.materials[e]=0},i=e.material;i instanceof y["jb"]?s(i.id):Array.isArray(i)&&i.forEach(e=>s(e.id))}updatePostmateHistoryCount(){const e=this.$refs.postmateHistoryCount,t=this.postmateHistories.length;e.textContent=""+t;let s="",i=1;this.postmateHistories.forEach(e=>{s+=`${i++}. ${e.direction} message '${e.messageId}' at ${this.numToTime(e.time)}\n`}),this.postmateHistoryString=s}updateObjectsInfo(){const e=this.$refs.objectsInfo;if(!this.viewer.scene)return void(e&&(e.textContent="Failed!"));e.textContent="Comupting...";const t={components:0,points:0,faces:0,materials:{}},s=()=>{const s=Object.keys(t.materials).length;e.textContent=`Components: ${t.components}${t.points?", Points: "+t.points:""}${t.faces?", Faces: "+t.faces:""}${s?", Materials: "+s:""}`};this.viewer.scene.traverse(e=>{this.getObjectInfo(e,t),s()}),s()}numToTime(e){const t=new Date(e);return`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`}render(){const e=arguments[0];return e("div",{class:ft.a.bottomBar,ref:"bottomBar"},[e("div",{class:"main"},[e("div",{class:"message",style:"display: none"},[e("el-popover",{attrs:{placement:"top",width:"550",height:"300",trigger:"click"},class:"popover-message"},[e("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:this.postmateHistoryString,callback:e=>{this.postmateHistoryString=e}}}),e("i",{class:"el-icon-message",slot:"reference",attrs:{title:"Click to get messages"},on:{click:this.updatePostmateHistoryCount}})]),e("span",{ref:"postmateHistoryCount"},[" 0 "])]),e("el-popover",{attrs:{placement:"top",trigger:"click"}},[e("span",{ref:"objectsInfo"},[" -- "]),e("i",{class:"el-icon-info",slot:"reference",attrs:{title:"Click to get statistics"},on:{click:this.updateObjectsInfo}})]),e("span",{class:"separator"},[" | "]),e("el-popover",{attrs:{placement:"top",trigger:"click"}},[e("span",{ref:"eye"},["Camera position: --"]),e("i",{class:"el-icon-view",slot:"reference",attrs:{title:"Click to get camera info"},on:{click:this.updateCameraInfo}})]),e("span",{class:"separator"},[" | "]),e("el-popover",{attrs:{placement:"top",trigger:"click"}},[e("div",{class:"keys"},[e("span",["W: Move forward"]),e("br"),e("span",["A: Move backward"]),e("br"),e("span",["S: Move left"]),e("br"),e("span",["D: Move right"]),e("br"),e("span",["Ctrl: Move lower"]),e("br"),e("span",["Space: Move higher"]),e("br"),e("span",[": Rotate up"]),e("br"),e("span",[": Rotate to left"]),e("br"),e("span",[": Rotate to right"]),e("br"),e("span",[": Rotate to right"]),e("br")]),e("i",{class:"el-icon-more",slot:"reference",attrs:{title:"Click to get keyboard tips"},on:{click:this.updateCameraInfo}})])])])}};Object(m["a"])([Object(g["c"])({required:!0})],bt.prototype,"viewer",void 0),Object(m["a"])([Object(g["e"])("postmateHistories")],bt.prototype,"updatePostmateHistoryCount",null),bt=Object(m["a"])([g["a"]],bt);var vt=bt,wt=s("e1f3"),yt=s("d3ac");class xt extends y["Cb"]{constructor(e=!0){super(),this.name="COORDINATE_AXES",this.AXIS_LENGTH=1,this.AXIS_COLOR_X=16711680,this.AXIS_COLOR_Y=65280,this.AXIS_COLOR_Z=255;const t=new y["wc"](0,0,0),s=new y["wc"](1,0,0),i=new y["wc"](0,1,0),n=new y["wc"](0,0,1),o=new y["e"](s,t,this.AXIS_LENGTH,this.AXIS_COLOR_X,this.AXIS_LENGTH/5,this.AXIS_LENGTH/8),r=new y["e"](i,t,this.AXIS_LENGTH,this.AXIS_COLOR_Y,this.AXIS_LENGTH/5,this.AXIS_LENGTH/8),a=new y["e"](n,t,this.AXIS_LENGTH,this.AXIS_COLOR_Z,this.AXIS_LENGTH/5,this.AXIS_LENGTH/8);this.add(o,r,a),e&&this.addTexts()}addTexts(){(new wt["a"]).load("three/fonts/helvetiker_regular.typeface.json",e=>{const t=this.createText(e,"x",new y["n"](16711680)),s=this.createText(e,"y",new y["n"](65280)),i=this.createText(e,"z",new y["n"](255));t.position.set(this.AXIS_LENGTH,0,0),s.position.set(0,this.AXIS_LENGTH,0),i.position.set(0,0,this.AXIS_LENGTH),this.add(t,s,i)})}createText(e,t,s){const i=new yt["a"](t,{font:e,size:.3,height:.02,curveSegments:6,bevelEnabled:!1,bevelThickness:0,bevelSize:.01,bevelSegments:3}),n=new y["ub"]({flatShading:!0,transparent:!0,opacity:.6,emissive:s||new y["n"](65280)});return new y["nb"](i,n)}}class Et{constructor(e,t){this.height=100,this.width=100,this.width=e||this.width,this.height=t||this.height,this.init()}init(){this.initRenderer(),this.initScene(),this.animate()}initRenderer(){this.renderer=new y["Ac"]({antialias:!0,alpha:!0}),this.renderer.setSize(this.width,this.height)}initScene(){this.scene=new y["Xb"],this.camera=new y["Eb"](-1,1,1,-1,.1,100),this.scene.add(this.camera),this.coordinateAxes=new xt,this.scene.add(this.coordinateAxes)}render(){this.renderer&&this.scene&&this.camera&&(this.update(),this.renderer.render(this.scene,this.camera))}animate(){requestAnimationFrame(this.animate.bind(this)),this.render()}setHostRenderer(e){this.hostRenderer=e,this.update()}update(){if(!this.hostRenderer||!this.hostRenderer.camera)return;const e=this.hostRenderer.camera;if(e){const t=new y["wc"];e.getWorldDirection(t);const s=e.up;this.updateCameraDirection(t,s)}}updateCameraDirection(e,t){if(!this.camera||!e)return;e.normalize();const s=2,i=.3;this.camera.position.set(-e.x*s+i,-e.y*s+i,-e.z*s+i),this.camera.lookAt(i,i,i),this.camera.up=t}dispose(){this.scene&&this.camera&&this.coordinateAxes&&(this.scene.clear(),this.hostRenderer=void 0,this.camera=void 0,this.coordinateAxes=void 0,this.scene=void 0)}}var Ot=s("6728"),Mt=s.n(Ot);let Tt=class extends g["d"]{constructor(){super(...arguments),this.visible=!1,this.objectUuid=null,this.materials=[],this.materialData=[],this.selectedMaterialIndex=-1}mounted(){this.setPanelVisibility(!!this.visible),this.visible&&this.objectUuid&&this.getMaterials()}onObjectUuidForMaterialManagerChanged(e){e?(this.objectUuid=e,this.setPanelVisibility(!0)):this.setPanelVisibility(!1)}get objectUuidForMaterialManager(){return X.getters.getObjectUuidForMaterialManager}close(){this.setPanelVisibility(!1),X.commit(V.MUTATION_OBJECT_UUID_FOR_MATERIAL_MANAGER,null)}setPanelVisibility(e){this.visible=e,this.visible&&this.objectUuid&&(this.materials=[],this.materialData=[],this.getMaterials(),-1===this.selectedMaterialIndex&&this.materials.length>0&&(this.selectedMaterialIndex=0))}beforeDestroy(){this.setPanelVisibility(!1),this.materials=[],this.materialData=[]}getMaterials(){if(!this.viewer||!this.viewer.scene||!this.objectUuid)return[];const e=this.viewer.scene.getObjectByProperty("uuid",this.objectUuid);e&&this.getMaterialsInner(e)}getMaterialsInner(e){if(!e)return;e.children.length>0&&e.children.forEach(e=>this.getMaterialsInner(e));const t=e.material;t&&Array.isArray(t)&&t.length>0?t.forEach(e=>{this.checkAndAddMaterial(e)}):t instanceof y["jb"]&&this.checkAndAddMaterial(t)}checkAndAddMaterial(e){const t=this.materialData.find(t=>t.materialId===e.id);if(t)t.refCount++;else{this.materials.push(e);const t=e,s=t.color?this.color2Str(t.color):"";this.materialData.push({materialId:e.id,name:e.name,type:e.type,color:s,refCount:1})}}handleRowClick(e,t,s){this.selectedMaterialIndex=this.materials.findIndex(t=>t.id===e.materialId)}handleColorChange(e,t){const s=e;if(!s.color)return;const i=new y["n"](t);s.color.setRGB(i.r,i.g,i.b),this.viewer&&this.viewer.enableRender()}handleTransparentChange(e,t){e.transparent=t,this.viewer&&this.viewer.enableRender()}handleOpacityChange(e,t){e.opacity=t,this.viewer&&this.viewer.enableRender()}handleRoughnessChange(e,t){const s=e;null!=s.roughness&&(s.roughness=t,this.viewer&&this.viewer.enableRender())}handleMetalnessChange(e,t){const s=e;null!=s.metalness&&(s.metalness=t,this.viewer&&this.viewer.enableRender())}colorFormatter(e,t,s,i){const n=this.$createElement,o=e.materialId,r=this.materials.find(e=>e.id===o);let a="";r&&r.transparent&&(a=this.opacity2HexStr(r.opacity));const c=n("div",{class:"color-block",style:"background-color: "});return c.data&&c.data.style&&(c.data.style=`background-color: ${s}${a}`),c}color2Str(e){return"#"+e.getHexString()}opacity2HexStr(e){return Math.round(255*e).toString(16)}render(){const e=arguments[0],t="Material Manager",s={header:()=>t,content:()=>{let t="";if(this.selectedMaterialIndex>=0){const s=this.materials[this.selectedMaterialIndex];let i="#ffffff";s.color&&s.color.getHexString&&(i=this.color2Str(s.color)),t=e("div",{class:"material-editor"},[e("div",{class:"setting-row"},[e("div",{class:"setting-cell"},["Color"]),e("div",{class:"setting-cell"},[e("el-color-picker",{attrs:{value:i,size:"mini","color-format":"hex",disabled:!s.color},on:{input:e=>this.handleColorChange(s,e)}})])]),e("div",{class:"setting-row"},[e("div",{class:"setting-cell"},["Enable transparent"]),e("div",{class:"setting-cell"},[e("el-checkbox",{attrs:{value:s.transparent},on:{change:e=>this.handleTransparentChange(s,e)}})])]),e("div",{class:"setting-row"},[e("div",{class:"setting-cell"},["Opacity"]),e("div",{class:"setting-cell"},[e("el-slider",{attrs:{value:s.opacity||0,min:0,max:1,step:.1},on:{input:e=>this.handleOpacityChange(s,e)}})])]),e("div",{class:"setting-row"},[e("div",{class:"setting-cell"},["Roughness"]),e("div",{class:"setting-cell"},[e("el-slider",{attrs:{value:s.roughness||0,min:0,max:1,step:.1,disabled:null==s.roughness},on:{input:e=>this.handleRoughnessChange(s,e)}})])]),e("div",{class:"setting-row"},[e("div",{class:"setting-cell"},["Metalness"]),e("div",{class:"setting-cell"},[e("el-slider",{attrs:{value:s.metalness||0,min:0,max:1,step:.1,disabled:null==s.metalness},on:{input:e=>this.handleMetalnessChange(s,e)}})])])])}else t=e("div",{class:"material-editor"},[e("span",{class:"no-selection"},["Please choose a material"])]);return e("div",{class:"popup-body"},[e("div",{class:"object-info"},[e("span",["Object Uuid: ",this.objectUuid])]),e("el-table",{attrs:{data:this.materialData,size:"mini",border:!0,stripe:!0,"highlight-current-row":!0,width:"100%","max-height":"200"},on:{"row-click":this.handleRowClick}},[e("el-table-column",{attrs:{prop:"materialId",width:"80",label:"Id",align:"center",fixed:!0,sortable:!0,"show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"name",width:"*",label:"Name","header-align":"center",sortable:!0,"show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"type",width:"*",label:"Type","header-align":"center",sortable:!0,"show-overflow-tooltip":!0}}),e("el-table-column",{attrs:{prop:"color",width:"50",label:"Color",align:"center",formatter:this.colorFormatter}}),e("el-table-column",{attrs:{prop:"refCount",width:"100",label:"Ref count",align:"center",sortable:!0,"show-overflow-tooltip":!0}})]),t])}};return e(ve,L()([{ref:"materialManagerPanel",class:Mt.a.materialManager,directives:[{name:"show",value:this.visible}],on:{close:this.close}},{scopedSlots:s}]))}};Object(m["a"])([Object(g["c"])({required:!0})],Tt.prototype,"viewer",void 0),Object(m["a"])([Object(g["e"])("objectUuidForMaterialManager")],Tt.prototype,"onObjectUuidForMaterialManagerChanged",null),Tt=Object(m["a"])([g["a"]],Tt);var Ct=Tt,St=s("7130"),Pt=s.n(St);const jt=s("424d"),At={duration:100,from:{color:"#409EFF"},to:{color:"#67C23A"},strokeWidth:1,trailWidth:.4,step:function(e,t){t.path.setAttribute("stroke",e.color)},text:{style:{color:"#888888"},autoStyleContainer:!0},easing:"easeInOut"};let kt=class extends g["d"]{mounted(){this.initProgressbar()}beforeDestroy(){this.progressBar.destroy()}updateProgressBar(e){e<100?this.progressBar.setText(`${this.text}: ${e}%`):this.progressBar.setText("Loaded, a moment please..."),this.progressBar.animate(e/100)}initProgressbar(){this.progressBar=new jt.Line(this.$refs.progressBar,At)}render(){const e=arguments[0];return e("div",{class:Pt.a.progressBarWrapper},[e("div",{ref:"progressBar",class:Pt.a.progressBar})])}};Object(m["a"])([Object(g["c"])({default:0})],kt.prototype,"progressValue",void 0),Object(m["a"])([Object(g["c"])({default:"Loading..."})],kt.prototype,"text",void 0),Object(m["a"])([Object(g["e"])("progressValue")],kt.prototype,"updateProgressBar",null),kt=Object(m["a"])([g["a"]],kt);var _t=kt,It=s("96ca"),Nt=s.n(It);let Rt=class extends g["d"]{constructor(){super(...arguments),this.activeName="1",this.settings=F}changeTab(e){}initProjectSettings(){const e=localStorage.getItem($+"_"+this.projectId)&&JSON.parse(localStorage.getItem($+"_"+this.projectId)||""),t=Object(B["cloneDeep"])(F);e&&Object.assign(t,Object(B["cloneDeep"])(e)),this.settings=t}restore(e){1===e&&(this.settings.unit=F.unit,this.settings.decimalPrecision=F.decimalPrecision,this.settings.camera=F.camera),2===e&&(this.settings.mouse=F.mouse,this.settings.keyboard=F.keyboard)}close(){this.$emit("update:visible",!1)}save(){this.$store.commit(V.MUTATION_PROJECT_SETTINGS,this.settings),localStorage.setItem($+"_"+this.projectId,JSON.stringify(this.settings)),this.viewer&&this.viewer.updateProjectSettings(this.settings),this.close()}mounted(){this.initProjectSettings()}render(){const e=arguments[0],t=[],s=[];let i;for(i in z)t.push(e("el-option",{attrs:{value:z[i],label:i}}));for(i in H)s.push(e("el-option",{attrs:{value:H[i],label:i}}));return e("div",{class:Nt.a.psetting},[e("el-tabs",{on:{tabClick:this.changeTab},model:{value:this.activeName,callback:e=>{this.activeName=e}}},[e("el-tab-pane",{attrs:{label:"Common",name:"1"}},[e("div",{ref:"panel1"},[e("el-form",{ref:"form"},[e("el-form-item",{attrs:{label:"Units"}},[e("el-select",{attrs:{value:this.settings.unit},on:{input:e=>this.settings.unit=e}},[t])]),e("el-form-item",{attrs:{label:"Precision"}},[e("el-select",{attrs:{value:this.settings.decimalPrecision},on:{input:e=>this.settings.decimalPrecision=e}},[s])]),e("h3",{style:"margin-bottom:20px;margin-bottom:20px;"},["Camera:"]),e("div",{class:Nt.a.sliderWrap},[e("span",{class:"demonstration"},["Near:"]),e("el-slider",{attrs:{step:.1,min:G[0],max:G[1]},model:{value:this.settings.camera.near,callback:e=>{this.$set(this.settings.camera,"near",e)}}})]),e("div",{class:Nt.a.sliderWrap},[e("span",{class:"demonstration"},["Far:"]),e("el-slider",{attrs:{step:1,min:U[0],max:U[1]},model:{value:this.settings.camera.far,callback:e=>{this.$set(this.settings.camera,"far",e)}}})]),e("p",{style:"text-align:center;margin-bottom:20px;"},[e("el-button",{on:{click:()=>this.restore(1)}},["Reset Settigns"])]),e("p",{class:Nt.a.btnWrap},[e("el-button",{on:{click:()=>{this.close()}}},["Cancel"]),e("el-button",{on:{click:()=>{this.save()}}},["Save"])])])])]),e("el-tab-pane",{attrs:{label:"Navigation",name:"2"}},[e("div",{ref:"panel2"},[e("el-form",{ref:"form2",attrs:{"label-width":"100px"}},[e("el-form-item",{attrs:{label:"Mouse Sensitivity"}},[e("el-slider",{style:"margin-right:10px;",attrs:{value:this.settings.mouse.sensitivity,min:W[0],max:W[1]},on:{input:e=>{this.settings.mouse.sensitivity=e}}})]),e("el-form-item",{attrs:{label:"Keyboard Sensitivity"}},[e("el-slider",{style:"margin-right:10px;",attrs:{value:this.settings.keyboard.sensitivity,min:W[0],max:W[1]},on:{input:e=>{this.settings.keyboard.sensitivity=e}}})]),e("p",{style:"text-align:center;margin-bottom:20px;"},[e("el-button",{on:{click:()=>this.restore(2)}},["Reset Settigns"])]),e("p",{class:Nt.a.btnWrap},[e("el-button",{on:{click:()=>{this.close()}}},["Cancel"]),e("el-button",{on:{click:()=>{this.save()}}},["Save"])])])])])])])}};Object(m["a"])([Object(g["c"])({required:!0})],Rt.prototype,"projectId",void 0),Object(m["a"])([Object(g["c"])({required:!0})],Rt.prototype,"viewer",void 0),Rt=Object(m["a"])([g["a"]],Rt);var Lt=Rt;const Bt=(e,t)=>{p.a.error(`${e} ${t?"("+t+")":""}`)},Dt=e=>{const{response:t,code:s,message:i}=e;if(t){const{status:e}=t,{error:s}=t.data;switch(e){case 404:Bt(s&&s.errorMsg||"Not found",e);break;case 500:Bt(s&&s.errorMsg||"Server internal error",e);break;default:s.errorMsg&&Bt(s.errorMsg,s.code)}}else"ECONNABORTED"===s&&i.indexOf("timeout")>-1?Bt("Request timeout",s):Bt(i)};function Ft(e){const{code:t,msg:s}=e.data;switch(t){default:return e}}function Gt(e,t,s){return`${e}&${t}`+(s?"&"+JSON.stringify(s):"")}function Ut(e){D.a.remove(K["default"].prototype.$pendingRequests,t=>{if(t.id===e)return t.cancel(),!0})}const zt=E.a.create({timeout:12e4});zt.defaults.headers.post["Content-Type"]="application/json;charset=UTF-8",zt.interceptors.request.use(e=>{if(e.url){const t=Gt(e.url,e.method,e.data);Ut(t),e.cancelToken=new E.a.CancelToken(e=>{K["default"].prototype.$pendingRequests&&K["default"].prototype.$pendingRequests.push({id:t,cancel:e})})}return e},e=>Promise.reject(e)),zt.interceptors.response.use(e=>{if(e.config.url){const t=Gt(e.config.url,e.config.method,e.config.data);Ut(t)}return Ft(e)},e=>e&&e.constructor&&"Cancel"===e.constructor.name?{data:{}}:(Dt(e),Promise.reject(e)));var Wt=zt,Ht=s("99f3"),$t=s.n(Ht);function Vt(e,t,s={}){return Wt.get(e,{...s,params:t,paramsSerializer:e=>$t.a.stringify(e)})}async function Kt(e){const t=await Vt(e);return t.data}var qt=s("b9d3"),Jt=s.n(qt);let Xt=class extends g["d"]{constructor(){super(...arguments),this.jsonComponents=[],this.propData=[],this.visible=!1}async updatePropData(e){if(!this.visible)return;this.propData=this.getObjectAttributes(e);const t=this.getPropDataFormJson(e,this.jsonComponents);t&&t.length>0&&this.propData.concat(t)}onShowBimTreeChanged(e){this.setPanelVisibility(e)}get showPropertyPanel(){return this.$store.getters.getShowPropertyPanel}setPanelVisibility(e){this.visible=e}mounted(){}async onActiveProjectChanged(e,t){e&&e.id}get activeProject(){return this.$store.getters.getActiveProject}getObjectAttributes(e){if(!e)return[];const t=[];let s=this.scene.getObjectByProperty("uuid",e);if(s||(s=re.findFirst(this.scene,e)),s){s.name&&t.push({name:"name",value:s.name}),t.push({name:"id",value:s.id}),t.push({name:"uuid",value:s.uuid}),t.push({name:"type",value:s.constructor.name||s.type});const e=Object.keys(s.userData);if(e.length>0){let i="";e.forEach(e=>{i&&(i+=", "),i+=`${e}: ${s&&s.userData[e]}`}),t.push({name:"userData",value:i})}}return t}async setComponents(e){if(e&&e.models.length>0)for(const t of e.models){const e=t.propertyFile;if(e){const t=await Kt(e);t&&t.objects&&this.jsonComponents.push(...t.objects.components)}}}getPropDataFormJson(e,t){if(t.length>0){var s;const i=null===(s=t.find(t=>t.uuid===e))||void 0===s?void 0:s.userData;if(i)return Object.keys(i).map(e=>({name:e,value:i[e]}))}return[]}render(){const e=arguments[0];return e("div",{class:Jt.a.tableWrapper,directives:[{name:"show",value:this.visible&&this.propData.length}]},[e("el-table",{attrs:{data:this.propData,size:"mini",border:!0,"max-height":"200"}},[e("el-table-column",{attrs:{prop:"name",width:"100",label:"Name"}}),e("el-table-column",{attrs:{prop:"value",width:"200",label:"Value"}})])])}};Object(m["a"])([Object(g["c"])({required:!0})],Xt.prototype,"scene",void 0),Object(m["a"])([Object(g["c"])({required:!0})],Xt.prototype,"objId",void 0),Object(m["a"])([Object(g["e"])("objId")],Xt.prototype,"updatePropData",null),Object(m["a"])([Object(g["e"])("showPropertyPanel")],Xt.prototype,"onShowBimTreeChanged",null),Object(m["a"])([Object(g["e"])("activeProject")],Xt.prototype,"onActiveProjectChanged",null),Xt=Object(m["a"])([g["a"]],Xt);var Yt=Xt,Zt=s("76da"),Qt=s.n(Zt);let es=class extends g["d"]{constructor(){super(...arguments),this.type="image/png",this.quality=.5,this.imageData="",this.visible=!1}mounted(){this.setPanelVisibility(!!this.visible)}onShowSnapshotPanelChanged(e){this.setPanelVisibility(e)}get showSnapshotPanel(){return this.$store.getters.getShowSnapshotPanel}setPanelVisibility(e){this.visible=e;const t=this.$refs.snapshotPanel;t.style.display=e?"":"none",e&&this.regenerateImageData()}regenerateImageData(){this.canvas&&(this.imageData=this.canvas.toDataURL(this.type,this.quality))}close(){this.setPanelVisibility(!1),X.commit(V.MUTATION_SHOW_SNAPSHOT_PANEL,!1)}render(){const e=arguments[0];return e("div",{ref:"snapshotPanel",class:Qt.a.snapshotPanel},[e("div",{class:"popup-title"},[e("span",{class:"popup-title-span"},["Snapshot"]),e("el-button",{attrs:{icon:"el-icon-close"},class:"popup-title-close",on:{click:this.close}})]),e("div",{class:"image-container"},[e("img",{attrs:{id:"image",src:this.imageData,title:"Right click to download it"},class:"image"}),e("a",{attrs:{href:this.imageData,download:"snapshot.png"},class:"download-icon"},["Download"])])])}};Object(m["a"])([Object(g["c"])({required:!0})],es.prototype,"canvas",void 0),Object(m["a"])([Object(g["e"])("showSnapshotPanel")],es.prototype,"onShowSnapshotPanelChanged",null),es=Object(m["a"])([g["a"]],es);var ts,ss=es,is=s("f157"),ns=s.n(is),os=s("cc51"),rs=s("b794"),as=s("09d8"),cs=s("c3f6"),ls=s("2142"),ds=s("e6af"),hs=s("6dd0"),us=s("6007"),ps=s("f35e"),ms=s("749d"),gs=s("278c"),fs=s("1938"),bs=s("d186"),vs=s("2e35"),ws=s("e1c2"),ys=s("6b2f"),xs=s("bf22"),Es=s("e0cc"),Os=s("4858"),Ms=s("1f91");s("5ff0"),s("00b8"),s("432b"),s("ade7"),s("27b1"),s("c98e"),s("c0ba"),s("3f3b"),s("dd3b"),s("d3ea");(function(e){e[e["NULL"]=0]="NULL",e[e["POINT"]=1]="POINT",e[e["POLYLINE"]=3]="POLYLINE",e[e["POLYGON"]=5]="POLYGON"})(ts||(ts={}));class Ts{parse(e){var t={},s=new DataView(e),i=0;if(t.fileCode=s.getInt32(i,!1),9994!=t.fileCode)throw new Error("Unknown file code: "+t.fileCode);i+=24,t.wordLength=s.getInt32(i,!1),t.byteLength=2*t.wordLength,i+=4,t.version=s.getInt32(i,!0),i+=4,t.shapeType=s.getInt32(i,!0),i+=4,t.minX=s.getFloat64(i,!0),t.minY=s.getFloat64(i+8,!0),t.maxX=s.getFloat64(i+16,!0),t.maxY=s.getFloat64(i+24,!0),t.minZ=s.getFloat64(i+32,!0),t.maxZ=s.getFloat64(i+40,!0),t.minM=s.getFloat64(i+48,!0),t.maxM=s.getFloat64(i+56,!0),i+=64,t.records=[];while(i<t.byteLength){var n={};n.number=s.getInt32(i,!1),i+=4,n.length=s.getInt32(i,!1),i+=4;try{n.shape=this.parseShape(s,i,n.length)}catch(o){console.log(o,n)}i+=2*n.length,t.records.push(n)}return t}parseShape(e,t,s){var i=0,n=null,o={};switch(o.type=e.getInt32(t,!0),t+=4,o.type){case ts.NULL:break;case ts.POINT:o.content={x:e.getFloat64(t,!0),y:e.getFloat64(t+8,!0)};break;case ts.POLYLINE:case ts.POLYGON:for(n=o.content={minX:e.getFloat64(t,!0),minY:e.getFloat64(t+8,!0),maxX:e.getFloat64(t+16,!0),maxY:e.getFloat64(t+24,!0),parts:new Int32Array(e.getInt32(t+32,!0)),points:new Float64Array(2*e.getInt32(t+36,!0))},t+=40,i=0;i<n.parts.length;i++)n.parts[i]=e.getInt32(t,!0),t+=4;for(i=0;i<n.points.length;i++)n.points[i]=e.getFloat64(t,!0),t+=8;break;case 8:case 11:case 13:case 15:case 18:case 21:case 23:case 25:case 28:case 31:throw new Error("Shape type not supported: "+o.type+":"+ +o.type);default:throw new Error("Unknown shape type at "+(t-4)+": "+o.type)}return o}}class Cs{constructor(e){this.buffer=e,this.u8=new Uint8Array(e)}getBit(e){var t=this.u8[e>>3],s=7&e;return(t&128>>s)>>7-s}setBit(e,t){var s=e>>3,i=this.u8[s],n=7&e;this.u8[s]=t?i|128>>n:i&~(128>>n)}getInt12(e){var t=e/8|0,s=this.u8[t],i=this.u8[t+1],n=this.u8[t+2],o=e%8,r=8-o,a=Math.min(12-r,8),c=Math.max(12-r-a,0),l=~(255<<r),d=255<<8-a,h=255<<8-c;return s&=l,i&=d,n&=h,((s<<16)+(i<<8)+n>>12-o)-2048}setInt12(e,t){t+=2048;var s=e/8|0,i=e%8,n=t<<12-i,o=(16711680&n)>>16,r=(65280&n)>>8,a=255&n,c=8-i,l=Math.min(12-c,8),d=Math.max(12-c-l,0),h=255<<c;this.u8[s]=(this.u8[s]&h)+o;var u=~(255<<8-l);this.u8[s+1]=(this.u8[s+1]&u)+r;var p=~(255<<8-d);this.u8[s+2]=(this.u8[s+2]&p)+a}getInt6(e){var t=e/8|0,s=this.u8[t],i=this.u8[t+1],n=e%8,o=8-n,r=Math.max(6-o,0),a=~((255<<o)+(255>>8-(2-n))),c=255<<8-r;return s&=a,i&=c,((s<<8)+i>>10-n)-32}setInt6(e,t){t+=32;var s=e/8|0,i=e%8,n=t<<10-i,o=(65280&n)>>8,r=255&n,a=8-i,c=Math.max(6-a,0),l=(255<<a)+(255>>8-(2-i));this.u8[s]=(this.u8[s]&l)+o;var d=~(255<<8-c);this.u8[s+1]=(this.u8[s+1]&d)+r}test(){var e,t,s=new ArrayBuffer(3),i=new Cs(s);for(t=0;t<12;t++)for(e=-2048;e<2048;e++)if(i.setInt12(t,e),i.getInt12(t)!=e){console.log("12-bit prob at",t,e),console.log("expected",e,"got",i.getInt12(t));break}for(t=0;t<18;t++)for(e=-32;e<32;e++)if(i.setInt6(t,e),i.getInt6(t)!=e){console.log("6-bit prob at",t,e),console.log("expected",e,"got",i.getInt6(t));break}return i}}class Ss{constructor(){this.LINE_MATERIAL=new y["Y"]({color:0,linewidth:2,opacity:.8,transparent:!0}),this.MESH_MATERIAL=new y["ob"]({color:1926655,opacity:.8,transparent:!0})}createModel(e){for(var t=[],s=[],i=0;i<e.records.length;i++){var n=e.records[i].shape;if(n.type===ts.POLYLINE||n.type===ts.POLYGON)for(var o=n.content.points,r=n.content.parts,a=0;a<r.length;a++){const e=[];for(var c=r[a],l=r[a+1]||o.length/2;c<l;c++){var d=o[2*c],h=o[2*c+1];e.push(new y["wc"](d,h,0))}if(n.type===ts.POLYGON){const i=y["ac"].triangulateShape(e,[]),n=[];i.forEach(e=>n.push(...e));const o=new y["k"];o.setFromPoints(e),o.setIndex(n),t.push(o);const r=new y["k"];e.length>2&&!e[0].equals(e[e.length-1])&&e.push(e[0]),r.setFromPoints(e),s.push(r)}else{const t=new y["k"];t.setFromPoints(e),s.push(t)}}}var u=new y["Cb"];for(i=0;i<s.length;i++)u.add(new y["X"](s[i],this.LINE_MATERIAL));for(i=0;i<t.length;i++)u.add(new y["nb"](t[i],this.MESH_MATERIAL));return console.log("parsed",t.length,s.length),u}loadCompressed(e){for(var t=this.deltaDecode6(e),s=[],i=[],n=0;n<t.length;n++){let e=[];if(-32768!==t[n]){var o=180*t[n]/32767,r=180*t[n+1]/32767;n++,e.push(new y["wc"](o,r,0))}else{for(var a=[],c=1;c<e.length;c++)e[c-1].x==e[c].x&&e[c-1].y==e[c].y||a.push(e[c]);const t=new y["k"];t.setFromPoints(a),s.push(t),e=[]}}var l=new y["Cb"];for(n=0;n<i.length;n++)l.add(new y["X"](i[n],this.LINE_MATERIAL));for(n=0;n<s.length;n++)l.add(new y["nb"](s[n],this.MESH_MATERIAL));return console.log("parsed compressed",s.length,i.length),l}compress(e){for(var t=[],s=0;s<e.records.length;s++){var i=e.records[s].shape;if(i.type===ts.POLYGON)for(var n=i.content.points,o=i.content.parts,r=0;r<o.length;r++){for(var a=o[r],c=o[r+1]||n.length/2;a<c;a++){var l=n[2*a],d=n[2*a+1];t.push(l/180*32767,d/180*32767)}t.push(-32768)}}var h=new Int16Array(t);console.log("16-bit quantized byteLength",h.buffer.byteLength);var u=this.deltaEncode6(h);return console.log("delta-encoded byteLength",u.byteLength),u}deltaEncode(e){for(var t=[],s=[],i=[],n=0,o=0,r=0,a=0;a<e.length;a++)-32768!=e[a]?0==i.length?(n=e[a],o=e[a+1],i.push(n,o),r+=4,a++):Math.abs(n-e[a])>1023||Math.abs(o-e[a+1])>1023?(s.push(i),r+=1,i=[],n=e[a],o=e[a+1],i.push(n,o),r+=4,a++):(i.push((e[a]-n)/8,(e[a+1]-o)/8),n+=8*((e[a]-n)/8|0),o+=8*((e[a+1]-o)/8|0),r+=2,a++):(s.push(i),t.push(s),s=[],i=[],r+=3);return this.storeDeltas(r,t)}deltaEncode6(e){var t=[],s=[],i=[],n=0,o=0,r=0,a=0;for(r=0;r<e.length;r++)e[r]=0|e[r]/16;for(r=0;r<e.length;r++)-2048!==e[r]?0==i.length?(n=e[r],o=e[r+1],i.push(n,o),a+=4,r++):Math.abs(n-e[r])>31||Math.abs(o-e[r+1])>31?(s.push(i),a+=1,i=[],n=e[r],o=e[r+1],i.push(n,o),a+=4,r++):(i.push(e[r]-n,e[r+1]-o),n+=e[r]-n,o+=e[r+1]-o,a+=2,r++):(s.push(i),t.push(s),s=[],i=[],a+=3);return this.storeDeltas6(a,t)}storeDeltas(e,t){for(var s=new ArrayBuffer(e),i=new DataView(s),n=0,o=0;o<t.length;o++){for(var r=t[o],a=0;a<r.length;a++){var c=r[a];i.setInt16(n,c[0]),n+=2,i.setInt16(n,c[1]),n+=2;for(var l=2;l<c.length;l++)i.setInt8(n++,c[l]);i.setInt8(n,-128),n+=1}i.setInt16(n,-32768),n+=2}return s}deltaDecode(e){var t=new DataView(e),s=0,i=[];while(s<e.byteLength){var n=t.getInt16(s);if(s+=2,-32768!==n){var o=t.getInt16(s);s+=2,i.push(n,o);while(s<e.byteLength){var r=t.getInt8(s);if(s++,-128==r)break;var a=t.getInt8(s);s++,n+=8*r,o+=8*a,i.push(n,o)}}else i.push(-32768)}return i}storeDeltas6(e,t){for(var s=new ArrayBuffer(Math.ceil(.75*e)+4),i=new Cs(s),n=32,o=0;o<t.length;o++){for(var r=t[o],a=0;a<r.length;a++){var c=r[a];i.setInt12(n,c[0]),n+=12,i.setInt12(n,c[1]),n+=12;for(var l=2;l<c.length;l++)i.setInt6(n,c[l]),n+=6;i.setInt6(n,-32),n+=6}i.setInt12(n,-2048),n+=12}return new DataView(s).setUint32(0,n),s}deltaDecode6(e){var t=new DataView(e).getUint32(0),s=new Cs(e),i=32,n=[];while(i<t){var o=s.getInt12(i);if(i+=12,-2048!==o){var r=s.getInt12(i);i+=12,n.push(o,r);while(i<t){var a=s.getInt6(i);if(i+=6,-32===a)break;var c=s.getInt6(i);i+=6,o+=a,r+=c,n.push(o,r)}}else n.push(-2048)}for(var l=0;l<n.length;l++)n[l]*=16;return n}}class Ps{async load(e,t,s,i){this.updateProgress(s,0);const n=new XMLHttpRequest;n.responseType="arraybuffer",n.onload=()=>{this.updateProgress(s,50);const e=new Ts,i=e.parse(n.response),o=(new Ss).createModel(i);this.updateProgress(s,99),t(o)},n.onerror=onerror,n.open("GET",e),n.send(null)}updateProgress(e,t){if(e){const s={lengthComputable:!0,loaded:t,total:100};e(new ProgressEvent("progress",s))}}}class js{constructor(){this.vertexShader="\n    varying vec2 vUv;\n    void main( void ) {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);\n    }",this.fragmentShader="\n    uniform vec3 keyColor;\n    uniform float similarity;\n    uniform float smoothness;\n    varying vec2 vUv;\n    uniform sampler2D map;\n    void main() {\n        vec4 videoColor = texture2D(map, vUv);\n\n        float Y1 = 0.299 * keyColor.r + 0.587 * keyColor.g + 0.114 * keyColor.b;\n        float Cr1 = keyColor.r - Y1;\n        float Cb1 = keyColor.b - Y1;\n        \n        float Y2 = 0.299 * videoColor.r + 0.587 * videoColor.g + 0.114 * videoColor.b;\n        float Cr2 = videoColor.r - Y2; \n        float Cb2 = videoColor.b - Y2; \n        \n        float blend = smoothstep(similarity, similarity + smoothness, distance(vec2(Cr2, Cb2), vec2(Cr1, Cb1)));\n        gl_FragColor = vec4(videoColor.rgb, videoColor.a * blend); \n    }";const e=document.createElement("video");this.webcam=e;const t={video:{width:600,height:400}};navigator.mediaDevices.getUserMedia(t).then(t=>{e.srcObject=t,e.onloadedmetadata=t=>{e.setAttribute("autoplay","true"),e.setAttribute("playsinline","true"),e.play()}}).catch((function(e){alert(e.name+": "+e.message)})),this.webcamCanvas=document.createElement("canvas");const s=this.webcamCanvas.getContext("2d");this.canvasCtx=s,s.fillStyle="#000000",s.fillRect(0,0,this.webcamCanvas.width,this.webcamCanvas.height);const i=new y["mc"](this.webcamCanvas);this.webcamTexture=i,i.minFilter=y["bb"],i.magFilter=y["bb"],this.shaderMaterial=new y["Yb"]({transparent:!0,uniforms:{map:{value:i},keyColor:{value:[0,1,0]},similarity:{value:.3},smoothness:{value:0}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}getShaderMaterial(){return this.shaderMaterial}createWebCamPlane(e=5,t=4){const s=new y["Jb"](e,t);return new y["nb"](s,this.shaderMaterial)}animate(){this.webcam.readyState===this.webcam.HAVE_ENOUGH_DATA&&(this.canvasCtx.drawImage(this.webcam,0,0,this.webcamCanvas.width,this.webcamCanvas.height),this.webcamTexture.needsUpdate=!0)}}class As{static checkFullScreen(){const e=document,t=e.mozCancelFullScreen||window.oRequestFullscreen||e.webkitIsFullScreen||e.msFullscreenEnabled;return t}static fullScreen(){const e=document.documentElement,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen;t.call(e)}static exitFullscreen(){const e=document,t=e.exitFullScreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;t.call(e)}static displayPointMarker(e,t,s=1e3,i=10){const n=document.createElement("div");n.style.cssText=`display: block; width: ${i}px; height: ${i}px; border-radius: 50%; background: #505050; opacity: 0.2`;const o=new os["a"](n);return o.position.set(t.x,t.y,t.z),e.add(o),s&&setTimeout(()=>{e.remove(o)},s),o}}var ks=s("01af");function _s(){const e=document.createElement("div");e.setAttribute("style","height: 1in; visibility: hidden; position: absolute; margin: 0; padding: 0;"),document.body.appendChild(e);const t=e.clientHeight,s=.0254;return s/t}const Is={file:1,m:1,mm:.001,cm:.01,ft:.3048,in:.0254,pt:_s()},Ns={file:"m",m:"m",mm:"mm",cm:"cm",ft:"ft",in:"in",pt:"pt"},Rs=e=>2===e?"":3===e?"":"",Ls=(e,t=1)=>Ns[e]+Rs(t),Bs=(e,t,s,i=1)=>{if(null!==s&&void 0!==s||(s=t),s===t)return{value:e,unit:Ls(s)};{const n=e*Math.pow(Is[t]/Is[s],i);return{value:n,unit:Ls(s)+Rs(i)}}},Ds=(e,t)=>{const s=e.toFixed(t===H["Precision from file"]?2:t);return s};var Fs;(function(e){e["Distance"]="Distance",e["Area"]="Area",e["Angle"]="Angle"})(Fs||(Fs={}));class Gs{constructor(e,t,s,i,n=Fs.Distance,o){this.isCompleted=!1,this.mouseMoved=!1,this.pointMarkers=[],this.labels=[],this.pointArray=[],this.mousedown=e=>{this.mouseMoved=!1},this.mousemove=e=>{this.mouseMoved=!0;const t=this.getClosestIntersection(e);if(t&&(this.tempPointMarker?this.tempPointMarker.position.set(t.x,t.y,t.z):(this.tempPointMarker=this.createPointMarker(t),this.scene.add(this.tempPointMarker)),this.pointArray.length>0)){const e=this.pointArray[this.pointArray.length-1],s=this.tempLine||this.createLine(),i=s.geometry,n=this.pointArray[0],o=this.pointArray[this.pointArray.length-1];if(this.mode===Fs.Area?i.setFromPoints([o,t,n]):i.setFromPoints([o,t]),this.mode===Fs.Distance){const s=e.distanceTo(t),i=`${Ds(Bs(s,z["Unit from file"],this.settings.unit).value,this.settings.decimalPrecision)} ${this.getUnitString()}`,n=new y["wc"]((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2);this.addOrUpdateTempLabel(i,n)}this.tempLine||(this.scene.add(s),this.tempLine=s)}},this.mouseup=e=>{this.mouseMoved||this.onMouseClicked(e)},this.dblclick=e=>{this.complete()},this.onMouseClicked=e=>{if(!this.raycaster||!this.camera||!this.scene||this.isCompleted)return;const t=this.getClosestIntersection(e);if(!t)return;const s=Date.now();if(this.lastClickTime&&s-this.lastClickTime<500)return;this.lastClickTime=s,this.pointArray.push(t);const i=this.pointArray.length,n=this.createPointMarker(t);if(this.pointMarkers.push(n),this.scene.add(n),this.polyline&&(this.polyline.geometry.setFromPoints(this.pointArray),this.tempLabel&&i>1)){const e=this.pointArray[i-2];this.tempLabel.position.set((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),this.scene.add(this.tempLabel),this.labels.push(this.tempLabel),this.tempLabel=void 0}if(this.mode===Fs.Area&&this.faces){const e=this.faces.geometry,s=this.faces.userData.vertices;s.push(t),e.setFromPoints(s);const i=s.length;if(i>2){const t=[];for(let e=1;e<i-1;++e)t.push(0,e,e+1);e.setIndex(t),e.computeVertexNormals()}}this.mode===Fs.Angle&&this.pointArray.length>=3&&this.complete()},this.keydown=e=>{"Enter"===e.key?this.complete():"Escape"===e.key&&this.cancel()},this.getClosestIntersection=e=>{if(!this.raycaster||!this.camera||!this.scene||this.isCompleted)return;const t=e.clientX,s=e.clientY,i=new y["vc"];i.x=t/this.renderer.domElement.clientWidth*2-1,i.y=-s/this.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(i,this.camera);let n=this.raycaster.intersectObject(this.scene,!0)||[];return n&&n.length>0&&(n=n.filter(e=>e.object.name!==Gs.OBJ_NAME&&e.object.visible),n.length>0&&n[0].distance<Gs.MAX_DISTANCE)?n[0].point:null},this.mode=n,this.renderer=e,this.scene=t,this.camera=s,this.controls=i,this.settings=o}get canvas(){return this.renderer.domElement}open(){this.canvas.addEventListener("pointerdown",this.mousedown),this.canvas.addEventListener("pointermove",this.mousemove),this.canvas.addEventListener("pointerup",this.mouseup),this.canvas.addEventListener("dblclick",this.dblclick),window.addEventListener("keydown",this.keydown),this.pointArray=[],this.raycaster=new y["Tb"],this.polyline=this.createLine(),this.scene.add(this.polyline),this.mode===Fs.Area&&(this.faces=this.createFaces(),this.scene.add(this.faces)),this.isCompleted=!1,this.renderer.domElement.style.cursor="crosshair"}close(){this.canvas.removeEventListener("pointerdown",this.mousedown),this.canvas.removeEventListener("pointermove",this.mousemove),this.canvas.removeEventListener("pointerup",this.mouseup),this.canvas.removeEventListener("dblclick",this.dblclick),window.removeEventListener("keydown",this.keydown),this.tempPointMarker&&this.scene.remove(this.tempPointMarker),this.tempLine&&this.scene.remove(this.tempLine),this.tempLabel&&this.scene.remove(this.tempLabel),this.pointMarkers.forEach(e=>this.scene.remove(e)),this.polyline&&this.scene.remove(this.polyline),this.faces&&this.scene.remove(this.faces),this.curve&&this.scene.remove(this.curve),this.labels.forEach(e=>this.scene.remove(e)),this.pointArray=[],this.raycaster=void 0,this.tempPointMarker=void 0,this.tempLine=void 0,this.tempLabel=void 0,this.pointMarkers=[],this.polyline=void 0,this.labels=[],this.renderer.domElement.style.cursor=""}initPointMarkerMaterial(){const e=(new y["nc"]).load("images/circle.png");this.spriteMaterial=new y["jc"]({map:e,depthTest:!1,depthWrite:!1,sizeAttenuation:!1,opacity:.8})}createPointMarker(e){this.spriteMaterial||this.initPointMarkerMaterial();const t=e,s=.012,i=new y["ic"](this.spriteMaterial);return i.scale.set(s,s,s),t&&i.position.set(t.x,t.y,t.z),i.name=Gs.OBJ_NAME,i}createLine(e=Gs.LINE_MATERIAL){const t=new y["k"],s=new y["X"](t,e);return s.frustumCulled=!1,s.name=Gs.OBJ_NAME,s}createFaces(){const e=new y["k"],t=new y["nb"](e,Gs.MESH_MATERIAL);return t.userData.vertices=[],t.frustumCulled=!1,t.name=Gs.OBJ_NAME,t}complete(){if(this.isCompleted)return;let e=!1,t=!1;const s=this.pointArray.length;if(this.mode===Fs.Area&&this.polyline)if(s>2){const e=this.pointArray[0];this.polyline.geometry.setFromPoints([...this.pointArray,e]);const t=this.calculateArea(this.pointArray),s=`${Ds(Bs(t,z["Unit from file"],this.settings.unit,2).value,this.settings.decimalPrecision)} ${this.getUnitString()}`,i=this.getBarycenter(this.pointArray),n=this.createLabel(s);n.position.set(i.x,i.y,i.z),n.element.innerHTML=s,this.scene.add(n),this.labels.push(n)}else e=!0,t=!0;if(this.mode===Fs.Distance&&s<2&&(e=!0),this.mode===Fs.Angle&&this.polyline)if(s>=3){const e=this.pointArray[0],t=this.pointArray[1],s=this.pointArray[2],i=new y["wc"](e.x-t.x,e.y-t.y,e.z-t.z).normalize(),n=this.getAngleBisector(e,t,s),o=new y["wc"](s.x-t.x,s.y-t.y,s.z-t.z).normalize(),r=this.calculateAngle(e,t,s),a=`${Ds(r,this.settings.decimalPrecision)} ${this.getUnitString()}`,c=Math.min(e.distanceTo(t),s.distanceTo(t));let l=.3*c,d=t.clone().add(new y["wc"](n.x*l,n.y*l,n.z*l));const h=this.createLabel(a);h.position.set(d.x,d.y,d.z),h.element.innerHTML=a,this.scene.add(h),this.labels.push(h),l=.2*c,d=t.clone().add(new y["wc"](n.x*l,n.y*l,n.z*l));const u=t.clone().add(new y["wc"](i.x*l,i.y*l,i.z*l)),p=t.clone().add(new y["wc"](o.x*l,o.y*l,o.z*l));this.curve=this.createCurve(u,d,p),this.scene.add(this.curve)}else e=!0,t=!0;e&&(this.pointMarkers.forEach(e=>this.scene.remove(e)),this.pointMarkers=[]),t&&this.polyline&&(this.scene.remove(this.polyline),this.polyline=void 0),this.isCompleted=!0,this.renderer.domElement.style.cursor="",this.tempPointMarker&&this.scene.remove(this.tempPointMarker),this.tempLine&&this.scene.remove(this.tempLine),this.tempLabel&&this.scene.remove(this.tempLabel)}cancel(){this.close()}addOrUpdateTempLabel(e,t){this.tempLabel||(this.tempLabel=this.createLabel(e),this.scene.add(this.tempLabel)),this.tempLabel.position.set(t.x,t.y,t.z),this.tempLabel.element.innerHTML=e}createLabel(e){const t=document.createElement("div");t.innerHTML=e,t.style.padding="3px 6px",t.style.color="#fff",t.style.fontSize="12px",t.style.position="absolute",t.style.backgroundColor="rgba(25, 25, 25, 0.3)",t.style.borderRadius="12px",t.style.top="0px",t.style.left="0px";const s=new os["a"](t);return s.name=Gs.LABEL_NAME,s}createCurve(e,t,s){const i=new y["Ob"](e,t,s),n=i.getPoints(4),o=(new y["k"]).setFromPoints(n),r=new y["X"](o,Gs.LINE_MATERIAL);return r.name=Gs.OBJ_NAME,r}calculateArea(e){let t=0;for(let s=0,i=1,n=2;n<e.length;i++,n++){const o=e[s].distanceTo(e[i]),r=e[i].distanceTo(e[n]),a=e[n].distanceTo(e[s]),c=(o+r+a)/2;t+=Math.sqrt(c*(c-o)*(c-r)*(c-a))}return t}calculateAngle(e,t,s){const i=e,n=t,o=s,r=new y["wc"](i.x-n.x,i.y-n.y,i.z-n.z),a=new y["wc"](o.x-n.x,o.y-n.y,o.z-n.z),c=r.angleTo(a);return 180*c/Math.PI}getAngleBisector(e,t,s){const i=e,n=t,o=s,r=new y["wc"](i.x-n.x,i.y-n.y,i.z-n.z).normalize(),a=new y["wc"](o.x-n.x,o.y-n.y,o.z-n.z).normalize();return new y["wc"](r.x+a.x,r.y+a.y,r.z+a.z).normalize()}getBarycenter(e){const t=e.length;let s=0,i=0,n=0;return e.forEach(e=>{s+=e.x,i+=e.y,n+=e.z}),new y["wc"](s/t,i/t,n/t)}getUnitString(){return this.mode===Fs.Distance?Ls(this.settings.unit):this.mode===Fs.Area?""+Ls(this.settings.unit,2):this.mode===Fs.Angle?"":""}numberToString(e){if(e<1e-4)return e.toString();let t=2;return e<.01?t=4:e<.1&&(t=3),e.toFixed(t)}}Gs.LINE_MATERIAL=new y["Y"]({color:16773120,linewidth:2,opacity:.8,transparent:!0,side:y["x"],depthWrite:!1,depthTest:!1}),Gs.MESH_MATERIAL=new y["ob"]({color:8900346,transparent:!0,opacity:.8,side:y["x"],depthWrite:!1,depthTest:!1}),Gs.MAX_DISTANCE=500,Gs.OBJ_NAME="object_for_measure",Gs.LABEL_NAME="label_for_measure";class Us{static createGroundGrid(e,t,s){e=e||this.DEFAULT_WIDTH,t=t||this.DEFAULT_WIDTH_SEGS;const i=new y["L"](e,t);s?i.position.set(s.x,s.y,s.z):i.position.y=0;const n=i.material;return Array.isArray(n)||(n.opacity=this.DEFAULT_MAT_PARAMS.opacity,n.transparent=this.DEFAULT_MAT_PARAMS.transparent),i.name=this.GROUND_GRID_NAME,i.userData.selectable=!1,i.matrixAutoUpdate=!1,i.updateMatrix(),i}static async createGrassGround(e,t,s,i,n){return t=t||this.DEFAULT_WIDTH,s=s||this.DEFAULT_HEIGHT,new Promise(o=>{const r=new y["nc"];r.load(e||"images/terrain/grass.jpg",e=>{e.wrapS=e.wrapT=y["Vb"],e.repeat.set(i||this.DEFAULT_WIDTH_SEGS/5,n||this.DEFAULT_HEIGHT_SETS/5),e.anisotropy=16,e.encoding=y["Cc"];const r=new y["qb"]({map:e});r.side=y["J"];const a=new y["nb"](new y["Jb"](t,s),r);return a.rotation.x=-Math.PI/2,a.position.y=0,a.receiveShadow=!0,a.name=this.GRASS_GROUND_NAME,a.userData.selectable=!1,a.matrixAutoUpdate=!1,a.updateMatrix(),o(a)})})}}Us.GROUND_GRID_NAME="GROUND_GRID",Us.GRASS_GROUND_NAME="GRASS_GROUND",Us.DEFAULT_WIDTH=1e3,Us.DEFAULT_HEIGHT=1e3,Us.DEFAULT_WIDTH_SEGS=100,Us.DEFAULT_HEIGHT_SETS=100,Us.DEFAULT_MAT_PARAMS={color:12829635,transparent:!0,opacity:.5,wireframeLinewidth:.5};class zs{static createSkyOfGradientRamp(e=4e3,t=32,s=15,i=new y["wc"]){const n={topColor:{value:new y["n"](8828661)},skylineColor:{value:new y["n"](16777215)},bottomColor:{value:new y["n"](10066329)},offset:{value:400},exponent:{value:.9},skyCenter:{value:i||new y["wc"]}},o=new y["fc"](e,t,s),r=new y["Yb"]({uniforms:n,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,side:y["f"]}),a=new y["nb"](o,r);return a.matrixAutoUpdate=!1,a.name=this.NAME,a.userData.selectable=!1,a}static createSkyOfGradientRampByObjectsInScene(e,t){if(!e)return new y["nb"];const s=oe.getObjectsBoundingBox(e,t);return zs.createSkyOfGradientRampByBoundingBox(s)}static createSkyOfGradientRampByBoundingBox(e){const t=e.max.x-e.min.x+(e.max.y-e.min.y)+(e.max.z-e.min.z);let s=2*t;s<zs.MIN_SKY_RADIUS?s=zs.MIN_SKY_RADIUS:s>zs.MAX_SKY_RADIUS&&(s=zs.MAX_SKY_RADIUS);const i=new y["wc"];e.getCenter(i);const n=zs.createSkyOfGradientRamp(s,void 0,void 0,i);return n.position.set(i.x,0,i.z),n}static async createSkyFromTextures(e="cloudy"){const t=new y["o"];t.setPath(`images/skybox/${e}/`);const s=["right.jpg","left.jpg","top.jpg","bottom.jpg","front.jpg","back.jpg"];return new Promise((e,i)=>{t.load(s,t=>e(t))})}}zs.NAME="SKYBOX",zs.MIN_SKY_RADIUS=4e3,zs.MAX_SKY_RADIUS=2e4,zs.vertexShader="\n    varying vec3 vWorldPosition;\n    void main() {\n      vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",zs.fragmentShader="\n    uniform vec3 topColor;\n    uniform vec3 skylineColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    uniform vec3 skyCenter;\n    varying vec3 vWorldPosition;\n    void main() {\n      vec3 position = vec3(vWorldPosition.x - skyCenter.x, vWorldPosition.y - skyCenter.y, vWorldPosition.z - skyCenter.z);\n      float h = normalize( position + offset ).y;\n      vec3 color;\n      if (h > 0.0) {\n        color = mix( skylineColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) );\n      } else {\n        color = mix( skylineColor, bottomColor, max( pow( max( -h, 0.0 ), exponent ), 0.0 ) );\n      }\n      gl_FragColor = vec4(color , 1.0 );\n    }";const Ws=s("9363");class Hs{constructor(e){this.exploderDict={},this.postmate=o.instance(),this.controls={showGroundGrid:!1,showGrassGround:!1,skyMode:["None","Gradient ramp","Cloudy"],homeView:()=>console.log("[DGH] Go to home view"),views:["Top","Bottom","Front","Back","Left","Right"],OrthographicCamera:!1,takeSnapshot:()=>console.log("[DGH] Taking snapshot..."),fullScreen:()=>console.log("[DGH] Full screen..."),webcam:!1,uploadFile:()=>console.log("[DGH] Upload file..."),showBimTree:!1,transparentMode:!1,sectionMode:["No section","Box section","Plane section"],measure:["No measure","Distance","Area","Angle"],alVisible:!0,alColor:"#cccccc",alIntensity:1,alCastShadow:!0,dlVisible:!0,dlColor:"#dddddd",dlIntensity:2,dlCastShadow:!0,hlVisible:!0,hlIntensity:1,hlColor:[255,255,255,.6],hlGroundColor:[200,255,200,.6],fogEnabled:!1,fogColor:14540253,fogNearDistance:1,fogFarDistance:1e3,composerEnabled:!1,renderPassEnabled:!1,fxaaEnabled:!1,saoEnabled:!1,ssaoEnabled:!1,outlineEnabled:!1,ssaaEnabled:!1,bloomEnabled:!1,unrealBloomEnabled:!1},this.viewer=e,this.init(),this.initPostmate()}init(){if(!this.viewer||!this.viewer.renderer||!this.viewer.scene)throw new Error("Need to initialize renderer, scene first!");const e=this.viewer,t=this.viewer.scene,s=this.controls;this.gui=new ks["a"]({name:"controls",autoPlace:!0,width:300,closed:!0}),this.gui.domElement.style.opacity="0.6";const i=this.gui.addFolder("Common settings");i.add(s,"showGroundGrid").name("Show ground grid").onChange(s=>{e.groundGrid?e.groundGrid.visible=s:s&&(e.groundGrid=Us.createGroundGrid(),t.add(e.groundGrid),e.enableRender()),e.enableRender()}),i.add(s,"showGrassGround").name("Show grass ground").onChange(s=>{e.grassGround?e.grassGround.visible=s:s&&(async()=>{e.grassGround=await Us.createGrassGround(),t.add(e.grassGround),e.enableRender()})(),e.enableRender()});const n=i.add(s,"skyMode",s.skyMode).name("Sky mode");n.onChange(s=>{e.skyOfGradientRamp&&(e.skyOfGradientRamp.visible="Gradient ramp"===s),"Gradient ramp"===s?(e.skyOfGradientRamp||(e.skyOfGradientRamp=zs.createSkyOfGradientRamp(),t.add(e.skyOfGradientRamp)),e.skyOfGradientRamp.visible=!0):"Cloudy"===s?zs.createSkyFromTextures("cloudy").then(e=>{t.background=e}):t.background=e.sceneBackgroundColor,e.enableRender()}),n.setValue("Gradient ramp"),i.add(s,"homeView").name("Go to home view").onChange(()=>{e.goToHomeView()}),i.add(s,"views",s.views).name("Views").onChange(s=>{const i=new y["wc"],n=new y["wc"];ut.getCameraPositionByView(t,s,i,n),e.flyTo(i,n)}),i.add(s,"OrthographicCamera").name("Orth Camera").onChange(t=>{e.setToOrthographicCamera(t)}),i.add(s,"takeSnapshot").name("Take snapshot").onChange(()=>{X.commit(V.MUTATION_SHOW_SNAPSHOT_PANEL,!0)}),i.add(s,"fullScreen").name("Full screen").onChange(()=>{Ws&&Ws.isEnabled&&Ws.request(),e.enableRender()}),i.add(s,"uploadFile").name("Upload file").onChange(()=>{document.getElementById("uploadModelFile").click()});const o=this.gui.addFolder("Model operations"),r=o.add(s,"showBimTree",s.showBimTree).name("Show BimTree");r.onChange(e=>{X.commit(V.MUTATION_SHOW_BIM_TREE,e)}),X.watch((e,t)=>t.getShowBimTree,e=>{r.setValue(e)}),o.add(s,"transparentMode",s.transparentMode).name("Transparent mode").onChange(t=>{e.addOrRemoveObjectOpacity(t),e.enableRender()}),o.add(s,"sectionMode",s.sectionMode).name("Section mode").onChange(t=>{"No section"===t?e.disableSection():"Box section"===t?e.enableSection("ObjectsBoxSection"):"Plane section"===t&&e.enableSection("PlaneSection"),e.enableRender()}),o.add(s,"measure",s.measure).name("Measure").onChange(t=>{e.renderer&&("No measure"===t?e.disableMeasure():"Distance"===t?e.enableMeasure(Fs.Distance):"Area"===t?e.enableMeasure(Fs.Area):"Angle"===t&&e.enableMeasure(Fs.Angle),e.enableRender())});const a=this.viewer.ambientLight,c=this.gui.addFolder("Ambient light");c.add(s,"alVisible",s.alVisible).name("visible").onChange(t=>{a&&(a.visible=t),e.enableRender()}),c.addColor(s,"alColor").name("color").onChange(t=>{a&&(a.color=new y["n"](t)),e.enableRender()}),c.add(s,"alIntensity",0,5).name("intensity").onChange(t=>{a&&(a.intensity=t),e.enableRender()}),c.add(s,"alCastShadow").name("castShadow").onChange(t=>{a&&(a.castShadow=t),e.enableRender()});const l=this.viewer.directionalLight,d=this.gui.addFolder("Directional light");d.add(s,"dlVisible",s.dlVisible).name("visible").onChange(t=>{l&&(l.visible=t),e.enableRender()}),d.addColor(s,"dlColor").name("color").onChange(t=>{l&&(l.color=new y["n"](t)),e.enableRender()}),d.add(s,"dlIntensity",0,5).name("intensity").onChange(t=>{l&&(l.intensity=t),e.enableRender()}),d.add(s,"dlCastShadow").name("castShadow").onChange(t=>{l&&(l.castShadow=t),e.enableRender()});const h=this.viewer.hemisphereLight,u=this.gui.addFolder("Hemisphere Light");u.add(s,"hlVisible",s.hlVisible).name("visible").onChange(t=>{h&&(h.visible=t),e.enableRender()}),u.add(s,"hlIntensity",0,5).name("intensity").onChange(t=>{h&&(h.intensity=t),e.enableRender()}),u.addColor(s,"hlColor").name("color").onChange(t=>{h&&(h.color=new y["n"](t)),e.enableRender()}),u.addColor(s,"hlGroundColor").name("groundColor").onChange(t=>{h&&(h.groundColor=new y["n"](t)),e.enableRender()});const p=this.gui.addFolder("Fog");p.add(s,"fogEnabled",s.fogEnabled).name("Enabled").onChange(i=>{t.fog=i?new y["I"](s.fogColor,s.fogNearDistance,s.fogFarDistance):null,e.enableRender()}),p.add(s,"fogNearDistance",0,100).name("Near").onChange(i=>{s.fogEnabled&&t&&(t.fog=new y["I"](s.fogColor,i,s.fogFarDistance)),e.enableRender()}),p.add(s,"fogFarDistance",100,2e3).name("Far").onChange(i=>{s.fogEnabled&&t&&(t.fog=new y["I"](s.fogColor,s.fogNearDistance,i)),e.enableRender()});const m=this.gui.addFolder("Composer");m.add(s,"composerEnabled",s.composerEnabled).name("Composer Enabled").onChange(t=>{e.enableComposer(t)}),m.add(s,"renderPassEnabled",s.renderPassEnabled).name("RenderPass Enabled").onChange(t=>{e.enableRenderPass(t)}),m.add(s,"fxaaEnabled",s.fxaaEnabled).name("Effect FXAA Enabled").onChange(t=>{e.enableFxaaPass(t)}),m.add(s,"saoEnabled",s.saoEnabled).name("SAO Enabled").onChange(t=>{e.enableSaoPass(t)}),m.add(s,"ssaoEnabled",s.ssaoEnabled).name("SSAO Enabled").onChange(t=>{e.enableSsaoPass(t)}),m.add(s,"outlineEnabled",s.outlineEnabled).name("OutlinePass Enabled").onChange(t=>{e.enableOutlinePass(t)}),m.add(s,"ssaaEnabled",s.ssaaEnabled).name("SSAA Enabled").onChange(t=>{e.enableSsaaPass(t)}),m.add(s,"bloomEnabled",s.bloomEnabled).name("Bloom Enabled").onChange(t=>{e.enableBloomPass(t)}),m.add(s,"unrealBloomEnabled",s.unrealBloomEnabled).name("Unreal Bloom Enabled").onChange(t=>{e.enableUnrealBloomPass(t)})}setExplodeMode(e,t=!1){this.viewer&&this.viewer.scene&&this.viewer.loadedModels&&this.exploderDict&&(e?oe.explodeObjects(this.viewer.scene,this.exploderDict,Object.values(this.viewer.loadedModels).map(e=>e.uuid),t):oe.unexplodeObjects(this.viewer.scene,this.exploderDict||{}))}initPostmate(){const e=this.viewer;e&&(this.postmate.addEventListenerWithReturnValue(i.getGroundGrid,()=>e.groundGrid&&e.groundGrid.visible),this.postmate.addEventListener(i.setGroundGrid,t=>{const s=t.value;e.groundGrid&&(e.groundGrid.visible=s),e.enableRender()}),this.postmate.addEventListener(i.goHomeView,()=>{e.goToHomeView()}),this.postmate.addEventListener(i.setTransparentMode,t=>{const s=t.value;e.addOrRemoveObjectOpacity(s)}),this.postmate.addEventListener(i.setExplodeMode,t=>{const s=t.value;this.setExplodeMode(s),e.enableRender()}))}open(){this.gui&&this.gui.open()}close(){this.gui&&this.gui.close()}beforeDestroy(){this.viewer=void 0,this.gui&&this.gui.destroy(),this.gui=void 0,this.exploderDict=[],this.postmate.removeEventListenerWithReturnValue(i.getGroundGrid),this.postmate.removeEventListener(i.setGroundGrid,i.goHomeView,i.setTransparentMode,i.setExplodeMode)}}class $s{static isTouchScreenDevice(){return!!("ontouchstart"in window)}static printDeviceInfo(){const e=navigator.userAgent,t=/(?:Android)/.test(e),s=/(?:Firefox)/.test(e),i=/(?:Chrome|CriOS)/.test(e),n=/(?:iPad|PlayBook)/.test(e)||t&&!/(?:Mobile)/.test(e)||s&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!n,r=!o&&!t,a=$s.isTouchScreenDevice();t&&console.log("[DI] is android"),s&&console.log("[DI] is fireFox"),i&&console.log("[DI] is chrome"),n&&console.log("[DI] is tablet"),o&&console.log("[DI] is iPhone"),r&&console.log("[DI] is PC"),a&&console.log("[DI] is touch device")}static getWebGlRendererInfo(e){if(!e)throw new Error("Invalid canvas!");const t=e.getContext("webgl")||e.getContext("experimental-webgl")||e.getContext("webgl2"),s=t&&t.getExtension("WEBGL_debug_renderer_info");let i="unknown";return s&&(i=t.getParameter(s.UNMASKED_RENDERER_WEBGL)),i}}class Vs{constructor(){this.TIMEOUT="timeout",this.INTERVAL="interval",this.timeoutMap={},this.intervalMap={}}run(e=this.INTERVAL,t,s=16.7){const i=Date.now;let n=i(),o=n;const r=Symbol(""),a=()=>{this.setIdMap(r,e,a),o=i(),o-n>=s&&(e===this.intervalMap&&(n=i(),o=n),t(),e===this.TIMEOUT&&this.clearTimeout(r))};return this.setIdMap(r,e,a),r}setIdMap(e,t,s){const i=requestAnimationFrame(s);t===this.INTERVAL?this.intervalMap[e]=i:t===this.TIMEOUT&&(this.timeoutMap[e]=i)}setTimeout(e,t){return this.run(this.TIMEOUT,e,t)}clearTimeout(e){cancelAnimationFrame(this.timeoutMap[e])}setInterval(e,t){return this.run(this.INTERVAL,e,t)}clearInterval(e){cancelAnimationFrame(this.intervalMap[e])}}var Ks=s("21af");class qs{static async createEnvTextureFromDataArray(e,t=this.HDR_CITY_STREET_64x32,s=64,i=32){if(e){const n=new y["r"](t,s,i);n.flipY=!0,n.magFilter=y["bb"],n.minFilter=y["bb"],n.type=y["N"],n.version=1;const o=e.fromEquirectangular(n).texture;return e.dispose(),Promise.resolve(o)}return Promise.reject(new Error("Invalid pmremGenerator!"))}}qs.HDR_CITY_STREET_64x32=Uint16Array.from([11910,12340,1279715360,11926,12348,12806,15360,11958,12364,12814,15360,11974,12380,1283015360,11958,12364,12822,15360,11926,12348,12797,15360,11878,12324,1277315360,11830,12308,12749,15360,11798,12292,12733,15360,11782,12279,1272515360,11765,12263,12709,15360,11749,12247,12701,15360,11733,12231,1270115360,11701,12215,12693,15360,11685,12199,12685,15360,11685,12199,1268515360,11701,12215,12693,15360,11717,12231,12701,15360,11733,12247,1270915360,11749,12263,12717,15360,11749,12279,12717,15360,11765,12279,1272515360,11765,12279,12725,15360,11765,12292,12725,15360,11798,12300,1273315360,11830,12316,12749,15360,11846,12324,12757,15360,11894,12340,1278115360,11926,12356,12797,15360,11942,12356,12797,15360,11926,12348,1278915360,11926,12348,12789,15360,11942,12356,12797,15360,11942,12356,1279715360,11942,12348,12806,15360,11942,12356,12806,15360,11942,12356,1281415360,11958,12372,12830,15360,11974,12372,12830,15360,11974,12372,1283815360,11990,12388,12854,15360,12055,12420,12886,15360,12119,12452,1291815360,12167,12476,12950,15360,12231,12500,12982,15360,12263,12516,1299815360,12231,12500,12974,15360,12199,12484,12958,15360,12199,12484,1295815360,12199,12492,12966,15360,12247,12508,12982,15360,12247,12508,1299015360,12231,12500,12982,15360,12199,12484,12966,15360,12167,12468,1294215360,12119,12444,12918,15360,12087,12436,12902,15360,12055,12420,1288615360,12055,12412,12878,15360,12039,12412,12878,15360,12022,12396,1286215360,12006,12388,12846,15360,11958,12364,12830,15360,11910,12340,1280615360,12119,12508,13103,15360,12087,12484,13071,15360,12055,12468,1304615360,12006,12436,13006,15360,11926,12396,12958,15360,11878,12364,1292615360,11846,12348,12894,15360,11782,12308,12854,15360,11749,12292,1283015360,11717,12263,12814,15360,11685,12247,12806,15360,11669,12215,1278915360,11685,12231,12789,15360,11701,12247,12797,15360,11701,12247,1280615360,11717,12263,12814,15360,11749,12292,12822,15360,11782,12308,1283815360,11798,12316,12846,15360,11814,12332,12862,15360,11846,12340,1287015360,11862,12348,12878,15360,11846,12340,12870,15360,11846,12340,1286215360,11878,12356,12886,15360,11910,12372,12910,15360,11942,12396,1293415360,11958,12412,12958,15360,12039,12452,12998,15360,12071,12468,1302215360,12039,12452,12998,15360,12039,12452,12998,15360,12006,12444,1300615360,11974,12436,12998,15360,11942,12412,12982,15360,11926,12396,1297415360,11926,12404,12974,15360,11958,12420,12998,15360,12006,12452,1303815360,12055,12476,13071,15360,12039,12476,13079,15360,12087,12508,1312715360,12247,12597,13231,15360,12388,12693,13332,15360,12420,12741,1336415360,12436,12757,13372,15360,12468,12773,13380,15360,12500,12806,1338815360,12516,12822,13404,15360,12629,12934,13452,15360,12741,13046,1350815360,12806,13095,13532,15360,12757,13046,13516,15360,12645,12950,1346015360,12565,12870,13428,15360,12532,12838,13412,15360,12549,12854,1341215360,12516,12838,13396,15360,12452,12757,13356,15360,12420,12725,1334015360,12404,12709,13332,15360,12372,12677,13316,15360,12279,12589,1320715360,12135,12516,13119,15360,12388,12709,13348,15360,12247,12581,1322315360,12055,12476,13087,15360,11910,12388,12982,15360,11733,12308,1288615360,11669,12247,12846,15360,11621,12199,12814,15360,11541,12103,1276515360,11492,12055,12733,15360,11508,12055,12733,15360,11476,12022,1271715360,11525,12055,12725,15360,11589,12135,12757,15360,11669,12199,1276515360,11765,12292,12814,15360,11862,12348,12886,15360,11910,12372,1291015360,12006,12420,12966,15360,12071,12452,12998,15360,12119,12476,1302215360,12167,12492,13046,15360,12183,12500,13063,15360,12199,12524,1307915360,12308,12589,13151,15360,12300,12581,13151,15360,12167,12516,1308715360,12087,12468,13030,15360,12022,12444,13014,15360,11990,12420,1299015360,11974,12420,12990,15360,11974,12420,12990,15360,11990,12436,1301415360,11990,12444,13030,15360,12103,12500,13103,15360,12087,12508,1311115360,12039,12484,13103,15360,12039,12476,13103,15360,11942,12436,1305415360,11974,12452,13087,15360,12039,12492,13135,15360,12103,12532,1319915360,12183,12581,13263,15360,12308,12661,13340,15360,12484,12822,1343615360,12613,12918,13484,15360,12725,13046,13540,15360,13046,13332,1367715360,13143,13380,13717,15360,13223,13420,13741,15360,13396,13540,1386215360,13436,13589,13902,15360,13484,13629,13942,15360,13468,13621,1393415360,13412,13564,13878,15360,13372,13524,13846,15360,13287,13452,1378115360,13223,13428,13749,15360,13340,13492,13805,15360,13239,13428,1374915360,13095,13364,13685,15360,12918,13223,13597,15360,12822,13111,1355615360,12613,12934,13468,15360,12532,12854,13428,15360,12565,12870,1344415360,12468,12789,13396,15360,12372,12693,13340,15360,12087,12492,1311115360,11846,12364,12958,15360,11717,12300,12878,15360,11557,12135,1278115360,11476,12055,12741,15360,11460,12022,12725,15360,11476,12022,1272515360,11476,12022,12709,15360,11476,11958,12605,15360,11364,11733,1233215360,11111,11412,11661,15360,11223,11476,11773,15360,11388,11669,1209515360,11765,12119,12492,15360,12388,12613,13079,15360,12661,12902,1335615360,12998,13255,13564,15360,13372,13508,13797,15360,13412,13548,1384615360,13287,13436,13725,15360,13271,13428,13709,15360,13287,13428,1371715360,13014,13287,13597,15360,12709,12998,13460,15360,12452,12741,1333215360,12364,12653,13271,15360,12404,12693,13316,15360,12420,12709,1331615360,12420,12709,13332,15360,12263,12589,13231,15360,12332,12661,1331215360,12300,12629,13295,15360,12263,12605,13287,15360,12231,12597,1327915360,12247,12613,13303,15360,12231,12597,13295,15360,12231,12605,1331215360,12199,12597,13324,15360,12231,12613,13340,15360,12516,12870,1346815360,12725,13063,13564,15360,12741,13079,13573,15360,12854,13175,1361315360,12902,13223,13629,15360,13046,13348,13693,15360,13356,13516,1384615360,13605,13765,14078,15360,13717,13870,14191,15360,13765,13918,1425515360,13765,13910,14247,15360,13701,13854,14191,15360,13573,13733,1407015360,13508,13677,14006,15360,13380,13548,13886,15360,13111,13380,1374115360,13063,13348,13709,15360,12886,13207,13629,15360,12725,13046,1354815360,12645,12966,13508,15360,12677,12982,13508,15360,12629,12950,1349215360,12452,12789,13412,15360,12324,12661,13332,15360,12356,12677,1334015360,12388,12693,13348,15360,12279,12597,13247,15360,11894,12396,1299815360,11637,12231,12846,15360,11573,12135,12789,15360,11589,12151,1279715360,11621,12167,12797,15360,11637,12119,12677,15360,11079,11404,1169315360,10517,10701,10653,15360,10252,10348,10007,15360,9902,9999,9428,153609846,9886,9047,15360,10135,10260,9685,15360,10412,10533,10412,15360,1126811436,11549,15360,12364,12605,13087,15360,12444,12709,13255,15360,1254912822,13348,15360,12613,12886,13396,15360,12597,12886,13412,15360,1258112870,13404,15360,12661,12950,13460,15360,12725,13014,13492,15360,1307913332,13645,15360,12757,13046,13500,15360,12677,12982,13476,15360,1285413143,13556,15360,12693,12982,13492,15360,12581,12886,13452,15360,1270913030,13508,15360,12372,12709,13364,15360,12324,12661,13348,15360,1229212645,13340,15360,12292,12645,13348,15360,12468,12806,13436,15360,1253212854,13460,15360,12500,12854,13468,15360,12500,12854,13484,15360,1272513063,13589,15360,12982,13324,13701,15360,13111,13388,13741,15360,1301413340,13709,15360,13014,13332,13717,15360,13287,13476,13862,15360,1343613621,13974,15360,13532,13717,14095,15360,13725,13902,14295,15360,1394214103,14420,15360,13974,14135,14436,15360,13862,14022,14388,15360,1372513894,14295,15360,13789,13958,14336,15360,13830,13990,14348,15360,1337213548,13942,15360,13014,13332,13733,15360,12886,13239,13661,15360,1285413207,13637,15360,12757,13095,13589,15360,12757,13079,13573,15360,1264512982,13516,15360,12629,12966,13532,15360,12549,12870,13468,15360,1235612693,13372,15360,12151,12549,13231,15360,12215,12573,13247,15360,1219912565,13231,15360,12071,12492,13135,15360,12055,12468,13087,15360,1187812372,12958,15360,11685,12199,12781,15360,10774,11159,11412,15360,9533,96218870,15360,9308,9340,8071,15360,9276,9300,7878,15360,9324,9332,8420,153609191,9216,7991,15360,8950,8983,7766,15360,9493,9525,8677,15360,10252,1033210007,15360,10661,10846,10894,15360,10701,10926,10998,15360,10950,1127611428,15360,11364,11637,12063,15360,11958,12388,12926,15360,12183,1254013175,15360,12340,12645,13295,15360,12420,12693,13316,15360,12757,1303013460,15360,13046,13324,13645,15360,13095,13348,13677,15360,13303,1346013781,15360,13207,13404,13741,15360,13127,13372,13717,15360,13372,1352413862,15360,12693,13030,13540,15360,12725,13046,13548,15360,12468,1282213436,15360,12263,12629,13348,15360,12436,12773,13428,15360,12693,1299813524,15360,12725,13046,13564,15360,12645,12982,13556,15360,12613,1296613556,15360,12886,13255,13685,15360,13436,13629,14022,15360,13637,1381314231,15360,13621,13789,14215,15360,13878,14038,14412,15360,14022,1418314468,15360,13926,14119,14452,15360,14054,14231,14508,15360,14135,1431114540,15360,14348,14436,14669,15360,14460,14540,14749,15360,14404,1448414709,15360,14420,14500,14709,15360,14653,14717,14894,15360,14119,1427914508,15360,13484,13669,14078,15360,13063,13380,13773,15360,12677,1307913613,15360,12484,12886,13516,15360,12436,12822,13476,15360,12468,1283813476,15360,12039,12532,13316,15360,12231,12613,13340,15360,12468,1278913436,15360,12388,12725,13396,15360,12135,12557,13287,15360,12151,1255713271,15360,12039,12484,13175,15360,11878,12396,13038,15360,11814,1234812950,15360,11492,11894,12460,15360,9950,10103,9621,15360,8830,8838,722015360,8565,8533,7015,15360,8541,8501,6919,15360,8332,8300,6822,15360,84128372,7220,15360,8710,8701,7686,15360,9372,9404,8549,15360,9533,9621,907915360,9268,9292,8196,15360,9452,9460,8167,15360,9533,9581,8533,15360,97429870,9316,15360,11460,11814,12348,15360,11942,12388,12902,15360,11749,1216712573,15360,11300,11492,11621,15360,11974,12332,12669,15360,12436,1274113364,15360,12597,12886,13460,15360,12966,13271,13653,15360,12998,1330313669,15360,13476,13629,13974,15360,13733,13886,14239,15360,13364,1352413894,15360,13063,13356,13725,15360,12982,13287,13669,15360,12484,1280613444,15360,12565,12902,13500,15360,12950,13287,13693,15360,12934,1327113677,15360,12693,13046,13589,15360,12661,13030,13605,15360,12870,1327113717,15360,13348,13548,13966,15360,13621,13813,14271,15360,13797,1397414412,15360,13942,14119,14484,15360,14263,14388,14629,15360,14420,1450814733,15360,14460,14548,14773,15360,14982,15046,15231,15360,15564,1558015669,15360,15974,15982,16078,15360,15805,15821,15926,15360,15460,1547615572,15360,15436,15460,15556,15360,14781,14862,15127,15360,13621,1381314348,15360,12789,13207,13757,15360,12452,12886,13581,15360,12263,1270913476,15360,12039,12597,13396,15360,11942,12516,13340,15360,11846,1246813271,15360,11733,12380,13127,15360,11926,12460,13191,15360,12055,1252413263,15360,11878,12428,13159,15360,11605,12231,12886,15360,11412,1199012709,15360,11508,12103,12789,15360,11637,12231,12854,15360,10661,1107911380,15360,9541,9685,9252,15360,8573,8605,7493,15360,8404,8388,7348,153608830,8822,8212,15360,9308,9324,9095,15360,9324,9364,9220,15360,9047,91198653,15360,9023,9055,8404,15360,9055,9063,8167,15360,8870,8846,7541,153608862,8806,7380,15360,8950,8910,7252,15360,9268,9284,7557,15360,10316,1046810380,15360,11239,11476,11677,15360,10653,10942,11047,15360,9661,9814,932415360,10693,10958,11047,15360,11396,11653,11990,15360,11878,12292,1259715360,12468,12789,13396,15360,12773,13095,13589,15360,13364,13516,1389415360,13894,14054,14380,15360,13717,13870,14247,15360,13420,13589,1395815360,13255,13452,13830,15360,12806,13143,13637,15360,13159,13412,1383015360,13629,13813,14215,15360,13303,13500,13910,15360,13079,13396,1380515360,13191,13452,13878,15360,13412,13621,14062,15360,14103,14279,1454015360,14773,14854,15086,15360,14717,14805,15046,15360,14295,14420,1468515360,14380,14476,14733,15360,14572,14661,14902,15360,15596,15612,1570115360,16351,16335,16384,15360,16484,16476,16492,15360,16516,16500,1651615360,16388,16375,16404,15360,16054,16054,16118,15360,15918,15926,1600615360,15556,15572,15669,15360,14653,14725,14982,15360,13637,13838,1431915360,13412,13613,14054,15360,12870,13287,13789,15360,12404,12838,1352415360,12199,12677,13428,15360,12324,12741,13452,15360,11942,12516,1332415360,11765,12380,13111,15360,11428,11942,12589,15360,10886,11388,1190215360,10372,10717,11006,15360,9846,10240,10191,15360,10252,10549,1076615360,10613,11079,11484,15360,10581,10998,11388,15360,9613,9846,9629,153608525,8557,7541,15360,8605,8613,7814,15360,9292,9324,9079,15360,9388,93969220,15360,10709,10846,11031,15360,9894,9966,9854,15360,9252,9236,877415360,8822,8790,8183,15360,8292,8260,6533,15360,8111,8007,6324,15360,82288183,6405,15360,8501,8501,6565,15360,8814,8878,7172,15360,9260,9364,824415360,8902,9095,8252,15360,9444,9581,9047,15360,9509,9637,8790,15360,94779613,8806,15360,10725,11063,11079,15360,11508,11910,12356,15360,12484,1278913380,15360,12838,13159,13629,15360,13428,13589,13974,15360,14135,1427914484,15360,13942,14087,14396,15360,13677,13846,14247,15360,13436,1361314006,15360,13597,13781,14183,15360,14183,14340,14540,15360,14022,1421514484,15360,13637,13838,14271,15360,14038,14231,14508,15360,14380,1447614701,15360,14757,14854,15078,15360,15030,15111,15343,15360,15420,1545215556,15360,15476,15500,15588,15360,15351,15388,15492,15360,15572,1559615677,15360,15653,15669,15717,15360,15821,15821,15853,15360,15845,1584515869,15360,15998,15990,16022,15360,15926,15926,15974,15360,15653,1566915733,15360,15661,15677,15749,15360,15612,15629,15717,15360,15271,1533515452,15360,14484,14572,14821,15360,14215,14372,14588,15360,13468,1367714167,15360,12773,13175,13653,15360,12725,13143,13637,15360,12452,1288613532,15360,12263,12709,13444,15360,11894,12436,13103,15360,10252,1053310661,15360,8613,8693,7445,15360,8742,8782,7047,15360,8420,8412,6565,153607926,7910,6405,15360,8806,8854,7300,15360,9127,9228,8007,15360,8685,87507300,15360,8348,8356,6758,15360,8380,8340,7300,15360,8991,8918,8388,153609838,9790,9549,15360,10055,10127,10047,15360,9501,9493,9268,15360,9332,92928902,15360,9079,9007,8509,15360,8300,8260,7252,15360,8693,8701,8196,153608228,8212,7111,15360,8469,8501,7380,15360,8420,8501,6919,15360,8549,86456983,15360,8581,8661,6951,15360,9268,9332,7718,15360,9063,9207,7445,153609284,9380,7718,15360,9412,9557,8693,15360,10276,10517,10103,15360,1183012279,12589,15360,12725,13079,13589,15360,13127,13396,13773,15360,1408714231,14460,15360,13974,14119,14412,15360,13677,13854,14247,15360,1411914279,14500,15360,13990,14167,14460,15360,14364,14452,14653,15360,1456414653,14837,15360,14404,14492,14701,15360,14870,14942,15135,15360,1538815420,15500,15360,15207,15287,15420,15360,14797,14894,15127,15360,1527115335,15452,15360,15926,15942,15990,15360,16207,16207,16231,15360,1611816110,16126,15360,15741,15733,15741,15360,16239,16207,16175,15360,1644416460,16484,15360,16046,16022,16006,15360,15942,15950,15966,15360,1577315789,15829,15360,15789,15797,15845,15360,15693,15709,15757,15360,1554015564,15653,15360,15303,15364,15468,15360,14733,14813,15014,15360,1386214054,14420,15360,12838,13255,13725,15360,12789,13207,13693,15360,1246812918,13564,15360,12404,12838,13500,15360,11428,11862,12412,15360,9143,92768388,15360,8541,8533,6726,15360,8444,8428,6629,15360,8212,8183,6597,153608388,8380,7015,15360,8726,8710,6758,15360,8332,8316,6437,15360,8453,84286565,15360,8597,8605,7814,15360,8701,8661,8151,15360,9452,9396,9015,1536010581,10557,10380,15360,10950,10974,10846,15360,10380,10356,10252,1536010749,10741,10685,15360,9870,9854,9693,15360,9023,9039,8669,15360,8790,88548509,15360,8196,8167,7332,15360,7975,8015,7079,15360,8589,8750,7445,153609095,9260,7111,15360,8983,9135,7188,15360,8902,8991,7252,15360,8862,90077015,15360,8967,9111,7300,15360,8742,8878,7493,15360,9557,9999,9549,1536011292,11613,11862,15360,12135,12468,12982,15360,12215,12460,12878,1536013356,13468,13685,15360,13821,13934,14199,15360,13548,13701,14022,1536014103,14263,14468,15360,14279,14388,14572,15360,14364,14452,14645,1536014709,14789,14950,15360,15143,15199,15327,15360,15388,15412,15468,1536015476,15500,15548,15360,15420,15444,15492,15360,15436,15460,15516,1536015612,15637,15685,15360,16086,16086,16110,15360,16396,16388,16396,1536016094,16094,16110,15360,15869,15861,15861,15360,16135,16110,16070,1536016428,16420,16404,15360,15588,15556,15524,15360,15484,15500,15508,1536015335,15364,15396,15360,15677,15685,15717,15360,15604,15621,15661,1536015420,15444,15500,15360,15303,15372,15452,15360,14717,14805,14998,1536014412,14508,14701,15360,13548,13765,14199,15360,13271,13508,13942,1536012661,13159,13709,15360,12468,12854,13436,15360,10260,10484,10509,153608613,8669,6951,15360,8151,8143,6469,15360,8653,8629,7814,15360,8469,84447541,15360,8718,8693,7814,15360,8372,8332,6597,15360,8356,8308,7111,153609047,8983,8396,15360,8822,8798,8308,15360,9372,9348,8967,15360,10364,1036410183,15360,10268,10260,9894,15360,10541,10533,10468,15360,10380,1036410276,15360,10621,10613,10549,15360,9910,9942,9758,15360,8364,8380,762115360,8581,8637,8135,15360,8252,8300,7573,15360,8119,8175,7300,15360,83728453,7493,15360,8420,8501,6983,15360,8742,8822,7573,15360,8782,8854,815115360,8581,8661,7079,15360,9220,9268,8340,15360,9549,9645,8854,15360,1171711950,12127,15360,12468,12741,13207,15360,12709,12966,13388,15360,1230012508,12886,15360,12492,12709,13063,15360,13239,13372,13548,15360,1247612597,12814,15360,13581,13685,13878,15360,14476,14548,14685,15360,1455614629,14773,15360,14765,14829,14966,15360,15159,15207,15303,15360,1537215396,15444,15360,15516,15532,15572,15360,15653,15661,15693,15360,1582915837,15853,15360,16022,16014,16022,15360,16311,16295,16279,15360,1634316319,16303,15360,16412,16388,16359,15360,15813,15797,15773,15360,1306313151,13183,15360,11484,11701,11798,15360,12300,12412,12468,15360,1461314637,14653,15360,11974,12215,12316,15360,14135,14215,14303,15360,1560415629,15677,15360,15524,15548,15596,15360,15351,15380,15428,15360,1479714894,15054,15360,13990,14231,14500,15360,13492,13709,14070,15360,1288613316,13701,15360,12613,13207,13749,15360,11525,11974,12428,15360,9284,94128629,15360,8597,8653,6951,15360,7806,7790,6292,15360,7589,7541,6437,153607485,7437,6597,15360,7453,7404,6180,15360,7774,7686,6565,15360,8300,82607332,15360,9918,9942,9862,15360,10348,10372,10231,15360,9725,9709,922815360,10613,10621,10509,15360,10199,10175,9838,15360,10380,10388,1034015360,11207,11255,11284,15360,10661,10717,10725,15360,10103,10135,995015360,8444,8436,7669,15360,8469,8501,7445,15360,8950,9111,8854,15360,94859798,10071,15360,8364,8501,8039,15360,7959,7951,6806,15360,8597,8605,803915360,8501,8533,7557,15360,8758,8830,7509,15360,10758,10830,10693,1536011508,11605,11621,15360,13524,13669,13886,15360,13830,14022,14327,1536013926,14103,14364,15360,13460,13621,13886,15360,12854,13191,13420,1536013597,13733,13926,15360,13846,13990,14223,15360,13773,13942,14199,1536013910,14087,14356,15360,13813,14022,14319,15360,14247,14396,14540,1536014693,14765,14878,15360,15223,15279,15343,15360,15508,15524,15540,1536015540,15548,15564,15360,15327,15335,15319,15360,15303,15311,15303,1536015918,15910,15886,15360,16247,16207,16151,15360,16175,16143,16086,1536014436,14452,14436,15360,12263,12380,12404,15360,11476,11701,11773,1536012380,12492,12532,15360,14797,14797,14757,15360,11372,11589,11677,1536012597,12934,13356,15360,13990,14364,14725,15360,14183,14444,14773,1536014231,14444,14717,15360,14412,14532,14709,15360,14054,14199,14380,1536012372,12500,12605,15360,12199,12565,13006,15360,12581,13175,13653,1536010055,10380,10324,15360,8557,8573,6726,15360,8167,8196,6533,15360,7517,74856119,15360,7244,7172,5798,15360,7071,6959,5718,15360,7669,7581,6260,153608661,8605,7975,15360,10942,11079,11151,15360,12573,12741,13014,15360,1190212030,12191,15360,10308,10332,10135,15360,11255,11300,11284,15360,1127611348,11396,15360,10055,10215,10292,15360,12183,12332,12468,15360,9918,99669798,15360,8734,8742,8196,15360,8967,8950,8469,15360,10260,10276,1003915360,9734,9758,9605,15360,9388,9404,9308,15360,7943,7878,7095,15360,77267637,6645,15360,8047,7983,7204,15360,9284,9236,8693,15360,9621,9565,914315360,11255,11268,11047,15360,13175,13332,13420,15360,13773,13934,1417515360,13854,14022,14271,15360,13870,14038,14279,15360,13388,13516,1367715360,12279,12629,12966,15360,13348,13452,13564,15360,13821,13918,1405415360,13701,13846,14022,15360,13460,13605,13781,15360,13492,13637,1382115360,13709,13821,13950,15360,14372,14428,14476,15360,14516,14572,1461315360,14741,14789,14813,15360,14725,14749,14749,15360,13452,13484,1346815360,13476,13500,13492,15360,14990,15022,15022,15360,14556,14572,1456415360,15094,15111,15094,15360,13231,13287,13215,15360,11255,11380,1117515360,10677,10886,10492,15360,11846,12006,11934,15360,14327,14340,1427915360,10766,11039,10862,15360,12918,13255,13452,15360,14231,14548,1488615360,13878,14380,14765,15360,13444,13862,14412,15360,12151,12404,1262115360,12637,12902,13215,15360,11549,11749,11870,15360,12279,12653,1311915360,13223,13404,13516,15360,9228,9260,8276,15360,8087,7991,6308,153607918,7814,6919,15360,7469,7364,6148,15360,7485,7380,6212,15360,8228,79917204,15360,9276,8967,8212,15360,9806,9573,8742,15360,10135,10087,9621,1536011452,11452,11452,15360,10629,10637,10509,15360,10693,10733,10637,1536011095,11111,10982,15360,11292,11348,11372,15360,10199,10244,10167,1536010814,10926,10846,15360,8669,8774,7493,15360,7870,7910,6244,15360,8204,81836919,15360,9806,9758,9159,15360,9460,9436,8629,15360,9159,9087,8260,153607637,7509,6790,15360,7758,7629,6838,15360,7967,7918,6774,15360,10854,1074910501,15360,11508,11412,11316,15360,12372,12300,12151,15360,12030,1211912063,15360,12781,12910,12982,15360,13476,13581,13661,15360,13484,1358913677,15360,12404,12428,12380,15360,11605,11765,11798,15360,11492,1153311452,15360,11838,11886,11798,15360,12263,12372,12380,15360,12151,1223112175,15360,11492,11508,11412,15360,11119,11111,10838,15360,12508,1258112573,15360,12621,12693,12677,15360,12573,12629,12589,15360,12292,1232412231,15360,12476,12565,12573,15360,11998,12159,12215,15360,12950,1307113159,15360,12263,12372,12428,15360,12380,12428,12444,15360,11300,1130811143,15360,10199,10244,9734,15360,9709,9701,9252,15360,10492,10581,1040415360,11476,11516,11388,15360,9477,9517,8790,15360,11717,11854,11838,1536014247,14420,14524,15360,14054,14311,14436,15360,13597,13805,13982,1536011364,11533,11597,15360,12263,12428,12549,15360,11436,11605,11653,1536013079,13324,13444,15360,12516,12613,12605,15360,10039,10015,9605,15360,86938621,7878,15360,7951,7862,6902,15360,8196,8204,7015,15360,8677,8589,763715360,9284,9031,8340,15360,9814,9605,8902,15360,10685,10428,9910,1536010492,10260,9685,15360,9404,9252,7943,15360,8830,8766,7220,15360,9220,90477943,15360,9693,9669,9015,15360,11412,11468,11372,15360,11135,11159,1102315360,10087,10055,9428,15360,9910,10007,9621,15360,9236,9300,8934,153609597,9557,8902,15360,10669,10549,9782,15360,9926,9870,9127,15360,9894,99189047,15360,8685,8742,7910,15360,9958,10167,10284,15360,10215,10332,1039615360,11396,11428,11452,15360,11223,11255,11300,15360,11814,11862,1195815360,10685,10846,10870,15360,10340,10380,10007,15360,11175,11207,1089415360,12103,12207,12215,15360,11143,11103,10902,15360,9910,9966,9613,1536010015,10079,9493,15360,10806,10846,10517,15360,10862,10934,10637,1536010838,10942,10661,15360,10958,11087,10878,15360,10709,10838,10701,1536010669,10741,10589,15360,10581,10669,10525,15360,10252,10348,9974,1536011396,11500,11525,15360,11207,11255,11264,15360,10878,10910,10934,1536011031,11063,11159,15360,11292,11324,11396,15360,11223,11255,11300,1536010693,10685,10645,15360,10428,10420,10324,15360,10300,10252,9991,1536010838,10846,10798,15360,10428,10428,10364,15360,9669,9605,9380,15360,1016710244,10087,15360,11709,11854,11910,15360,11223,11284,11268,15360,1023110244,9878,15360,10199,10244,9862,15360,10183,10260,9942,15360,10525,1065310541,15360,12500,12597,12621,15360,11814,11741,11597,15360,11533,1146011175,15360,11103,11006,10557,15360,10444,10396,9846,15360,10007,10023,922815360,9653,9790,8469,15360,9316,9372,8039,15360,9557,9830,8071,15360,96219918,8071,15360,9677,10015,8167,15360,9991,10284,8420,15360,10215,104368581,15360,10260,10484,8645,15360,10292,10476,8902,15360,10324,10468,925215360,9910,9894,8886,15360,10525,10573,9701,15360,9782,10039,8581,153609565,9814,8167,15360,9950,10039,8934,15360,10749,10758,10199,15360,1066910685,10244,15360,10838,10838,10460,15360,11215,10910,10087,15360,1149211364,10806,15360,11095,11159,11055,15360,11364,11388,11356,15360,1102311039,10990,15360,11653,11653,11613,15360,11798,11725,11557,15360,1197411862,11637,15360,12039,11942,11765,15360,12119,12047,11934,15360,1215112071,11950,15360,12087,12006,11886,15360,12047,11966,11838,15360,1199011926,11790,15360,11974,11910,11798,15360,11998,11934,11814,15360,1211112039,11886,15360,12231,12143,11998,15360,12292,12199,12039,15360,1203911974,11846,15360,11822,11782,11653,15360,11862,11838,11765,15360,1179811765,11701,15360,11782,11733,11669,15360,11798,11749,11685,15360,1183811790,11725,15360,11870,11822,11749,15360,11741,11701,11621,15360,1156511541,11452,15360,11533,11500,11412,15360,11621,11581,11484,15360,1160511557,11460,15360,11516,11468,11372,15360,11565,11533,11444,15360,1167711637,11541,15360,11725,11661,11557,15360,11725,11661,11557,15360,1173311669,11573,15360,11838,11773,11677,15360,11998,11926,11814,15360,1201411926,11798,15360,11460,11404,11332,15360,11637,11557,11428,15360,1201411894,11693,15360,12167,12022,11765,15360,12119,11982,11709,15360,1192611806,11516,15360,11685,11589,11300,15360,11476,11404,10886,15360,1123911151,10468,15360,10766,10733,9894,15360,10565,10565,9589,15360,10436,104449332,15360,10308,10308,9031,15360,10308,10316,8999,15360,10199,10244,877415360,9725,9645,8549,15360,10244,10276,8967,15360,10878,10838,10183,1536011055,10966,10348,15360,11119,11006,10404,15360,11264,11135,10565,1536011404,11316,10822,15360,11492,11388,10982,15360,11798,11613,11223,1536012047,11830,11412,15360,12039,11894,11597,15360,12127,11990,11693,1536012127,11990,11725,15360,12191,12055,11806,15360,12191,12055,11830,1536011870,11773,11613,15360,11573,11516,11428,15360,11533,11484,11412,1536011541,11492,11420,15360,11565,11516,11452,15360,11589,11541,11476,1536011605,11557,11500,15360,11637,11589,11533,15360,11669,11621,11557,1536011701,11645,11573,15360,11733,11669,11589,15360,11798,11717,11605,1536011838,11749,11621,15360,11878,11782,11661,15360,11894,11798,11661,1536011926,11806,11653,15360,11958,11822,11661,15360,11982,11846,11677,1536012006,11870,11685,15360,12095,11950,11765,15360,12047,11910,11741,1536011886,11765,11605,15360,11838,11733,11589,15360,11814,11717,11589,1536011814,11709,11573,15360,11790,11693,11565,15360,11741,11677,11589,1536011733,11677,11613,15360,11733,11685,11629,15360,11717,11669,11621,1536011685,11645,11589,15360,11629,11589,11533,15360,11573,11525,11468,1536011492,11444,11380,15360,11316,11255,11111,15360,11348,11292,11143,1536011516,11436,11316,15360,11854,11749,11589,15360,12127,11990,11765,1536012199,12055,11782,15360,12340,12231,11910,15360,12372,12292,11958,1536012380,12300,11974,15360,12348,12247,11910,15360,12324,12215,11878,1536012247,12103,11773,15360,12095,11958,11637,15360,12055,11926,11613,1536011974,11854,11541,15360,11870,11765,11468,15360,11966,11854,11541,1536012300,12151,11846,15360,12396,12316,12006,15360,12388,12308,11990,1536012388,12308,12006,15360,12396,12316,12022,15360,12396,12308,12022,1536012396,12308,12022,15360,12364,12279,11974,15360,12340,12247,11942,1536012340,12231,11926,15360,12215,12071,11806,15360,12095,11966,11749,1536011741,11645,11500,15360,11420,11356,11255,15360,11364,11308,11207,1536011356,11300,11175,15360,11348,11292,11191,15360,11372,11324,11255,1536011412,11364,11308,15360,11420,11372,11316,15360,11428,11380,11324,1536011444,11388,11332,15360,11484,11428,11364,15360,11508,11460,11396,1536011557,11500,11436,15360,11589,11533,11460,15360,11613,11557,11484,1536011621,11557,11492,15360,11613,11557,11500,15360,11621,11557,11500,1536011629,11573,11508,15360,11629,11573,11508,15360,11605,11557,11484,1536011589,11533,11468,15360,11557,11508,11436,15360,11549,11500,11428,1536011557,11500,11436,15360,11549,11492,11436,15360,11533,11484,11428,1536011525,11476,11428,15360,11516,11476,11428,15360,11525,11484,11444,1536011516,11476,11428,15360,11468,11428,11380,15360,11428,11388,11332,1536011356,11308,11239,15360,11308,11255,11127,15360,11167,11071,10926,1536011223,11119,10966,15360,11276,11175,10998,15360,11404,11332,11191,1536011773,11693,11557,15360,11926,11798,11613,15360,12207,12039,11773,1536012348,12231,11894,15360,12308,12151,11846,15360,12332,12215,11894,1536012364,12279,11958,15360,12380,12292,11974,15360,12396,12316,12022,1536012404,12316,12039,15360,12412,12332,12087,15360,12412,12332,12103,1536012436,12356,12135,15360,12372,12292,12039,15360,12420,12332,12087,1536012396,12316,12055,15360,12356,12263,11990,15360,12340,12231,11942,1536012271,12127,11854,15360,12215,12071,11814,15360,12292,12135,11878,1536012288,12135,11870,15360,12111,11982,11765,15360,11990,11886,11717,1536011637,11557,11428,15360,11364,11300,11143,15360,11316,11239,11079,1536011300,11207,11047,15360,11268,11159,11015,15360,11268,11159,11015,1536011268,11159,11031,15360,11300,11223,11095,15360,11340,11292,11191,1536011348,11300,11223,15360,11372,11324,11255,15360,11380,11332,11255,1536011372,11316,11239,15360,11396,11340,11268,15360,11468,11404,11300,1536011460,11404,11324,15360,11484,11428,11356,15360,11492,11436,11372,1536011500,11444,11388,15360,11508,11460,11404,15360,11500,11452,11396,1536011492,11436,11380,15360,11468,11412,11356,15360,11444,11388,11324,1536011444,11388,11324,15360,11428,11380,11316,15360,11412,11356,11300,1536011404,11348,11300,15360,11404,11356,11308,15360,11396,11356,11308,1536011388,11348,11308,15360,11372,11340,11292,15360,11348,11308,11255,1536011284,11223,11111,15360,11231,11143,11023,15360,11199,11111,10974,1536011047,10958,10814,15360,11127,11023,10870,15360,11119,11006,10846,1536011175,11055,10886,15360,11292,11191,10998,15360,11525,11404,11284,1536011822,11637,11476,15360,11878,11733,11549,15360,11918,11790,11573,1536012063,11918,11653,15360,12223,12063,11765,15360,12300,12151,11846,1536012255,12103,11814,15360,12271,12127,11846,15360,12271,12127,11862,1536012271,12127,11886,15360,12308,12183,11942,15360,12175,12039,11814,1536012063,11934,11709,15360,12159,12014,11765,15360,12215,12063,11798,1536012143,11998,11757,15360,12071,11934,11693,15360,11998,11870,11661,1536011974,11870,11685,15360,11998,11910,11757,15360,11846,11765,11629,1536011468,11396,11284,15360,11308,11223,11031,15360,11215,11103,10934,1536011207,11095,10942,15360,11215,11103,10950,15360,11191,11087,10942,1536011175,11079,10942,15360,11167,11063,10934,15360,11143,11031,10902,1536011247,11143,11015,15360,11284,11191,11079,15360,11300,11223,11095,1536011316,11268,11127,15360,11340,11284,11143,15360,11340,11284,11159,1536011356,11300,11191,15360,11372,11316,11239,15360,11380,11324,11255,1536011372,11316,11255,15360,11380,11324,11276,15360,11380,11324,11268,1536011372,11316,11255,15360,11364,11316,11255,15360,11364,11308,11239,1536011348,11292,11207,15360,11340,11284,11191,15360,11348,11292,11191,1536011348,11292,11207,15360,11340,11292,11207,15360,11340,11292,11207,1536011324,11276,11207,15360,11308,11255,11175,15360,11264,11175,11079,1536011119,11039,10934,15360,11103,11015,10902,15360,11095,11006,10878,1536011031,10942,10806,15360,10990,10902,10766,15360,11047,10942,10814,1536011031,10926,10790,15360,11055,10942,10806,15360,11119,10998,10846,1536011151,11015,10830,15360,11268,11095,10886,15360,11484,11396,11268,1536011790,11701,11549,15360,11886,11790,11637,15360,11838,11741,11581,1536011838,11725,11541,15360,11902,11782,11581,15360,11966,11838,11629,1536011974,11846,11629,15360,11958,11838,11629,15360,11950,11838,11637,1536011814,11701,11525,15360,11581,11492,11332,15360,11645,11541,11380,1536011806,11701,11533,15360,11902,11806,11637,15360,11950,11862,11717,1536012014,11934,11790,15360,11942,11862,11725,15360,11565,11492,11388,1536011292,11191,11015,15360,11231,11111,10950,15360,11159,11047,10894,1536011119,11006,10854,15360,11127,11023,10878,15360,11159,11055,10902,1536011135,11031,10894,15360,11111,11006,10878,15360,11095,10990,10870,1536011095,10998,10886,15360,11071,10966,10846,15360,11111,11006,10902,1536011191,11095,10974,15360,11268,11159,11031,15360,11284,11191,11063,1536011292,11207,11063,15360,11300,11223,11079,15360,11332,11268,11143,1536011316,11255,11127,15360,11316,11255,11143,15360,11308,11239,11127,1536011316,11255,11159,15360,11300,11223,11127,15360,11292,11207,11095,1536011300,11223,11111,15360,11300,11223,11095,15360,11300,11223,11095,1536011308,11239,11111,15360,11300,11223,11111,15360,11292,11207,11111,1536011264,11167,11071,15360,11215,11127,11047,15360,11135,11055,10966,1536011015,10934,10846,15360,10918,10838,10733,15360,10982,10894,10782,1536010974,10886,10766,15360,10982,10894,10766,15360,10958,10862,10749,1536010982,10886,10774,15360,10958,10862,10758,15360,10958,10862,10749,1536011015,10910,10790,15360,11023,10910,10774,15360,11079,10958,10806,1536011103,10974,10798,15360,11191,11047,10846,15360,11468,11388,11276,1536011846,11765,11637,15360,12006,11918,11782,15360,11998,11910,11782,1536011902,11822,11693,15360,11838,11749,11637,15360,11782,11709,11605,1536011806,11741,11645,15360,11782,11717,11629,15360,11773,11717,11621,1536011870,11806,11701,15360,11942,11862,11757,15360,12183,12103,11974,1536011974,11894,11765,15360,11476,11404,11308,15360,11268,11143,10966,1536011183,11063,10902,15360,11111,10998,10854,15360,11055,10942,10806,1536011023,10910,10766,15360,11047,10934,10782,15360,11039,10926,10782,1536011079,10966,10830,15360,11031,10918,10782,15360,11031,10926,10806,1536010990,10894,10782,15360,10974,10886,10790,15360,10966,10870,10774,1536011006,10902,10806,15360,11039,10942,10838,15360,11127,11023,10910,1536011175,11079,10958,15360,11191,11087,10958,15360,11207,11095,10958,1536011268,11143,11015,15360,11276,11175,11047,15360,11284,11191,11079,1536011292,11191,11079,15360,11276,11175,11079,15360,11239,11135,11031,1536011268,11159,11047,15360,11215,11111,11006,15360,11239,11127,11015,1536011255,11143,11031,15360,11223,11119,11015,15360,11199,11103,10998,1536011175,11087,10982,15360,11143,11047,10958,15360,11031,10942,10854,1536010958,10878,10790,15360,10910,10830,10741,15360,10942,10862,10758,1536010926,10838,10733,15360,10854,10758,10637,15360,10918,10830,10709,1536010910,10822,10717,15360,10942,10846,10749,15360,10942,10854,10741,1536010942,10854,10749,15360,10966,10870,10758,15360,10966,10870,10758,1536010958,10854,10733,15360,10998,10886,10741,15360,10942,10830,10677,1536011039,10918,10749,15360,11095,10974,10806,15360,11308,11223,11031,1536011468,11396,11292,15360,11605,11533,11428,15360,11701,11621,11525,1536011693,11629,11541,15360,11685,11621,11549,15360,11685,11629,11549,1536011629,11565,11484,15360,11589,11533,11444,15360,11364,11308,11191,1536011191,11087,10958,15360,11135,11031,10902,15360,11135,11031,10894,1536011055,10950,10830,15360,11015,10910,10782,15360,10958,10854,10733,1536010942,10838,10717,15360,10974,10870,10733,15360,10982,10878,10749,1536010990,10886,10758,15360,11015,10910,10798,15360,10966,10862,10758,1536010950,10854,10758,15360,10910,10822,10733,15360,10894,10798,10709,1536010902,10814,10725,15360,10934,10846,10758,15360,10910,10822,10733,1536010950,10854,10749,15360,10974,10878,10766,15360,11047,10942,10830,1536011095,10990,10878,15360,11167,11055,10942,15360,11199,11103,10990,1536011191,11087,10982,15360,11151,11047,10950,15360,11135,11031,10934,1536011095,10998,10902,15360,11143,11047,10950,15360,11079,10990,10894,1536011079,10990,10902,15360,11103,11006,10910,15360,11079,10982,10886,1536011023,10926,10822,15360,10982,10894,10798,15360,10958,10870,10782,1536010910,10814,10725,15360,10926,10838,10741,15360,10934,10838,10733,1536010950,10854,10749,15360,10886,10798,10709,15360,10910,10814,10709,1536010926,10830,10725,15360,10910,10814,10701,15360,10862,10774,10677,1536010950,10854,10733,15360,10926,10830,10717,15360,10926,10838,10725,1536010926,10830,10725,15360,10894,10798,10685,15360,10926,10830,10701,1536010958,10854,10717,15360,10934,10830,10685,15360,10950,10846,10709,1536010974,10862,10717,15360,10942,10830,10685,15360,10958,10846,10701,1536011006,10894,10749,15360,10950,10846,10725,15360,10958,10862,10741,1536010894,10806,10701,15360,10854,10774,10669,15360,10886,10806,10701,1536010862,10790,10693,15360,10878,10806,10717,15360,10982,10902,10798,1536010990,10902,10798,15360,10950,10862,10758,15360,10942,10846,10733,1536010870,10774,10669,15360,10894,10798,10693,15360,10918,10830,10725,1536010894,10806,10701,15360,10926,10830,10733,15360,10902,10830,10725,1536010870,10790,10693,15360,10886,10814,10725,15360,10814,10741,10661,1536010838,10766,10677,15360,10822,10741,10661,15360,10822,10741,10669,1536010862,10790,10709,15360,10846,10758,10669,15360,10894,10798,10693,1536010974,10878,10766,15360,10966,10870,10766,15360,11023,10926,10814,1536011079,10974,10862,15360,11006,10910,10814,15360,10950,10862,10766,1536010982,10894,10798,15360,10958,10862,10774,15360,10958,10870,10782,1536010910,10830,10741,15360,10950,10862,10766,15360,10982,10886,10790,1536010918,10822,10725,15360,10886,10798,10701,15360,10854,10766,10669,1536010894,10806,10709,15360,10926,10830,10725,15360,10926,10830,10725,1536010958,10862,10749,15360,10958,10862,10749,15360,10894,10806,10717,1536010902,10814,10717,15360,10878,10790,10677,15360,10942,10838,10717,1536010918,10814,10701,15360,10886,10790,10661,15360,10942,10838,10717,1536010950,10854,10725,15360,10950,10854,10725,15360,10910,10814,10693,1536010910,10814,10685,15360,10942,10838,10709,15360,10894,10790,10661,1536010910,10806,10669,15360,10822,10725,10597,15360,10749,10661,10541,1536010830,10733,10613,15360,10838,10741,10629,15360,10806,10709,10597,1536010854,10766,10653,15360,10862,10774,10669,15360,10798,10725,10629,1536010822,10749,10653,15360,10854,10782,10693,15360,10806,10741,10661,1536010862,10790,10701,15360,10870,10790,10685,15360,10870,10790,10693,1536010878,10790,10677,15360,10862,10782,10677,15360,10870,10790,10693,1536010870,10782,10685,15360,10894,10814,10709,15360,10886,10814,10709,1536010846,10782,10685,15360,10741,10669,10573,15360,10766,10693,10589,1536010709,10637,10541,15360,10741,10669,10589,15360,10741,10677,10589,1536010709,10637,10557,15360,10774,10701,10613,15360,10862,10774,10677,1536011006,10918,10806,15360,11006,10902,10782,15360,10974,10870,10749,1536010958,10854,10733,15360,10934,10838,10725,15360,10934,10838,10733,1536010934,10838,10725,15360,10886,10790,10685,15360,10854,10766,10661,1536010886,10798,10701,15360,10838,10749,10645,15360,10878,10782,10661,1536010822,10725,10613,15360,10822,10717,10605,15360,10846,10749,10629,1536010854,10749,10637,15360,10950,10854,10733,15360,10958,10854,10741,1536010910,10806,10693,15360,10926,10822,10693,15360,10934,10838,10725,1536010910,10822,10709,15360,10910,10822,10709,15360,10886,10782,10661,1536010910,10814,10677,15360,10910,10806,10677,15360,10926,10822,10685,1536010958,10854,10717,15360,10974,10870,10725,15360,10926,10830,10693,1536010926,10830,10693,15360,10918,10822,10693,15360,10934,10838,10701,1536010918,10814,10685,15360,10878,10782,10653,15360,10870,10774,10645,1536010838,10749,10629,15360,10806,10717,10605,15360,10822,10733,10621,1536010822,10733,10621,15360,10846,10758,10653,15360,10846,10766,10653,1536010822,10741,10629,15360,10806,10733,10629,15360,10806,10725,10621,1536010790,10709,10605,15360,10766,10693,10589,15360,10814,10741,10629,1536010846,10766,10653,15360,10838,10758,10653,15360,10878,10790,10677,1536010894,10798,10685,15360,10830,10741,10629,15360,10830,10758,10653,1536010798,10725,10629,15360,10806,10733,10629,15360,10717,10637,10525,1536010661,10581,10476,15360,10701,10621,10517,15360,10733,10661,10565,1536010782,10685,10557,15360,10862,10758,10613,15360,10974,10862,10725,1536010958,10846,10709,15360,11006,10902,10766,15360,11006,10902,10774,1536011039,10934,10814,15360,11006,10902,10790,15360,11006,10910,10790,1536010950,10854,10741,15360,10934,10830,10709,15360,10918,10814,10701,1536010854,10758,10653,15360,10918,10814,10701,15360,10870,10766,10645,1536010830,10733,10621,15360,10934,10830,10709,15360,10990,10886,10758,1536010950,10838,10717,15360,10910,10814,10701,15360,10926,10822,10693,1536010934,10830,10709,15360,10878,10774,10653,15360,10934,10830,10701,1536010926,10822,10693,15360,10878,10782,10661,15360,10878,10782,10661,1536010862,10766,10621,15360,10886,10782,10645,15360,10886,10782,10653,1536010926,10822,10701,15360,10902,10806,10685,15360,10926,10822,10701,1536010918,10814,10685,15360,10878,10782,10645,15360,10910,10806,10669,1536010854,10758,10621,15360,10886,10790,10645,15360,10854,10758,10629,1536010830,10741,10613,15360,10918,10814,10685,15360,10862,10766,10645,1536010830,10741,10613,15360,10806,10717,10597,15360,10741,10661,10557,1536010774,10693,10581,15360,10749,10669,10557,15360,10774,10693,10581,1536010766,10685,10573,15360,10790,10709,10597,15360,10782,10701,10589,1536010790,10709,10597,15360,10838,10749,10621,15360,10870,10774,10645,1536010894,10790,10661,15360,10878,10782,10653,15360,10846,10741,10613,1536010790,10693,10557,15360,10814,10717,10597,15360,10790,10701,10581,1536010741,10645,10525,15360,10717,10629,10509,15360,10774,10685,10573,1536010725,10637,10525,15360,10854,10749,10621,15360,10950,10846,10701,1536010966,10854,10709,15360,10934,10814,10677,15360,10926,10822,10701,1536010982,10878,10766,15360,10998,10894,10782,15360,10990,10878,10766,1536010998,10894,10782,15360,10998,10886,10774,15360,10998,10886,10758,1536011006,10894,10774,15360,10942,10838,10733,15360,10958,10854,10741,1536010958,10854,10749,15360,11006,10902,10790,15360,11015,10902,10798,1536010982,10870,10758,15360,10998,10894,10782,15360,10974,10870,10758,1536011006,10902,10790,15360,10998,10894,10774,15360,10974,10870,10758,1536010950,10854,10741,15360,10878,10790,10693,15360,10902,10814,10701,1536010918,10822,10709,15360,10838,10733,10613,15360,10878,10782,10661,1536010934,10838,10717,15360,10902,10806,10693,15360,10918,10822,10709,1536010926,10830,10709,15360,10838,10733,10605,15360,10910,10806,10661,1536010942,10838,10693,15360,10886,10782,10645,15360,10886,10782,10637,1536010854,10749,10621,15360,10926,10830,10709,15360,10966,10862,10741,1536010846,10749,10629,15360,10830,10733,10605,15360,10854,10758,10637,1536010822,10725,10605,15360,10886,10790,10661,15360,10902,10806,10669,1536010918,10814,10677,15360,10830,10733,10605,15360,10806,10717,10589,1536010870,10774,10645,15360,10934,10838,10709,15360,10958,10862,10733,1536010886,10790,10661,15360,10894,10798,10661,15360,10958,10854,10709,1536010934,10830,10709,15360,10814,10717,10581,15360,10862,10758,10613,1536010854,10741,10589,15360,10814,10717,10573,15360,10886,10782,10645,1536010814,10725,10597,15360,10862,10766,10637,15360,10910,10806,10669,1536010942,10838,10709,15360,10966,10862,10733,15360,10974,10870,10741,1536010974,10870,10749,15360,10958,10862,10749,15360,11031,10934,10822,1536010998,10894,10782,15360,10974,10870,10766,15360,11023,10918,10814,1536011039,10926,10822,15360,10958,10846,10741,15360,10918,10814,10693,1536010966,10870,10741,15360,10982,10886,10766,15360,10982,10878,10766,1536010942,10846,10733,15360,10958,10862,10758,15360,10950,10854,10758,1536010934,10830,10717,15360,10966,10862,10733,15360,10942,10846,10725,1536010934,10846,10733,15360,10934,10846,10733,15360,10878,10798,10693,1536010886,10798,10693,15360,10910,10814,10709,15360,10942,10846,10733,1536010838,10733,10597,15360,10878,10774,10645,15360,10918,10822,10701,1536010878,10782,10653,15360,10894,10790,10661,15360,10934,10838,10725,1536010958,10854,10725,15360,10966,10862,10733,15360,10910,10806,10685,1536010982,10878,10758,15360,10942,10854,10749,15360,10934,10838,10733,1536010918,10814,10701,15360,10894,10798,10669,15360,10894,10798,10669,1536010814,10725,10605,15360,10902,10798,10669,15360,10814,10725,10605,1536010894,10798,10685,15360,10958,10862,10749,15360,10910,10814,10701,1536010910,10806,10685,15360,10918,10814,10693,15360,10926,10822,10709,1536010894,10790,10661,15360,10902,10806,10677,15360,10902,10806,10685,1536010934,10838,10717,15360,10934,10838,10701,15360,10934,10838,10717,1536010950,10854,10725,15360,10894,10798,10661,15360,10862,10749,10597,1536010894,10798,10677,15360,10878,10782,10661,15360,10926,10838,10717,1536010926,10838,10717,15360,10918,10822,10709,15360,10934,10838,10733,1536010926,10838,10733,15360,10958,10870,10766,15360,10942,10854,10749,1536010958,10870,10774,15360,10974,10878,10774,15360,10958,10854,10741,1536010950,10846,10741,15360,10950,10854,10758,15360,10934,10838,10733,1536010942,10846,10725,15360,10966,10862,10741,15360,10926,10838,10733,1536010958,10862,10749,15360,10910,10822,10709,15360,10942,10854,10758,1536010926,10838,10733,15360,10910,10822,10717,15360,10934,10838,10733,1536010934,10846,10733,15360,10902,10814,10709,15360,10926,10830,10717,1536010918,10822,10709,15360,10838,10749,10637,15360,10878,10790,10677,1536010942,10846,10733,15360,10926,10822,10701,15360,10958,10862,10749,1536010886,10790,10685,15360,10918,10814,10693,15360,10910,10814,10693,1536010902,10806,10701,15360,10878,10774,10637,15360,10798,10693,10565,1536010822,10725,10597,15360,10934,10838,10709,15360,10958,10854,10725,1536010886,10790,10669,15360,10910,10806,10677,15360,10886,10782,10645,1536010830,10725,10597,15360,10822,10717,10581,15360,10862,10758,10637,1536010878,10782,10669,15360,10926,10822,10709,15360,10974,10878,10774,1536010966,10870,10758,15360,10918,10822,10709,15360,10846,10749,10645,1536010894,10798,10693,15360,10918,10822,10709,15360,10974,10878,10774,1536010918,10822,10717,15360,10982,10886,10774,15360,10974,10878,10758,1536010950,10854,10741,15360,10958,10854,10725,15360,10982,10886,10766,1536010918,10822,10701,15360,10878,10782,10669,15360,10886,10790,10669,1536010934,10838,10717,15360,10950,10854,10741,15360,10934,10838,10733,1536010982,10886,10782,15360,10886,10798,10701,15360,10870,10782,10685,1536010894,10814,10717,15360,10910,10822,10725,15360,10934,10838,10733,1536010950,10846,10741,15360,10934,10838,10725,15360,10934,10846,10749,1536010902,10814,10717,15360,10878,10790,10677,15360,10878,10782,10669,1536010854,10766,10645,15360,10838,10749,10629,15360,10902,10814,10701,1536010910,10814,10693,15360,10902,10798,10669,15360,10910,10806,10677,1536010886,10782,10653,15360,10854,10749,10629,15360,10870,10774,10653,1536010974,10870,10758,15360,10990,10878,10758,15360,10918,10822,10709,1536010926,10838,10725,15360,10958,10854,10733,15360,10894,10790,10653,1536010822,10725,10605,15360,10878,10782,10661,15360,10974,10870,10749,1536010902,10806,10677,15360,10934,10838,10725,15360,10870,10774,10653,1536010798,10701,10581,15360,10854,10749,10621,15360,10894,10798,10669,1536010934,10822,10685,15360,10942,10830,10701,15360,10910,10806,10669,1536010870,10758,10629,15360,10886,10774,10645,15360,10950,10838,10701,1536010966,10870,10749,15360,10886,10790,10685,15360,10870,10782,10677,1536010934,10838,10733,15360,10934,10838,10725,15360,10822,10725,10621,1536010878,10790,10677,15360,10894,10798,10693,15360,10822,10733,10629,1536010894,10798,10685,15360,10998,10902,10790,15360,11015,10918,10806,1536010950,10854,10741,15360,10950,10846,10741,15360,10934,10838,10733,1536010942,10846,10749,15360,10910,10822,10725,15360,10846,10758,10653,1536010878,10790,10685,15360,10894,10798,10701,15360,10862,10774,10669,1536010814,10725,10621,15360,10846,10758,10645,15360,10870,10774,10661,1536010870,10774,10677,15360,10878,10790,10693,15360,10878,10782,10677,1536010830,10741,10637,15360,10870,10782,10677,15360,10966,10870,10766,1536011015,10918,10814,15360,10910,10814,10701,15360,10942,10846,10725,1536010950,10846,10725,15360,10942,10838,10725,15360,10934,10830,10701,1536010910,10798,10677,15360,10886,10782,10653,15360,10838,10733,10597,1536010902,10806,10669,15360,10830,10733,10613,15360,10838,10741,10621,1536010838,10741,10621,15360,10894,10798,10669,15360,10934,10830,10685,1536010886,10790,10669,15360,10902,10806,10685,15360,10854,10749,10637,15360]);const Js=s("f693"),Xs=s("cfdd"),Ys="three/js/libs/draco/gltf/";class Zs{constructor(e,t,s=F){this.selectedObject=void 0,this.sceneBackgroundColor=new y["n"](15463159),this.loadedModels={},this.composerRenderEnabled=!0,this.composerEnabled=!1,this.height=0,this.width=0,this.savedMaterialsForOpacity=[],this.mouseMoved=!1,this.mouseDoubleClicked=!1,this.raf=new Vs,this.renderEnabled=!0,this.isFrustumInsectChecking=!1,this.events=[],this.postmate=o.instance(),this.enableRender=(e=1e3)=>{this.renderEnabled=!0,this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.timeoutSymbol=this.raf.setTimeout(()=>{this.renderEnabled=!1,this.composerRenderEnabled=!0},e))},this.ifcHighlightMaterial=new y["sb"]({color:16711935,depthTest:!1,transparent:!0,opacity:.3}),this.watch=(e,t)=>{if(e in this){let s=this[e];Object.defineProperty(this,e,{set:function(e){const i=s;s=e,t(e,i,this)},get:function(){return s}})}},this.width=e,this.height=t,this.settings=s,this.init()}init(){this.initScene(),this.initRenderer(),this.initCamera(),this.initControls(),this.initLights(),this.initPointerEvents(),this.initDatGui(),this.initPostmate(),this.initOthers()}initScene(){this.scene=new y["Xb"],this.scene.matrixAutoUpdate=ie}initRenderer(){this.renderer=new y["Ac"]({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.outputColorSpace=y["Wb"],this.renderer.toneMappingExposure=1,this.renderer.useLegacyLights=!1,this.renderer.setClearColor(11119017,1),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=y["Fb"],this.css2dRenderer=new os["b"],this.css2dRenderer.setSize(this.width,this.height),this.stats=new Ks["a"];const e=new y["Gb"](this.renderer);e.compileEquirectangularShader(),qs.createEnvTextureFromDataArray(e).then(e=>{this.scene&&(this.scene.environment=e)})}initCamera(){this.scene&&(this.perspectiveCamera=new y["Hb"](45,this.width/this.height,this.settings.camera.near,this.settings.camera.far),this.perspectiveCamera.position.set(0,100,0),this.scene.add(this.perspectiveCamera),this.camera=this.perspectiveCamera)}initControls(e=!1){if(!this.renderer)return;$s.printDeviceInfo();const t=e?this.orthoCamera:this.perspectiveCamera;if(!t)return;const s=new ms["a"](t,this.renderer.domElement);s.enableDamping=!0,s.dampingFactor=.5,s.enabled=!0,s.keyPanSpeed=10,s.keys={LEFT:"KeyA",UP:"Space",RIGHT:"KeyD",BOTTOM:"ControlLeft"},s.listenToKeyEvents(document.body),s.update(),e?this.orthoCameraConrols=s:this.perspectiveCameraControls=s,this.controls=s,this.addEvent(s,"change",this.onControlsChange(this)),this.addEvent(window,"keydown",this.onKeyDown(this))}onControlsChange(e){return()=>{e.enableRender()}}onKeyDown(e){return t=>{const s=e.camera,i=e.controls;if(!s||!i)return;const n=this.settings.keyboard.sensitivity||3,o=new y["wc"];s.getWorldPosition(o);const r=i.target,a=r.clone();if("ArrowLeft"===t.code||"ArrowRight"===t.code){const e=n;let s=Math.PI*e/180;"ArrowLeft"===t.code&&(s=-s),a.x=(r.x-o.x)*Math.cos(s)-(r.z-o.z)*Math.sin(s)+o.x,a.z=(r.z-o.z)*Math.cos(s)+(r.x-o.x)*Math.sin(s)+o.z,i.target=a,i.update()}else if("ArrowUp"===t.code||"ArrowDown"===t.code){const e=n;let s=Math.PI*e/180;const c=new y["wc"](r.x-o.x,r.y-o.y,r.z-o.z),l=c.length(),d=r.y-o.y;"ArrowDown"===t.code&&(s=-s);const h=Math.asin(d/l)+s;if(h<-Math.PI/2||h>Math.PI/2)return;const u=Math.sin(h)*l;a.y=r.y+(u-d),i.target=a,i.update()}else if("KeyW"===t.code){const e=.01*n,t=o.distanceTo(r);t<s.near&&i.target.lerp(o,-s.near/t),o.lerp(r,e),s.position.set(o.x,o.y,o.z)}else if("KeyS"===t.code){const e=.01*n;o.lerp(r,-e),s.position.set(o.x,o.y,o.z)}else if("KeyF"===t.code)this.flyToSelectedObject();else if("KeyT"===t.code){const e=this.getIntersections();if(e.length>0){const t=e.find(e=>{const t=e.object;return t.visible&&t instanceof y["nb"]});if(t&&t.point&&this.camera&&this.controls){const e=this.camera.position,s=t.point,i=this.controls.target,n=e.distanceTo(s);if(n>this.camera.near&&n<this.camera.far){const t=e.distanceTo(i),s=e.clone().lerp(i,n/t);this.controls.target.set(s.x,s.y,s.z),this.scene&&As.displayPointMarker(this.scene,s,1e3)}}}}else"KeyY"===t.code&&this.flyTo(o,r.clone().setY(o.y));e.enableRender()}}onPointerUp(e,t){return()=>{e.mouseDoubleClicked||(e.handleMouseClick(t),e.enableRender())}}initLights(){if(!this.scene)return;const e=16777215,t=.3,s=new y["w"](e,t);s.position.set(-2,2,4),this.directionalLight=s,this.ambientLight=new y["c"](3158064),this.hemisphereLight=new y["O"](e,14540253,3),this.hemisphereLight.position.set(0,300,0),this.scene.add(s),this.scene.add(this.ambientLight),this.scene.add(this.hemisphereLight)}initPointerEvents(){this.renderer&&this.camera&&this.controls&&(this.renderer.domElement.addEventListener("pointerdown",e=>{this.mouseMoved=!1,this.enableRender()}),this.renderer.domElement.addEventListener("pointermove",e=>{this.mouseMoved=!0,this.measure&&!this.measure.isCompleted&&this.enableRender()}),this.renderer.domElement.addEventListener("pointerup",e=>{this.mouseMoved||this.mouseDoubleClicked||setTimeout(this.onPointerUp(this,e),200),this.mouseDoubleClicked&&setTimeout(()=>{this.mouseDoubleClicked=!1},200)}),this.renderer.domElement.addEventListener("dblclick",e=>{this.mouseDoubleClicked=!0,this.mouseMoved||this.measure&&!this.measure.isCompleted||(this.handleMouseClick(e),this.flyToSelectedObject(),this.enableRender())}),this.raycaster=new y["Tb"])}initDatGui(){this.datGui=new Hs(this),this.datGui.close()}initPostmate(){this.postmate.isEmbedded&&(this.postmate.addEventListener(i.setObjectsBoxClipper,e=>{const t=e.value;t?this.enableSection("ObjectsBoxSection"):this.disableSection()}),this.postmate.addEventListener(i.setObjectsPlaneClipper,e=>{const t=e.value;t?this.enableSection("PlaneSection"):this.disableSection()}))}initOthers(){if(!this.scene||!this.renderer||!this.camera)return;const e=this.datGui&&this.datGui.controls;e&&(e.showGroundGrid&&(this.groundGrid=Us.createGroundGrid(),this.scene.add(this.groundGrid)),e.showGrassGround&&(async()=>{this.grassGround=await Us.createGrassGround(),this.scene&&this.scene.add(this.grassGround),this.enableRender()})(),e.webcam&&this.enableWebCam(),this.composerEnabled=e.composerEnabled,this.composerEnabled&&(this.enableComposer(!0),this.enableRenderPass(e.renderPassEnabled),this.enableFxaaPass(e.fxaaEnabled),this.enableSaoPass(e.saoEnabled),this.enableSsaoPass(e.ssaoEnabled),this.enableOutlinePass(e.outlineEnabled),this.enableSsaaPass(e.ssaaEnabled),this.enableBloomPass(e.bloomEnabled),this.enableUnrealBloomPass(e.unrealBloomEnabled))),console.log("[Viewer] WebGL: "+$s.getWebGlRendererInfo(this.renderer.domElement)),this.renderer.domElement.style.outlineWidth="0"}sycnCameraPosition(e,t){const s=e.position;if(t.position.set(s.x,s.y,s.z),this.scene){const e=this.scene.position;t.lookAt(e)}}sycnControls(e,t,s){const i=s,n=e.target;t.center?t.center.set(i.x,i.y,i.z):t.center=i.clone(),t.target.set(n.x,n.y,n.z),t.update()}setToOrthographicCamera(e=!1){if(!this.scene||!this.controls)return;const t=this.perspectiveCamera,s=this.perspectiveCameraControls;let i=this.orthoCamera,n=this.orthoCameraConrols;e?(i||(i=new y["Eb"](-this.width/2,this.width/2,this.height/2,-this.height/2,this.settings.camera.near,this.settings.camera.far),i.position.set(0,100,0),i.zoom=10,i.updateProjectionMatrix(),this.scene&&this.scene.add(i),this.orthoCamera=i),n||(this.initControls(!0),n=this.orthoCameraConrols),t&&(this.sycnCameraPosition(t,i),i.zoom=10,i.updateProjectionMatrix()),s&&n&&this.sycnControls(s,n,i.position),this.camera=i,this.controls=n):(t&&i&&this.sycnCameraPosition(i,t),s&&n&&t&&this.sycnControls(n,s,t.position),this.camera=t,this.controls=s),this.resize()}animate(){requestAnimationFrame(this.animate.bind(this)),this.tween&&Js.update(),this.webcam&&this.webcam.animate(),this.controls&&!this.tween&&this.controls.update(),this.renderEnabled&&this.scene&&this.camera&&(this.renderer&&this.renderer.render(this.scene,this.camera),this.css2dRenderer&&this.css2dRenderer.render(this.scene,this.camera)),this.composerRenderEnabled&&this.composer&&this.composerEnabled&&(this.composer.render(),this.composerRenderEnabled=!1),this.frustrumCullingByModelBBox(),this.stats&&this.stats.update()}frustrumCullingByModelBBox(){const e=new y["K"],t=new y["mb"];this.isFrustumInsectChecking=!0,this.camera&&(t.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),e.setFromProjectionMatrix(t),Object.values(this.loadedModels).forEach(t=>{const s=this.scene&&this.scene.getObjectByProperty("uuid",t.uuid),i=t.bbox;s&&i&&this.scene&&("undefined"===typeof s.userData._visible&&(s.userData._visible=!0,Object.defineProperties(s,{visible:{set:e=>{s.userData._visible=e,this.isFrustumInsectChecking||(s.userData.userConfigVisibility=!0)},get:()=>s.userData._visible}})),"undefined"===typeof s.userData.userConfigVisibility&&(i.geometry.computeBoundingBox(),i.geometry.boundingBox&&(s.visible=e.intersectsBox(i.geometry.boundingBox))))})),this.isFrustumInsectChecking=!1}beforeDestroy(){this.events.forEach(e=>e.node.removeEventListener(e.type,e.func)),this.events=[],this.datGui&&this.datGui.gui&&(this.datGui.beforeDestroy(),this.datGui=void 0);const e=this.webcamPlane;this.scene&&e&&(this.scene.remove(e),e.geometry.dispose(),e.material.dispose(),this.webcamPlane=void 0),this.webcam=void 0,this.camera=void 0,this.composer=void 0,this.renderPass=void 0,this.effectFxaaPass=void 0,this.saoPass=void 0,this.ssaoPass=void 0,this.outlinePass=void 0,this.scene&&(this.scene.clear(),this.scene=void 0),this.renderer&&(this.renderer.clear(),this.renderer.dispose(),this.renderer=void 0),this.ambientLight=void 0,this.directionalLight=void 0,this.hemisphereLight=void 0,this.controls&&(this.controls.dispose(),this.controls=void 0),this.stats=void 0,this.raycaster=void 0,this.selectedObject=void 0,this.groundGrid&&(this.groundGrid.geometry.dispose(),this.groundGrid.material.dispose(),this.groundGrid.clear(),this.groundGrid=void 0),this.grassGround&&(this.grassGround.geometry.dispose(),this.grassGround.material.dispose(),this.grassGround.clear(),this.grassGround=void 0),this.skyOfGradientRamp&&(this.skyOfGradientRamp.geometry.dispose(),this.skyOfGradientRamp.material.dispose(),this.skyOfGradientRamp.clear(),this.skyOfGradientRamp=void 0),this.savedMaterialsForOpacity=void 0,this.section=void 0,Object.keys(this.loadedModels).forEach(e=>{delete this.loadedModels[e]}),this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.raf=void 0),this.postmate.isEmbedded&&this.postmate.removeEventListener(i.setObjectsBoxClipper,i.setObjectsPlaneClipper)}async loadLocalModel(e,t,s){const i=e.src,n=e.src.toLowerCase();return n.endsWith("fbx")?this.loadFbx(i,e,t,s):n.endsWith("obj")?this.loadObj(i,e,t,s):n.endsWith("stl")?this.loadStl(i,e,t,s):n.endsWith("ifc")?this.loadIfc(i,e,t,s):n.endsWith("shp")?this.loadShp(i,e,t,s):n.endsWith("dae")?this.loadDae(i,e,t,s):this.loadGltf(i,e,t,s)}async loadModel(e,t,s){const i=e.src.toLowerCase();return i.endsWith("fbx")?this.loadFbx(i,e,t,s):i.endsWith("obj")?this.loadObj(i,e,t,s):i.endsWith("stl")?this.loadStl(i,e,t,s):i.endsWith("ifc")?this.loadIfc(i,e,t,s):i.endsWith("shp")?this.loadShp(i,e,t,s):i.endsWith("dae")?this.loadDae(i,e,t,s):this.loadGltf(i,e,t,s)}async loadGltf(e,t,s,i){const n=this.getGltfLoader();return new Promise((o,r)=>{-1!==e.indexOf("#")&&console.warn("[Viewer3D] '#' is not allowed in filename "+e),n.load(e.replace(/#/g,encodeURIComponent("#")),s=>{const i=s.scene;this.applyOptionsAndAddToScene(e,i,t),o(i)},s,e=>{i&&i(e),r(e)})})}async loadFbx(e,t,s,i){const n=new cs["a"];return new Promise((o,r)=>{n.load(e,s=>{this.applyOptionsAndAddToScene(e,s,t),o(s)},s,e=>{i&&i(e),r(e)})})}async loadObj(e,t,s,i){const n=new us["a"],o=new ds["a"],r=e.replace(".obj",".mtl");return new Promise((a,c)=>{o.load(r,o=>{o.preload(),n.setMaterials(o),n.load(e,s=>{this.applyOptionsAndAddToScene(e,s,t),a(s)},s,e=>{i&&i(e),c(e)})})})}async loadStl(e,t,s,i){const n=new ps["a"];return new Promise((o,r)=>{n.load(e,s=>{const i=new y["nb"](s);if(t.src)i.name=t.src;else{const t=e.lastIndexOf("/");-1!==t&&(i.name=e.substr(t+1))}this.applyOptionsAndAddToScene(e,i,t),o(i)},s,e=>{i&&i(e),r(e)})})}async loadIfc(e,t,s,i){if(!this.scene)throw new Error("Failed to load!");if(!this.ifcLoader){this.ifcLoader=new Xs.IFCLoader;const e=this.ifcLoader.ifcManager;e&&"function"===typeof e.setWasmPath&&e.setWasmPath("../three/js/libs/ifc/")}const n=this.ifcLoader;return new Promise((o,r)=>{n.load(e,s=>{this.applyOptionsAndAddToScene(e,s.mesh,t),o(s.mesh)},s,e=>{i&&i(e),r(e)})})}async loadShp(e,t,s,i){if(!this.scene)throw new Error("Failed to load!");const n=new Ps;return new Promise((o,r)=>{n.load(e,s=>{this.applyOptionsAndAddToScene(e,s,t),o(s)},s,e=>{i&&i(e),r(e)})})}async loadDae(e,t,s,i){if(!this.scene)throw new Error("Failed to load!");const n=new rs["a"];return new Promise((o,r)=>{n.load(e,s=>{if(s){const i=s.scene;this.applyOptionsAndAddToScene(e,i,t),o(i)}else{const e=new ErrorEvent("");i&&i(e),r(e)}},s,e=>{i&&i(e),r(e)})})}async loadPly(e,t,s,i){if(!this.scene)throw new Error("Failed to load!");const n=new hs["a"];return new Promise((o,r)=>{n.load(e,s=>{const i=new y["nb"](s);if(t.src)i.name=t.src;else{const t=e.lastIndexOf("/");-1!==t&&(i.name=e.substr(t+1))}this.applyOptionsAndAddToScene(e,i,t),o(i)},s,e=>{i&&i(e),r(e)})})}applyOptionsAndAddToScene(e,t,s){const i=s.position||[0,0,0],n=s.rotation||[0,0,0],o=s.scale||[1,1,1],r=s.instantiate,a=s.merge;t.position.set(i[0],i[1],i[2]),t.rotation.set(n[0]*Math.PI/180,n[1]*Math.PI/180,n[2]*Math.PI/180),t.scale.set(o[0],o[1],o[2]),r?setTimeout(()=>{this.instantiate(t),setTimeout(()=>{a&&this.merge(t),this.addLoadedModelToScene(t,s)},0)},0):a?setTimeout(()=>{this.merge(t),setTimeout(()=>this.addLoadedModelToScene(t,s),0)},0):this.addLoadedModelToScene(t,s)}getGltfLoader(){if(!this.gltfLoader){this.gltfLoader=new ls["a"];const e=new as["a"];e.setDecoderPath(Ys),this.gltfLoader.setDRACOLoader(e)}return this.gltfLoader}addLoadedModelToScene(e,t){if(!this.scene)return;e.matrixAutoUpdate=ie,e.updateMatrix(),e.traverse(e=>{!ie&&e.matrixAutoUpdate&&(e.matrixAutoUpdate=ie,e.updateMatrix());const t=e=>{e.opacity<1&&!e.transparent&&(e.transparent=!0)};e instanceof y["nb"]&&(e.material instanceof y["jb"]?t(e.material):Array.isArray(e.material)&&e.material.forEach(e=>{t(e)}))}),this.scene.add(e);const s=new y["i"](e);s.visible=!1,s.matrixAutoUpdate=ie,s.material&&(s.material=void 0,s.userData.selectable=!1),this.loadedModels[t.src]={uuid:e.uuid,bbox:s};const i=Object.values(this.loadedModels).map(e=>e.uuid),n=!i||i.length<=1;if(n){const e=this.datGui&&this.datGui.controls;this.regenSkyOfGradientRamp(),e&&e.showGroundGrid&&this.regenGroundGrid(),this.goToHomeView()}this.scene.add(s),t.edges&&re.addOutlines(e),this.enableRender()}addOrRemoveObjectOpacity(e=!0,t=.3){if(this.savedMaterialsForOpacity||(this.savedMaterialsForOpacity=[]),!this.scene)return;const s=this.scene,i=[];Object.keys(this.loadedModels).forEach(n=>{const o=this.loadedModels[n];if(e){this.savedMaterialsForOpacity.length>0&&re.revertObjectOpacityByUuid(s,o.uuid,this.savedMaterialsForOpacity);const e=re.setObjectOpacityByUuid(s,o.uuid,t);i.push(...e)}else re.revertObjectOpacityByUuid(s,o.uuid,this.savedMaterialsForOpacity)}),this.savedMaterialsForOpacity=e?i:[],this.enableRender()}resize(e,t){const s=this.camera;s&&(this.width=e||window.innerWidth,this.height=t||window.innerHeight,s instanceof y["Hb"]?s.aspect=this.width/this.height:s instanceof y["Eb"]&&(s.left=-this.width/2,s.right=this.width/2,s.top=this.height/2,s.bottom=-this.height/2),s.updateProjectionMatrix(),this.renderer&&this.renderer.setSize(this.width,this.height),this.css2dRenderer&&this.css2dRenderer.setSize(this.width,this.height),this.composer&&this.composer.setSize(this.width,this.height),this.effectFxaaPass&&this.effectFxaaPass.uniforms["resolution"].value.set(1/this.width,1/this.height)),this.enableRender()}clonedHighlightMaterials(e,t={}){if(!e||!e.material)return;const s=e.material;if(Array.isArray(s)&&s.length>0){const e=[];return s.forEach(s=>{e.push(this.clonedHighlightMaterial(s,t))}),e}if(s instanceof y["jb"])return this.clonedHighlightMaterial(s,t);console.warn("Invalid material: "+s)}clonedHighlightMaterial(e,t={}){const{depthTest:s,highlightColor:i=new y["n"](16711935),opacity:n=.7}=t,o=e.clone();return o instanceof y["ub"]||o instanceof y["sb"]?(o.emissive.set(i),o.color.set(i)):o instanceof y["ob"]||o instanceof y["Y"]||o instanceof y["qb"]?o.color.set(i):console.error("Unsupported Material: "+(typeof o).toString()),o.opacity=n,o.transparent=!0,void 0!==s&&(o.depthTest=!1,o.side=y["x"]),o}getIntersections(e){if(!this.raycaster||!this.camera||!this.scene)return[];let t=0,s=0;e&&(t=e.clientX/this.width*2-1,s=-e.clientY/this.height*2+1);const i=new y["vc"](t,s);this.raycaster.setFromCamera(i,this.camera);const n=[];return Object.values(this.loadedModels).forEach(e=>{const t=this.scene&&this.scene.getObjectByProperty("uuid",e.uuid);t&&t.visible&&n.push(t)}),this.raycaster.intersectObjects(n,!0)||[]}handleMouseClick(e){if(this.measure&&!this.measure.isCompleted)return;const t=this.getIntersections(e),s=t.find(e=>{const t=e.object;return t.visible&&(!1!==t.userData.selectable||t instanceof y["nb"])});let i,n=s&&s.object||void 0;if(n)if(!1===n.userData.selectable)console.log(`[Viewer] object(type: ${n.type}, name: ${n.name}) not selectable!`),n=void 0;else if(n instanceof y["R"])i=s.instanceId,this.selectedObject&&this.selectedObject.uuid===n.uuid&&this.selectedObject.userData.instanceId===i&&(n=void 0);else if(n.ifcManager){const e=s&&s.faceIndex||-1;i=e,this.selectedObject&&this.selectedObject.userData.faceIndex===e&&(n=void 0)}else this.selectedObject&&this.selectedObject.uuid===n.uuid&&(n=void 0);n?this.selectObject(n,i):this.clearSelection()}selectObject(e,t,s){if(this.selectedObject){const t=this.selectedObject.userData;if(null!=t.instanceId&&t.originalMatrix&&t.clonedMesh){this.scene&&this.scene.remove(t.clonedMesh);const s=this.selectedObject;if(s.setMatrixAt(t.instanceId,t.originalMatrix),s.instanceMatrix.needsUpdate=!0,s.updateMatrix(),delete t.instanceId,delete t.originalMatrix,e===t.clonedMesh)return t.clonedMesh.geometry.dispose(),delete t.clonedMesh,this.selectedObject=void 0,void(this.outlinePass&&(this.outlinePass.selectedObjects=[]));t.clonedMesh.geometry.dispose(),delete t.clonedMesh}else if(t.highlightConfigOfModel){var i;const e=null===(i=this.ifcLoader)||void 0===i?void 0:i.ifcManager;if(e){const s=t.highlightConfigOfModel;e.removeSubset(s.modelID)}this.ifcHighlightMaterial.opacity=0,delete t.highlightConfigOfModel,delete t.faceIndex}else if(t.originalMaterial){if(this.selectedObject.material){const e=this.selectedObject.material;Array.isArray(e)?e.forEach(e=>e.dispose()):e instanceof y["jb"]&&e.dispose()}this.selectedObject.material=t.originalMaterial,delete t.originalMaterial}this.selectedObject=void 0,this.outlinePass&&(this.outlinePass.selectedObjects=[])}if(this.scene&&e){if(e instanceof y["R"]&&null!=t){const i=e,n=new y["mb"],o=new y["mb"];o.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),i.getMatrixAt(t,n),this.selectedObject=e,this.outlinePass&&(this.outlinePass.selectedObjects=[e]);const r=this.clonedHighlightMaterials(e,{depthTest:s});if(r){const s=new y["nb"](i.geometry.clone(),r);s.applyMatrix4(e.matrixWorld.multiply(n)),s.matrixWorldNeedsUpdate=!0,s.name="Cloned mesh for highlighting";const a=n.clone();a.multiplyMatrices(n,o),i.setMatrixAt(t,a),i.instanceMatrix.needsUpdate=!0,i.updateMatrix(),this.selectedObject.userData.instanceId=t,this.selectedObject.userData.originalMatrix=n,this.selectedObject.userData.clonedMesh=s,this.scene.add(s)}}else if(e.ifcManager&&null!=t){var n;const s=e,i=null===(n=this.ifcLoader)||void 0===n?void 0:n.ifcManager,o=t;if(o>=0&&i){const e=s.geometry,t=i.getExpressId(e,o),n=this.scene;if(t&&n){const e=s.modelID,r={modelID:e,ids:[t],scene:n,removePrevious:!0,material:this.ifcHighlightMaterial},a=i.createSubset(r);if(a){a.userData.highlightConfigOfModel=r,a.userData.faceIndex=o,this.ifcHighlightMaterial.opacity=.3;const s=i.getItemProperties(e,t,!0);console.log("Properties",s),this.selectedObject=a}else console.warn(`[Viewer3D] Failed to createSubset for ifc modelID: ${e}, id: ${t}`)}}}else{const t=this.clonedHighlightMaterials(e,{depthTest:s});t&&(this.selectedObject=e,this.selectedObject.userData.originalMaterial=this.selectedObject.material,this.selectedObject.material=t,this.outlinePass&&(this.outlinePass.selectedObjects=[e]))}this.enableRender()}}clearSelection(){this.selectObject()}flyToObjects(e){if(!e||0===e.length||!this.camera)return;const t=new y["wc"],s=new y["wc"];ut.getCameraPositionByObjects(e,this.camera,t,s),this.flyTo(t,s)}flyToObject(e){this.flyToObjects([e])}flyToSelectedObject(){if(!this.selectedObject)return;let e=this.selectedObject;e instanceof y["R"]&&e.userData.clonedMesh&&(e=e.userData.clonedMesh),this.flyToObject(e)}flyTo(e,t,s){const i=this.camera,n=this.controls;if(!i||!n)return;if(e.equals(t))return void console.error("[Viewer3D] camera position and lookAt cannot be the same!");if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||isNaN(t.x)||isNaN(t.y)||isNaN(t.z))return void console.error("[Viewer3D] invalid position or lookAt!");const o=e.distanceTo(t);o<i.near?(e=e.clone().sub(t).normalize().multiplyScalar(1.1*i.near),console.warn("[Viewer3D] camera could be too close to see the object!")):o>i.far&&(e=e.clone().sub(t).normalize().multiplyScalar(.9*i.far),console.warn("[Viewer3D] camera could be too far to see the object!"));const r=(e,t)=>{t&&i.lookAt(t),e&&i.position.set(e.x,e.y,e.z),t&&n.target.set(t.x,t.y,t.z),n.update(),this.enableRender()},a=n.target.clone(),c=new Js.Tween(a);c.to(t,500),c.easing(Js.Easing.Sinusoidal.InOut),c.onUpdate(()=>{r(void 0,a)}),c.onComplete(()=>{const n=i.position.clone(),o=new Js.Tween(n);o.to(e,1500),o.easing(Js.Easing.Sinusoidal.InOut),o.onUpdate(()=>{r(n,t)}),o.onComplete(()=>{r(n,t),s&&s()}),this.tween=o,o.start()}),this.tween=c,c.start()}goToHomeView(){const e=X.state.activeProject,t=e&&e.camera,s=t&&O.arrayToVector3(t.eye),i=t&&O.arrayToVector3(t.look);if(s&&i)this.flyTo(s,i);else if(this.scene){const e=new y["wc"],t=new y["wc"];ut.getCameraPositionByObjectUuids(this.scene,Object.values(this.loadedModels).map(e=>e.uuid),ct.Front,e,t),e.equals(t)||this.flyTo(e,t)}}regenSkyOfGradientRamp(){if(!this.scene)return;this.skyOfGradientRamp&&(this.skyOfGradientRamp.geometry.dispose(),this.skyOfGradientRamp.material.dispose(),this.scene.remove(this.skyOfGradientRamp),this.skyOfGradientRamp.clear(),this.skyOfGradientRamp=void 0);const e=Object.values(this.loadedModels).map(e=>e.uuid);if(e){const t=X.state.activeProject,s=t&&t.camera,i=s&&O.arrayToVector3(s.eye),n=s&&O.arrayToVector3(s.look);if(i&&n){const e=i,t=n,s=new y["h"];s.expandByPoint(new y["wc"](e.x,e.y,e.z)),s.expandByPoint(new y["wc"](t.x,t.y,t.z)),this.skyOfGradientRamp=zs.createSkyOfGradientRampByBoundingBox(s)}else this.skyOfGradientRamp=zs.createSkyOfGradientRampByObjectsInScene(this.scene,e);this.scene.add(this.skyOfGradientRamp)}}regenGroundGrid(){if(!this.scene)return;this.groundGrid&&(this.groundGrid.geometry.dispose(),this.groundGrid.material.dispose(),this.scene.remove(this.groundGrid));const e=Object.values(this.loadedModels).map(e=>e.uuid);if(e){const e=X.state.activeProject,t=e&&e.camera,s=t&&O.arrayToVector3(t.look);s&&(s.y=0),this.groundGrid=Us.createGroundGrid(void 0,void 0,s),this.scene.add(this.groundGrid)}}enableComposer(e){this.scene&&this.camera&&this.renderer&&(this.composerEnabled=e,e&&!this.composer&&(this.composer=new gs["a"](this.renderer)),this.enableRender())}enableRenderPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.renderPass){const e=new ws["a"](this.scene,this.camera);e.setSize(this.width,this.height),this.composer.addPass(e),this.renderPass=e}this.renderPass&&(this.renderPass.enabled=e),this.enableRender()}}enableFxaaPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.effectFxaaPass){const e=new Os["a"](fs["a"]);e.uniforms["resolution"].value.set(1/this.width,1/this.height),e.setSize(this.width,this.height),e.renderToScreen=!0,this.composer.addPass(e),this.effectFxaaPass=e}this.effectFxaaPass&&(this.effectFxaaPass.enabled=e),this.enableRender()}}enableSaoPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.saoPass){const e=new ys["a"](this.scene,this.camera,!1,!0,new y["vc"](1/this.width,1/this.height));e.setSize(this.width,this.height),e.params.output=0,e.params.saoBias=.5,e.params.saoIntensity=5e-5,e.params.saoScale=5,e.params.saoKernelRadius=40,e.params.saoMinResolution=0,this.composer.addPass(e),this.saoPass=e}this.saoPass&&(this.saoPass.enabled=e),this.enableRender()}}enableSsaoPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.ssaoPass){const e=new Es["a"](this.scene,this.camera,this.width,this.height);e.kernelRadius=16,e.minDistance=.005,e.maxDistance=.1,this.composer.addPass(e),this.ssaoPass=e}this.ssaoPass&&(this.ssaoPass.enabled=e),this.enableRender()}}enableOutlinePass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.outlinePass){const e=new vs["a"](new y["vc"](this.width,this.height),this.scene,this.camera);e.edgeStrength=3,e.edgeGlow=0,e.edgeThickness=2,e.pulsePeriod=0,e.visibleEdgeColor.set(16711680),e.hiddenEdgeColor.set(16752768),this.composer.addPass(e),this.outlinePass=e}this.outlinePass&&(this.outlinePass.enabled=e),this.enableRender()}}enableSsaaPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.ssaaRenderPass){const e=new xs["a"](this.scene,this.camera,16777215,0);this.composer.addPass(e),this.ssaaRenderPass=e}this.ssaaRenderPass&&(this.ssaaRenderPass.enabled=e),this.enableRender()}}enableBloomPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.bloomPass){const e=new bs["a"](1,25,4);e.renderToScreen=!0,this.composer.addPass(e),this.bloomPass=e}this.bloomPass&&(this.bloomPass.enabled=e),this.enableRender()}}enableUnrealBloomPass(e){if(this.scene&&this.camera&&this.renderer&&this.composer){if(e&&!this.unrealBloomPass){const e=new Ms["a"](new y["vc"](this.width,this.height),1,0,0);e.threshold=0,e.strength=.5,e.radius=0,this.composer.addPass(e),this.unrealBloomPass=e}this.unrealBloomPass&&(this.unrealBloomPass.enabled=e),this.enableRender()}}enableSection(e="ObjectsBoxSection"){if(!this.scene||!this.camera||!this.renderer||!this.controls)return;this.section&&this.disableSection();const t=Object.values(this.loadedModels).map(e=>e.uuid);!t||t.length<1?console.warn("No object to section!"):(this.renderer.localClippingEnabled=!0,"ObjectsBoxSection"===e?(this.section=new de(t,this.scene,this.camera,this.renderer,this.controls),this.section.open()):"PlaneSection"===e&&(this.section=new me(t,this.scene,this.camera,this.renderer,this.controls),this.section.open()),this.enableRender())}disableSection(){this.renderer&&this.section&&(this.section.close(),this.section=void 0,this.enableRender())}enableMeasure(e){this.scene&&this.camera&&this.renderer&&this.controls&&(this.measure&&this.disableMeasure(),this.measure=new Gs(this.renderer,this.scene,this.camera,this.controls,e,this.settings),this.measure.open())}disableMeasure(){this.renderer&&this.measure&&(this.measure&&this.measure.close(),this.measure=void 0)}enableWebCam(){this.scene&&(this.webcam||(this.webcam=new js),this.webcamPlane||(this.webcamPlane=this.webcam.createWebCamPlane(),this.webcamPlane.position.set(10,2,0)),this.scene.add(this.webcamPlane))}disableWebCam(){this.scene&&this.webcamPlane&&(this.webcamPlane.geometry.dispose(),this.webcamPlane.material.dispose(),this.scene.remove(this.webcamPlane))}instantiate(e){new ot(e).instantiate()}merge(e){new at(e).merge()}addEvent(e,t,s){e.addEventListener(t,s),this.events.push({node:e,type:t,func:s})}updateProjectSettings(e){this.settings=e;const t=(e,t)=>{e&&t&&(e.near=t.near,e.far=t.far,e.updateProjectionMatrix())};t(this.perspectiveCamera,this.settings.camera),t(this.orthoCamera,this.settings.camera),this.enableRender(10)}}var Qs;(function(e){e[e["FAILED"]=0]="FAILED",e[e["RUNNING"]=1]="RUNNING",e[e["SUCCEEDED"]=2]="SUCCEEDED"})(Qs||(Qs={}));let ei=class extends g["d"]{constructor(){super(...arguments),this.selectedObjId="",this.onLoading=!1,this.loadingProgress=0,this.loadingText="",this.showProjectSettingPanel=!1}mounted(){this.initProjectSettings();const e=this.$refs.viewerContainer,t=new Zs(window.innerWidth,window.innerHeight,this.projectSettings);t.animate(),this.viewer=t,t.renderer&&(e.appendChild(t.renderer.domElement),O.getSampleProjects().then(e=>{const s=e.find(e=>e.id===this.projectId);s?(this.$store.commit(V.MUTATION_ACTIVE_PROJECT,s),this.loadSampleProjectModels(t,s)):p.a.error("Failed to find project for projectId: "+this.projectId)})),t.css2dRenderer&&(t.css2dRenderer.domElement.classList.add("css2dRenderer"),e.appendChild(t.css2dRenderer.domElement)),this.initStats(t),this.initAxesRenderer(t),window.addEventListener("resize",()=>{t&&t.resize(window.innerWidth,window.innerHeight)},!1),t.watch("selectedObject",e=>{var t;if(null!==e&&void 0!==e&&null!==(t=e.userData)&&void 0!==t&&t.gltfExtensions){var s,i,n;const t=null===e||void 0===e||null===(s=e.userData)||void 0===s?void 0:s.gltfExtensions,o=(null===t||void 0===t||null===(i=t.objectId)||void 0===i?void 0:i.Value)||(null===t||void 0===t||null===(n=t.elementId)||void 0===n?void 0:n.Value);this.selectedObjId=o||""}else null!==e&&void 0!==e&&e.uuid?this.selectedObjId=e.uuid:this.selectedObjId=""})}initStats(e){const t=e.stats;if(t){t.setMode(0);const e=this.$refs.statsOutput;e.appendChild(t.domElement)}}initProjectSettings(){const e=$+"_"+this.projectId,t=localStorage.getItem(e)&&JSON.parse(localStorage.getItem(e)||""),s=Object(B["cloneDeep"])(F);t&&Object.assign(s,Object(B["cloneDeep"])(t)),this.projectSettings=s}beforeDestroy(){this.viewer&&(this.viewer.beforeDestroy(),this.viewer=void 0),this.axesViewport&&(this.axesViewport.dispose(),this.axesViewport=void 0),this.selectedObjId="",this.loadingText=""}initAxesRenderer(e){const t=this.$refs.axesRenderer,s=new Et(t.clientWidth,t.clientHeight);s.renderer&&(t.appendChild(s.renderer.domElement),s.setHostRenderer(e)),this.axesViewport=s}loadSampleProjectModels(e,t){if(!e||!t)return void console.log("[VC] Failed to load a project!");if(!t.models||t.models.length<1)return void console.log("[VC] No models to load!");this.onLoading=!1,this.loadingProgress=0;let s=0;for(let i=0;i<t.models.length;++i){const n=t.models[i];!1!==n.visible&&(s++,this.onLoading=!0,e.loadModel(n,e=>{this.loadingText=`${t.name}(${i+1}/${t.models.length})`,this.loadingProgress=Math.floor(100*e.loaded/e.total)},e=>{p.a.error("Failed to load "+n.src+". "+e.message),this.onLoading=--s>0}).then(()=>{this.onLoading=--s>0}))}}getEventStatusIcon(e){let t="";switch(e){case Qs.RUNNING:t="el-icon-loading";break;case Qs.FAILED:t="el-icon-warning";break;case Qs.SUCCEEDED:t="el-icon-success";break;default:t="el-icon-loading";break}return t}toggleProjectSettingPanel(e){this.$store.commit(V.MUTATION_SHOW_PROJECT_SETTINGS_PANEL,e)}uploadModelFile(e){return t=>{const s=t.target.files;if(!s||s.length<=0)return;const i=s[0];this.onLoading=!0;const n={src:i.name,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],instantiate:!1,merge:!1};e&&e.loadLocalModel(n,e=>{this.loadingText="Loading "+i.name,this.loadingProgress=Math.floor(100*e.loaded/e.total)},e=>{p.a.error("Failed to load "+i.name+". "+e.message),this.onLoading=!1}).then(()=>{this.onLoading=!1})}}render(){var e,t;const s=arguments[0];return s("div",{ref:"viewerContainer",class:ns.a.viewerContainer},[s("div",{ref:"statsOutput",class:ns.a.statsOutput}),s(mt,{attrs:{viewer:this.viewer}}),s(Yt,{attrs:{scene:null===(e=this.viewer)||void 0===e?void 0:e.scene,objId:this.selectedObjId},class:ns.a.propertyPanel}),s(Ct,{attrs:{viewer:this.viewer}}),s("div",{ref:"axesRenderer",attrs:{id:"axesRenderer"},class:ns.a.axesRenderer}),s(ss,{attrs:{canvas:null===(t=this.viewer)||void 0===t||null===(t=t.renderer)||void 0===t?void 0:t.domElement}}),s(vt,{attrs:{viewer:this.viewer}}),s("input",{attrs:{type:"file",id:"uploadModelFile"},style:"display: none",on:{change:this.uploadModelFile(this.viewer)}}),this.onLoading&&s(_t,{attrs:{text:this.loadingText,progressValue:this.loadingProgress}}),s("el-dialog",L()([{attrs:{title:"Project settings",width:"400px",visible:this.$store.getters[V.GETTER_SHOW_PROJECT_SETTINGS_PANEL],destroyOnClose:!0},class:Nt.a.pSettingDialog},{on:{"update:visible":e=>{this.toggleProjectSettingPanel(e)}}}]),[s(Lt,L()([{attrs:{projectId:this.projectId}},{on:{"update:visible":e=>{this.toggleProjectSettingPanel(e)}}},{attrs:{viewer:this.viewer}}]))])])}};Object(m["a"])([Object(g["c"])({required:!0})],ei.prototype,"projectId",void 0),ei=Object(m["a"])([g["a"]],ei);var ti=ei;let si=class extends g["d"]{mounted(){}getProjectId(){if(this.projectId=this.$router.currentRoute.params.projectId,this.projectId)return this.projectId;console.error("[PP] Invalid projectId!")}render(){const e=arguments[0];return e("div",{ref:"projectPanel",class:N.a.projectPanel},[e(ti,{attrs:{projectId:this.getProjectId()}})])}};si=Object(m["a"])([g["a"]],si);var ii=si,ni=s("614a");K["default"].use(ni["a"]);const oi=[{path:"/projects",name:"Projects",component:_},{path:"/projects/:projectId",name:"ProjectPanel",component:ii},{path:"/",name:"Index",component:_}],ri=new ni["a"]({routes:oi});var ai=ri,ci=(s("7228"),s("3ecc")),li=s.n(ci),di=(s("23c3"),s("45cb")),hi=s.n(di),ui=(s("2b6d"),s("2469")),pi=s.n(ui),mi=(s("5d28"),s("1871")),gi=s.n(mi),fi=(s("7c7a"),s("7d7c")),bi=s.n(fi),vi=(s("5980"),s("c9fb")),wi=s.n(vi),yi=(s("068c"),s("4f47")),xi=s.n(yi),Ei=(s("41e1"),s("e1c5")),Oi=s.n(Ei),Mi=(s("cde6"),s("64ba")),Ti=s.n(Mi),Ci=(s("ca95"),s("5ccd")),Si=s.n(Ci),Pi=(s("f079"),s("6e0a")),ji=s.n(Pi),Ai=(s("cc93"),s("f5f0")),ki=s.n(Ai),_i=(s("0ae4"),s("df5d")),Ii=s.n(_i),Ni=(s("a63d"),s("a588")),Ri=s.n(Ni),Li=(s("441c"),s("ce62")),Bi=s.n(Li),Di=(s("3d7b"),s("1b99")),Fi=s.n(Di),Gi=(s("2cd6"),s("b9f2")),Ui=s.n(Gi),zi=(s("4354"),s("f07a")),Wi=s.n(zi),Hi=(s("b857"),s("fb94")),$i=s.n(Hi),Vi=(s("efa8"),s("cb9d")),Ki=s.n(Vi),qi=(s("c142"),s("c1d0")),Ji=s.n(qi),Xi=(s("feeb"),s("5006")),Yi=s.n(Xi),Zi=(s("f3b4"),s("d965")),Qi=s.n(Zi),en=(s("02e1"),s("a735")),tn=s.n(en),sn=(s("5a12"),s("c826")),nn=s.n(sn),on=(s("cac9"),s("97b4")),rn=s.n(on),an=(s("e3b3"),s("9ef1")),cn=s.n(an),ln=(s("bd4b"),s("28e9")),dn=s.n(ln),hn=(s("abe5"),s("b4f1")),un=s.n(hn);async function pn(){K["default"].config.productionTip=!1,o.instance(),await mn(),new K["default"]({router:ai,store:X,render:e=>e(h)}).$mount("#app")}async function mn(){try{const e="/",t="config/base.json",s=await E.a.get(t,{baseURL:e});K["default"].prototype.$config=s.data}catch(e){console.error(e)}}K["default"].use(un.a),K["default"].use(dn.a),K["default"].use(cn.a),K["default"].use(rn.a),K["default"].use(nn.a),K["default"].use(tn.a),K["default"].use(Qi.a),K["default"].use(Yi.a),K["default"].use(Ji.a),K["default"].use(Ki.a),K["default"].use($i.a),K["default"].use(Wi.a),K["default"].use(Ui.a),K["default"].use(Fi.a),K["default"].use(Bi.a),K["default"].use(Ri.a),K["default"].use(Ii.a),K["default"].use(ki.a),K["default"].use(ji.a),K["default"].use(Si.a),K["default"].use(Ti.a),K["default"].use(Oi.a),K["default"].use(xi.a),K["default"].use(wi.a),K["default"].use(bi.a),K["default"].use(gi.a),K["default"].use(pi.a),K["default"].use(hi.a),K["default"].use(li.a),K["default"].config.productionTip=!1,pn()},e595:function(e,t,s){e.exports={bottomBar:"BottomBar-module_bottomBar_joqOf"}},edda:function(e,t,s){e.exports={projects:"Projects-module_projects_3jkGy",cardsWrapper:"Projects-module_cardsWrapper_2hMMv",card:"Projects-module_card_l6j4O",createDialog:"Projects-module_createDialog_mY9uZ"}},f157:function(e,t,s){e.exports={viewerContainer:"Viewer3DContainer-module_viewerContainer_QfZNJ",statsOutput:"Viewer3DContainer-module_statsOutput_30pSD",propertyPanel:"Viewer3DContainer-module_propertyPanel_2c9Pb",axesRenderer:"Viewer3DContainer-module_axesRenderer_3j1gH",uploadEvents:"Viewer3DContainer-module_uploadEvents_2qIB6",header:"Viewer3DContainer-module_header_35nFE",body:"Viewer3DContainer-module_body_2Smto",eventList:"Viewer3DContainer-module_eventList_SIkDK",eventBox:"Viewer3DContainer-module_eventBox_2AXxE",uploadBtnWrapper:"Viewer3DContainer-module_uploadBtnWrapper_3Z4S3",createDialog:"Viewer3DContainer-module_createDialog_36gHC"}},f1ed:function(e,t,s){e.exports={projectCard:"ProjectCard-module_projectCard_3mmBx",card:"ProjectCard-module_card_1x907",thumbnail:"ProjectCard-module_thumbnail_1FUHb",deleteBtn:"ProjectCard-module_deleteBtn_1ZBSP",infos:"ProjectCard-module_infos_Zohlx",info:"ProjectCard-module_info_3iwXB"}},f490:function(e,t,s){}});
//# sourceMappingURL=app.65615134.js.map